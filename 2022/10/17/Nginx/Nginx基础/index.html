<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Nginx基础 | Code Play</title><meta name="author" content="南懿烨曦,869083577@qq.com"><meta name="copyright" content="南懿烨曦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习的过程中发现有现成的笔记，所以就不再自己写了  Nginx简介背景介绍Nginx（“engine x”）一个具有高性能的【HTTP】和【反向代理】的【WEB服务器】，同时也是一个【POP3&#x2F;SMTP&#x2F;IMAP代理服务器】，是由伊戈尔·赛索耶夫(俄罗斯人)使用C语言编写的，Nginx的第一个版本是2004年10月4号发布的0.1.0版本。另外值得一提的是伊戈尔·赛索耶夫将Nginx的源码进行了">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx基础">
<meta property="og:url" content="https://kallenblue.github.io/2022/10/17/Nginx/Nginx%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="Code Play">
<meta property="og:description" content="学习的过程中发现有现成的笔记，所以就不再自己写了  Nginx简介背景介绍Nginx（“engine x”）一个具有高性能的【HTTP】和【反向代理】的【WEB服务器】，同时也是一个【POP3&#x2F;SMTP&#x2F;IMAP代理服务器】，是由伊戈尔·赛索耶夫(俄罗斯人)使用C语言编写的，Nginx的第一个版本是2004年10月4号发布的0.1.0版本。另外值得一提的是伊戈尔·赛索耶夫将Nginx的源码进行了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/7568b9a2-f299-48a2-8175-f71c16c42337.jpg">
<meta property="article:published_time" content="2022-10-17T08:04:12.000Z">
<meta property="article:modified_time" content="2022-10-18T07:31:03.112Z">
<meta property="article:author" content="南懿烨曦">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/7568b9a2-f299-48a2-8175-f71c16c42337.jpg"><link rel="shortcut icon" href="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/3c412e9d-72fd-461f-89ea-b46d7303b054.png"><link rel="canonical" href="https://kallenblue.github.io/2022/10/17/Nginx/Nginx%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 南懿烨曦","link":"链接: ","source":"来源: Code Play","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nginx基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-18 15:31:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="Code Play" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/56de10fa-7fcf-450c-b8bb-cf46d0633c3f.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/7568b9a2-f299-48a2-8175-f71c16c42337.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Code Play</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Nginx基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-17T08:04:12.000Z" title="发表于 2022-10-17 16:04:12">2022-10-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-18T07:31:03.112Z" title="更新于 2022-10-18 15:31:03">2022-10-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Nginx/">Nginx</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Nginx基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>学习的过程中发现有现成的笔记，所以就不再自己写了</p>
</blockquote>
<h2 id="Nginx简介"><a href="#Nginx简介" class="headerlink" title="Nginx简介"></a>Nginx简介</h2><h3 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h3><p>Nginx（“engine x”）一个具有高性能的【HTTP】和【反向代理】的【WEB服务器】，同时也是一个【POP3/SMTP/IMAP代理服务器】，是由伊戈尔·赛索耶夫(俄罗斯人)使用C语言编写的，Nginx的第一个版本是2004年10月4号发布的0.1.0版本。另外值得一提的是伊戈尔·赛索耶夫将Nginx的源码进行了开源，这也为Nginx的发展提供了良好的保障。<br><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/fd0b7afcee2b4dc48d2f5ae182f7ccc1.png" alt="在这里插入图片描述"></p>
<h4 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h4><ol>
<li>WEB服务器：</li>
</ol>
<p>WEB服务器也叫网页服务器，英文名叫Web Server，主要功能是为用户提供网上信息浏览服务。</p>
<ol start="2">
<li>HTTP:</li>
</ol>
<p>HTTP是超文本传输协议的缩写，是用于从WEB服务器传输超文本到本地浏览器的传输协议，也是互联网上应用最为广泛的一种网络协议。HTTP是一个客户端和服务器端请求和应答的标准，客户端是终端用户，服务端是网站，通过使用Web浏览器、网络爬虫或者其他工具，客户端发起一个到服务器上指定端口的HTTP请求。</p>
<ol start="3">
<li>POP3/SMTP/IMAP：</li>
</ol>
<p>POP3(Post Offic Protocol 3)邮局协议的第三个版本，</p>
<p>SMTP(Simple Mail Transfer Protocol)简单邮件传输协议，</p>
<p>IMAP(Internet Mail Access Protocol)交互式邮件存取协议，</p>
<p>通过上述名词的解释，我们可以了解到Nginx也可以作为电子邮件代理服务器。</p>
<ol start="4">
<li>反向代理</li>
</ol>
<p>正向代理</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/a5bfe7d4528d445ca0c3b06befec9fa1.png" alt="请添加图片描述"></p>
<p>反向代理</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/7e659e9f8c44445f8325f5ec3042db13.png" alt="请添加图片描述"></p>
<h3 id="常见服务器对比"><a href="#常见服务器对比" class="headerlink" title="常见服务器对比"></a>常见服务器对比</h3><p>在介绍这一节内容之前，我们先来认识一家公司叫Netcraft。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Netcraft公司于1994年底在英国成立，多年来一直致力于互联网市场以及在线安全方面的咨询服务，其中在国际上最具影响力的当属其针对网站服务器、SSL市场所做的客观严谨的分析研究，公司官网每月公布的调研数据（Web Server Survey）已成为当今人们了解全球网站数量以及服务器市场分额情况的主要参考依据，时常被诸如华尔街杂志，英国BBC，Slashdot等媒体报道或引用。</span><br></pre></td></tr></table></figure>

<p>我们先来看一组数据，我们先打开Nginx的官方网站  <a target="_blank" rel="noopener" href="http://nginx.org/">http://nginx.org/</a>,找到Netcraft公司公布的数据，对当前主流服务器产品进行介绍。</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/f7b15dd9a74041719c5c2c3e1e5a987b.png" alt="在这里插入图片描述"></p>
<p>上面这张图展示了2019年全球主流Web服务器的市场情况，其中有Apache、Microsoft-IIS、google Servers、Nginx、Tomcat等，而我们在了解新事物的时候，往往习惯通过类比来帮助自己理解事物的概貌。所以下面我们把几种常见的服务器来给大家简单介绍下：</p>
<h4 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h4><pre><code>全称(Internet Information Services)即互联网信息服务，是由微软公司提供的基于windows系统的互联网基本服务。windows作为服务器在稳定性与其他一些性能上都不如类UNIX操作系统，因此在需要高性能Web服务器的场合下，IIS可能就会被&quot;冷落&quot;.
</code></pre>
<h4 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h4><pre><code>Tomcat是一个运行Servlet和JSP的Web应用软件，Tomcat技术先进、性能稳定而且开放源代码，因此深受Java爱好者的喜爱并得到了部分软件开发商的认可，成为目前比较流行的Web应用服务器。但是Tomcat天生是一个重量级的Web服务器，对静态文件和高并发的处理比较弱。
</code></pre>
<h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><pre><code>Apache的发展时期很长，同时也有过一段辉煌的业绩。从上图可以看出大概在2014年以前都是市场份额第一的服务器。Apache有很多优点，如稳定、开源、跨平台等。但是它出现的时间太久了，在它兴起的年代，互联网的产业规模远远不如今天，所以它被设计成一个重量级的、不支持高并发的Web服务器。在Apache服务器上，如果有数以万计的并发HTTP请求同时访问，就会导致服务器上消耗大量能存，操作系统内核对成百上千的Apache进程做进程间切换也会消耗大量的CUP资源，并导致HTTP请求的平均响应速度降低，这些都决定了Apache不可能成为高性能的Web服务器。这也促使了Lighttpd和Nginx的出现。
</code></pre>
<h4 id="Lighttpd"><a href="#Lighttpd" class="headerlink" title="Lighttpd"></a>Lighttpd</h4><pre><code>Lighttpd是德国的一个开源的Web服务器软件，它和Nginx一样，都是轻量级、高性能的Web服务器，欧美的业界开发者比较钟爱Lighttpd,而国内的公司更多的青睐Nginx，同时网上Nginx的资源要更丰富些。
</code></pre>
<h4 id="其他的服务器"><a href="#其他的服务器" class="headerlink" title="其他的服务器"></a>其他的服务器</h4><p>Google Servers，Weblogic, Webshpere(IBM)…</p>
<p>经过各个服务器的对比，种种迹象都表明，Nginx将以性能为王。这也是我们为什么选择Nginx的理由。</p>
<h4 id="Nginx的优点"><a href="#Nginx的优点" class="headerlink" title="Nginx的优点"></a>Nginx的优点</h4><h5 id="1-速度更快、并发更高"><a href="#1-速度更快、并发更高" class="headerlink" title="(1)速度更快、并发更高"></a>(1)速度更快、并发更高</h5><p>单次请求或者高并发请求的环境下，Nginx都会比其他Web服务器响应的速度更快。一方面在正常情况下，单次请求会得到更快的响应，另一方面，在高峰期(如有数以万计的并发请求)，Nginx比其他Web服务器更快的响应请求。Nginx之所以有这么高的并发处理能力和这么好的性能原因在于Nginx采用了多进程和I/O多路复用(epoll)的底层实现。</p>
<h5 id="2-配置简单，扩展性强"><a href="#2-配置简单，扩展性强" class="headerlink" title="(2)配置简单，扩展性强"></a>(2)配置简单，扩展性强</h5><p>Nginx的设计极具扩展性，它本身就是由很多模块组成，这些模块的使用可以通过配置文件的配置来添加。这些模块有官方提供的也有第三方提供的模块，如果需要完全可以开发服务自己业务特性的定制模块。</p>
<h5 id="3-高可靠性"><a href="#3-高可靠性" class="headerlink" title="(3)高可靠性"></a>(3)高可靠性</h5><p>Nginx采用的是多进程模式运行，其中有一个master主进程和N多个worker进程，worker进程的数量我们可以手动设置，每个worker进程之间都是相互独立提供服务，并且master主进程可以在某一个worker进程出错时，快速去”拉起”新的worker进程提供服务。</p>
<h5 id="4-热部署"><a href="#4-热部署" class="headerlink" title="(4)热部署"></a>(4)热部署</h5><p>现在互联网项目都要求以7*24小时进行服务的提供，针对于这一要求，Nginx也提供了热部署功能，即可以在Nginx不停止的情况下，对Nginx进行文件升级、更新配置和更换日志文件等功能。</p>
<h5 id="5-成本低、BSD许可证"><a href="#5-成本低、BSD许可证" class="headerlink" title="(5)成本低、BSD许可证"></a>(5)成本低、BSD许可证</h5><p>BSD是一个开源的许可证，世界上的开源许可证有很多，现在比较流行的有六种分别是GPL、BSD、MIT、Mozilla、Apache、LGPL。这六种的区别是什么，我们可以通过下面一张图来解释下：</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/51eb964159dd4fdc8f8e477e4869f6e2.png" alt="在这里插入图片描述"></p>
<p>Nginx本身是开源的，我们不仅可以免费的将Nginx应用在商业领域，而且还可以在项目中直接修改Nginx的源码来定制自己的特殊要求。这些点也都是Nginx为什么能吸引无数开发者继续为Nginx来贡献自己的智慧和青春。OpenRestry [Nginx+Lua]   Tengine[淘宝]</p>
<h3 id="Nginx的功能特性及常用功能"><a href="#Nginx的功能特性及常用功能" class="headerlink" title="Nginx的功能特性及常用功能"></a>Nginx的功能特性及常用功能</h3><p>Nginx提供的基本功能服务从大体上归纳为”基本HTTP服务”、“高级HTTP服务”和”邮件服务”等三大类。</p>
<h4 id="基本HTTP服务"><a href="#基本HTTP服务" class="headerlink" title="基本HTTP服务"></a>基本HTTP服务</h4><p>Nginx可以提供基本HTTP服务，可以作为HTTP代理服务器和反向代理服务器，支持通过缓存加速访问，可以完成简单的负载均衡和容错，支持包过滤功能，支持SSL等。</p>
<ul>
<li>处理静态文件、处理索引文件以及支持自动索引；</li>
<li>提供反向代理服务器，并可以使用缓存加上反向代理，同时完成负载均衡和容错；</li>
<li>提供对FastCGI、memcached等服务的缓存机制，，同时完成负载均衡和容错；</li>
<li>使用Nginx的模块化特性提供过滤器功能。Nginx基本过滤器包括gzip压缩、ranges支持、chunked响应、XSLT、SSI以及图像缩放等。其中针对包含多个SSI的页面，经由FastCGI或反向代理，SSI过滤器可以并行处理。</li>
<li>支持HTTP下的安全套接层安全协议SSL.</li>
<li>支持基于加权和依赖的优先权的HTTP/2</li>
</ul>
<h4 id="高级HTTP服务"><a href="#高级HTTP服务" class="headerlink" title="高级HTTP服务"></a>高级HTTP服务</h4><ul>
<li>支持基于名字和IP的虚拟主机设置</li>
<li>支持HTTP/1.0中的KEEP-Alive模式和管线(PipeLined)模型连接</li>
<li>自定义访问日志格式、带缓存的日志写操作以及快速日志轮转。</li>
<li>提供3xx~5xx错误代码重定向功能</li>
<li>支持重写（Rewrite)模块扩展</li>
<li>支持重新加载配置以及在线升级时无需中断正在处理的请求</li>
<li>支持网络监控</li>
<li>支持FLV和MP4流媒体传输</li>
</ul>
<h4 id="邮件服务"><a href="#邮件服务" class="headerlink" title="邮件服务"></a>邮件服务</h4><p>Nginx提供邮件代理服务也是其基本开发需求之一，主要包含以下特性：</p>
<ul>
<li>支持IMPA/POP3代理服务功能</li>
<li>支持内部SMTP代理服务功能</li>
</ul>
<h4 id="Nginx常用的功能模块"><a href="#Nginx常用的功能模块" class="headerlink" title="Nginx常用的功能模块"></a>Nginx常用的功能模块</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">静态资源部署</span><br><span class="line">Rewrite地址重写</span><br><span class="line">	正则表达式</span><br><span class="line">反向代理</span><br><span class="line">负载均衡</span><br><span class="line">	轮询、加权轮询、ip_hash、url_hash、fair</span><br><span class="line">Web缓存</span><br><span class="line">环境部署</span><br><span class="line">	高可用的环境</span><br><span class="line">用户认证模块...</span><br></pre></td></tr></table></figure>

<p>Nginx的核心组成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx二进制可执行文件</span><br><span class="line">nginx.conf配置文件</span><br><span class="line">error.log错误的日志记录</span><br><span class="line">access.log访问日志记录</span><br></pre></td></tr></table></figure>

<h2 id="Nginx环境准备"><a href="#Nginx环境准备" class="headerlink" title="Nginx环境准备"></a>Nginx环境准备</h2><h3 id="Nginx版本介绍"><a href="#Nginx版本介绍" class="headerlink" title="Nginx版本介绍"></a>Nginx版本介绍</h3><p>Nginx的官方网站为: <a target="_blank" rel="noopener" href="http://nginx.org/">http://nginx.org</a></p>
<p>打开源码可以看到如下的页面内容</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/063fc4f2ad5a43198ec610a45dfcea43.png" alt="在这里插入图片描述"></p>
<p>Nginx的官方下载网站为<a target="_blank" rel="noopener" href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a>，当然你也可以之间在首页选中右边的download进入版本下载网页。在下载页面我们会看到如下内容：</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/d207636aecf64c3bb3f72e35cadc710a.png" alt="在这里插入图片描述"></p>
<h3 id="获取Nginx源码"><a href="#获取Nginx源码" class="headerlink" title="获取Nginx源码"></a>获取Nginx源码</h3><p><a target="_blank" rel="noopener" href="http://nginx.org/download/">http://nginx.org/download/</a></p>
<p>打开上述网站，就可以查看到Nginx的所有版本，选中自己需要的版本进行下载。下载我们可以直接在windows上下载然后上传到服务器，也可以直接从服务器上下载，这个时候就需要准备一台服务器。</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/5b9a267e83ff4a05bb2cae0ddaf8c5ba.png" alt="在这里插入图片描述"></p>
<h3 id="准备服务器系统"><a href="#准备服务器系统" class="headerlink" title="准备服务器系统"></a>准备服务器系统</h3><p>环境准备</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VMware WorkStation</span><br><span class="line">Centos7</span><br><span class="line">MobaXterm</span><br><span class="line">	xsheel,SecureCRT</span><br><span class="line">网络</span><br></pre></td></tr></table></figure>

<p>(1)确认centos的内核</p>
<p>准备一个内核为2.6及以上版本的操作系统，因为linux2.6及以上内核才支持epoll,而Nginx需要解决高并发压力问题是需要用到epoll，所以我们需要有这样的版本要求。</p>
<p>我们可以使用<code>uname -a</code>命令来查询linux的内核版本。</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/4579d240547a4df596868fe72ca62928.png" alt="在这里插入图片描述"></p>
<p>(2)确保centos能联网</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure>

<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/82c54ad7bba9424fa4e58f833f13d0ea.png" alt="在这里插入图片描述"></p>
<p>(3)确认关闭防火墙</p>
<p>这一项的要求仅针对于那些对linux系统的防火墙设置规则不太清楚的，建议大家把防火墙都关闭掉，因为我们此次课程主要的内容是对Nginx的学习，把防火墙关闭掉，可以省掉后续Nginx学习过程中遇到的诸多问题。</p>
<p>关闭的方式有如下两种：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld      关闭运行的防火墙，系统重新启动后，防火墙将重新打开</span><br><span class="line">systemctl disable firewalld   永久关闭防火墙，，系统重新启动后，防火墙依然关闭</span><br><span class="line">systemctl status firewalld	 查看防火墙状态</span><br></pre></td></tr></table></figure>

<p>（4）确认停用selinux</p>
<p>selinux(security-enhanced linux),美国安全局对于强制访问控制的实现，在linux2.6内核以后的版本中，selinux已经成功内核中的一部分。可以说selinux是linux史上最杰出的新安全子系统之一。虽然有了selinux，我们的系统会更安全，但是对于我们的学习Nginx的历程中，会多很多设置，所以这块建议大家将selinux进行关闭。</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/8f2431de204947bab7cc5de1d69f641e.png" alt="在这里插入图片描述"></p>
<p>sestatus查看状态</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/eaa69c26076d4ca292e7a4315620d52b.png" alt="在这里插入图片描述"></p>
<p>如果查看不是disabled状态，我们可以通过修改配置文件来进行设置,修改SELINUX=disabled，然后重启下系统即可生效。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br></pre></td></tr></table></figure>

<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/a485806000214e239fd018e64853b7ba.png" alt="在这里插入图片描述"></p>
<h3 id="Nginx安装方式介绍"><a href="#Nginx安装方式介绍" class="headerlink" title="Nginx安装方式介绍"></a>Nginx安装方式介绍</h3><p>Nginx的安装方式有两种分别是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通过Nginx源码</span><br><span class="line">	通过Nginx源码简单安装 (1)</span><br><span class="line">	通过Nginx源码复杂安装 (3)</span><br><span class="line">通过yum安装 (2)</span><br></pre></td></tr></table></figure>

<p>如果通过Nginx源码安装需要提前准备的内容：</p>
<h5 id="GCC编译器"><a href="#GCC编译器" class="headerlink" title="GCC编译器"></a>GCC编译器</h5><p>Nginx是使用C语言编写的程序，因此想要运行Nginx就需要安装一个编译工具。GCC就是一个开源的编译器集合，用于处理各种各样的语言，其中就包含了C语言。</p>
<p>使用命令<code>yum install -y gcc</code>来安装</p>
<p>安装成功后，可以通过<code>gcc --version</code>来查看gcc是否安装成功</p>
<h5 id="PCRE"><a href="#PCRE" class="headerlink" title="PCRE"></a>PCRE</h5><p>Nginx在编译过程中需要使用到PCRE库（perl Compatible Regular Expressoin 兼容正则表达式库)，因为在Nginx的Rewrite模块和http核心模块都会使用到PCRE正则表达式语法。</p>
<p>可以使用命令<code>yum install -y pcre pcre-devel</code>来进行安装</p>
<p>安装成功后，可以通过<code>rpm -qa pcre pcre-devel</code>来查看是否安装成功</p>
<h5 id="zlib"><a href="#zlib" class="headerlink" title="zlib"></a>zlib</h5><p>zlib库提供了开发人员的压缩算法，在Nginx的各个模块中需要使用gzip压缩，所以我们也需要提前安装其库及源代码zlib和zlib-devel</p>
<p>可以使用命令<code>yum install -y zlib zlib-devel</code>来进行安装</p>
<p>安装成功后，可以通过<code>rpm -qa zlib zlib-devel</code>来查看是否安装成功</p>
<h5 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h5><p>OpenSSL是一个开放源代码的软件库包，应用程序可以使用这个包进行安全通信，并且避免被窃听。</p>
<p>SSL:Secure Sockets Layer安全套接协议的缩写，可以在Internet上提供秘密性传输，其目标是保证两个应用间通信的保密性和可靠性。在Nginx中，如果服务器需要提供安全网页时就需要用到OpenSSL库，所以我们需要对OpenSSL的库文件及它的开发安装包进行一个安装。</p>
<p>可以使用命令<code>yum install -y openssl openssl-devel</code>来进行安装</p>
<p>安装成功后，可以通过<code>rpm -qa openssl openssl-devel</code>来查看是否安装成功</p>
<p>上述命令，一个个来的话比较麻烦，我们也可以通过一条命令来进行安装</p>
<p><code>yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel</code>进行全部安装。</p>
<h4 id="方案一：Nginx的源码简单安装"><a href="#方案一：Nginx的源码简单安装" class="headerlink" title="方案一：Nginx的源码简单安装"></a>方案一：Nginx的源码简单安装</h4><p>(1)进入官网查找需要下载版本的链接地址，然后使用wget命令进行下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.16.1.tar.gz</span><br></pre></td></tr></table></figure>

<p>(2)建议大家将下载的资源进行包管理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p nginx/core</span><br><span class="line">mv nginx-1.16.1.tar.gz nginx/core</span><br></pre></td></tr></table></figure>

<p>(3)解压缩</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf nginx-1.16.1.tar.gz</span><br></pre></td></tr></table></figure>

<p>(4)进入资源文件中，发现configure</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure>

<p>(5)编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p>(6)安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="方案二：yum安装"><a href="#方案二：yum安装" class="headerlink" title="方案二：yum安装"></a>方案二：yum安装</h4><p>使用源码进行简单安装，我们会发现安装的过程比较繁琐，需要提前准备GCC编译器、PCRE兼容正则表达式库、zlib压缩库、OpenSSL安全通信的软件库包，然后才能进行Nginx的安装。</p>
<p>（1）安装yum-utils</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum  install -y yum-utils</span><br></pre></td></tr></table></figure>

<p>（2）添加yum源文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br></pre></td></tr></table></figure>

<p>（3）查看是否安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list | grep nginx</span><br></pre></td></tr></table></figure>

<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/7d0d7f50f6154cb4ad8873ed7f3521a1.png" alt="在这里插入图片描述"></p>
<p>（4）使用yum进行安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yun install -y nginx</span><br></pre></td></tr></table></figure>

<p>（5）查看nginx的安装位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure>

<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/a347aaf129ff49d1bd8518aad8caef04.png" alt="在这里插入图片描述"></p>
<p>（6）启动测试</p>
<h4 id="方案三-ubuntu下安装"><a href="#方案三-ubuntu下安装" class="headerlink" title="方案三: ubuntu下安装"></a>方案三: ubuntu下安装</h4><p>官方网站上有各个linux发行版的<a target="_blank" rel="noopener" href="https://nginx.org/en/linux_packages.html#Ubuntu">安装教程</a><br><strong>Ubuntu</strong><br>安装必备组件：</p>
<blockquote>
<p>sudo apt install curl gnupg2 ca-certificates lsb-release ubuntu-keyring </p>
</blockquote>
<p>导入一个官方的nginx签名密钥，以便apt可以验证软件包的真实性。获取密钥：</p>
<blockquote>
<p>curl <a target="_blank" rel="noopener" href="https://nginx.org/keys/nginx_signing.key">https://nginx.org/keys/nginx_signing.key</a> | gpg –dearmor \     | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null </p>
</blockquote>
<p>验证下载的文件是否包含正确的密钥：</p>
<blockquote>
<p>gpg –dry-run –quiet –no-keyring –import –import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg </p>
</blockquote>
<p>输出应包含完整的指纹，如下所示573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62:</p>
<blockquote>
<p>pub   rsa2048 2011-08-19 [SC] [expires: 2024-06-14]       573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62 uid                      nginx signing key <a href="mailto:&#x73;&#x69;&#103;&#110;&#x69;&#x6e;&#x67;&#45;&#107;&#101;&#121;&#x40;&#110;&#103;&#105;&#x6e;&#x78;&#46;&#99;&#111;&#x6d;">&#x73;&#x69;&#103;&#110;&#x69;&#x6e;&#x67;&#45;&#107;&#101;&#121;&#x40;&#110;&#103;&#105;&#x6e;&#x78;&#46;&#99;&#111;&#x6d;</a> </p>
</blockquote>
<p>如果指纹不同，请删除该文件。<br>要为稳定的nginx软件包设置apt存储库，请运行以下命令：</p>
<blockquote>
<p>echo “deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \ <a target="_blank" rel="noopener" href="http://nginx.org/packages/ubuntu">http://nginx.org/packages/ubuntu</a> <code>lsb_release -cs</code> nginx” \     | sudo tee /etc/apt/sources.list.d/nginx.list </p>
</blockquote>
<p>如果你想使用主线nginx包，请改为运行以下命令：</p>
<blockquote>
<p>echo “deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \ <a target="_blank" rel="noopener" href="http://nginx.org/packages/mainline/ubuntu">http://nginx.org/packages/mainline/ubuntu</a> <code>lsb_release -cs</code> nginx” \     | sudo tee /etc/apt/sources.list.d/nginx.list </p>
</blockquote>
<p>设置存储库固定，以优先选择我们的软件包而不是分发版提供的软件包：</p>
<blockquote>
<p>echo -e “Package: *\nPin: origin nginx.org\nPin: release o=nginx\nPin-Priority: 900\n” \     | sudo tee /etc/apt/preferences.d/99nginx </p>
</blockquote>
<p>要安装 nginx，请运行以下命令：</p>
<blockquote>
<p>sudo apt update<br>sudo apt install nginx </p>
</blockquote>
<h4 id="源码简单安装和yum安装的差异："><a href="#源码简单安装和yum安装的差异：" class="headerlink" title="源码简单安装和yum安装的差异："></a>源码简单安装和yum安装的差异：</h4><p>这里先介绍一个命令: <code>./nginx -V</code>,通过该命令可以查看到所安装Nginx的版本及相关配置信息。</p>
<p>简单安装</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/536246c7b0b14e2b829f3427331902a0.png" alt="在这里插入图片描述"></p>
<p>yum安装</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/e555308fb24f403ebe28bd2e6123d72a.png" alt="在这里插入图片描述"></p>
<h5 id="解压Nginx目录"><a href="#解压Nginx目录" class="headerlink" title="解压Nginx目录"></a>解压Nginx目录</h5><p>执行<code>tar -zxvf nginx-1.16.1.tar.gz</code>对下载的资源进行解压缩，进入压缩后的目录，可以看到如下结构</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/f469df49ced843daa6bd1457b435d1ed.png" alt="在这里插入图片描述"></p>
<p>内容解释：</p>
<p>auto:存放的是编译相关的脚本</p>
<p>CHANGES:版本变更记录</p>
<p>CHANGES.ru:俄罗斯文的版本变更记录</p>
<p>conf:nginx默认的配置文件</p>
<p>configure:nginx软件的自动脚本程序,是一个比较重要的文件，作用如下：</p>
<pre><code>（1）检测环境及根据环境检测结果生成C代码

（2）生成编译代码需要的Makefile文件
</code></pre>
<p>contrib:存放的是几个特殊的脚本文件，其中README中对脚本有着详细的说明</p>
<p>html:存放的是Nginx自带的两个html页面，访问Nginx的首页和错误页面</p>
<p>LICENSE:许可证的相关描述文件</p>
<p>man:nginx的man手册</p>
<p>README:Nginx的阅读指南</p>
<p>src:Nginx的源代码</p>
<h4 id="方案四-Nginx的源码复杂安装"><a href="#方案四-Nginx的源码复杂安装" class="headerlink" title="方案四:Nginx的源码复杂安装"></a>方案四:Nginx的源码复杂安装</h4><p>这种方式和简单的安装配置不同的地方在第一步，通过<code>./configure</code>来对编译参数进行设置，需要我们手动来指定。那么都有哪些参数可以进行设置，接下来我们进行一个详细的说明。</p>
<p>PATH:是和路径相关的配置信息</p>
<p>with:是启动模块，默认是关闭的</p>
<p>without:是关闭模块，默认是开启的</p>
<p>我们先来认识一些简单的路径配置已经通过这些配置来完成一个简单的编译：</p>
<p>–prefix=PATH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向Nginx的安装目录，默认值为/usr/local/nginx</span><br></pre></td></tr></table></figure>

<p>–sbin-path=PATH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向(执行)程序文件(nginx)的路径,默认值为&lt;prefix&gt;/sbin/nginx</span><br></pre></td></tr></table></figure>

<p>–modules-path=PATH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向Nginx动态模块安装目录，默认值为&lt;prefix&gt;/modules</span><br></pre></td></tr></table></figure>

<p>–conf-path=PATH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向配置文件(nginx.conf)的路径,默认值为&lt;prefix&gt;/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<p>–error-log-path=PATH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向错误日志文件的路径,默认值为&lt;prefix&gt;/logs/error.log</span><br></pre></td></tr></table></figure>

<p>–http-log-path=PATH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向访问日志文件的路径,默认值为&lt;prefix&gt;/logs/access.log</span><br></pre></td></tr></table></figure>

<p>–pid-path=PATH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向Nginx启动后进行ID的文件路径，默认值为&lt;prefix&gt;/logs/nginx.pid</span><br></pre></td></tr></table></figure>

<p>–lock-path=PATH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向Nginx锁文件的存放路径,默认值为&lt;prefix&gt;/logs/nginx.lock</span><br></pre></td></tr></table></figure>

<p>要想使用可以通过如下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx \</span><br><span class="line">--sbin-path=/usr/local/nginx/sbin/nginx \</span><br><span class="line">--modules-path=/usr/local/nginx/modules \</span><br><span class="line">--conf-path=/usr/local/nginx/conf/nginx.conf \</span><br><span class="line">--error-log-path=/usr/local/nginx/logs/error.log \</span><br><span class="line">--http-log-path=/usr/local/nginx/logs/access.log \</span><br><span class="line">--pid-path=/usr/local/nginx/logs/nginx.pid \</span><br><span class="line">--lock-path=/usr/local/nginx/logs/nginx.lock</span><br></pre></td></tr></table></figure>

<p>在使用上述命令之前，需要将之前服务器已经安装的nginx进行卸载，卸载的步骤分为三步骤：</p>
<p>步骤一：需要将nginx的进程关闭</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s stop</span><br></pre></td></tr></table></figure>

<p>步骤二:将安装的nginx进行删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /usr/local/nginx</span><br></pre></td></tr></table></figure>

<p>步骤三:将安装包之前编译的环境清除掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure>


<h3 id="Nginx目录结构分析"><a href="#Nginx目录结构分析" class="headerlink" title="Nginx目录结构分析"></a>Nginx目录结构分析</h3><p>在使用Nginx之前，我们先对安装好的Nginx目录文件进行一个分析，在这块给大家介绍一个工具tree，通过tree我们可以很方面的去查看centos系统上的文件目录结构，当然，如果想使用tree工具，就得先通过<code>yum install -y tree</code>来进行安装，安装成功后，可以通过执行<code>tree /usr/local/nginx</code>(tree后面跟的是Nginx的安装目录)，获取的结果如下：</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/3618a28076f74fa3b99677b38153a367.png" alt="在这里插入图片描述"></p>
<p>conf:nginx所有配置文件目录</p>
<pre><code>CGI(Common Gateway Interface)通用网关【接口】，主要解决的问题是从客户端发送一个请求和数据，服务端获取到请求和数据后可以调用调用CGI【程序】处理及相应结果给客户端的一种标准规范。

fastcgi.conf:fastcgi相关配置文件

fastcgi.conf.default:fastcgi.conf的备份文件

fastcgi_params:fastcgi的参数文件

fastcgi_params.default:fastcgi的参数备份文件

scgi_params:scgi的参数文件

scgi_params.default：scgi的参数备份文件

uwsgi_params:uwsgi的参数文件

uwsgi_params.default:uwsgi的参数备份文件

mime.types:记录的是HTTP协议中的Content-Type的值和文件后缀名的对应关系

mime.types.default:mime.types的备份文件

nginx.conf:这个是Nginx的核心配置文件，这个文件非常重要，也是我们即将要学习的重点

nginx.conf.default:nginx.conf的备份文件

koi-utf、koi-win、win-utf这三个文件都是与编码转换映射相关的配置文件，用来将一种编码转换成另一种编码
</code></pre>
<p>html:存放nginx自带的两个静态的html页面</p>
<pre><code>50x.html:访问失败后的失败页面

index.html:成功访问的默认首页
</code></pre>
<p>logs:记录入门的文件，当nginx服务器启动后，这里面会有 access.log error.log 和nginx.pid三个文件出现。</p>
<p>sbin:是存放执行程序文件nginx</p>
<pre><code>nginx是用来控制Nginx的启动和停止等相关的命令。
</code></pre>
<h3 id="Nginx服务器启停命令"><a href="#Nginx服务器启停命令" class="headerlink" title="Nginx服务器启停命令"></a>Nginx服务器启停命令</h3><p>Nginx安装完成后，接下来我们要学习的是如何启动、重启和停止Nginx的服务。</p>
<p>对于Nginx的启停在linux系统中也有很多种方式，我们本次课程介绍两种方式：</p>
<ol>
<li> Nginx服务的信号控制 </li>
<li> Nginx的命令行控制 </li>
</ol>
<h4 id="方式一-Nginx服务的信号控制"><a href="#方式一-Nginx服务的信号控制" class="headerlink" title="方式一:Nginx服务的信号控制"></a>方式一:Nginx服务的信号控制</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Nginx中的master和worker进程?</span><br><span class="line">Nginx的工作方式?</span><br><span class="line">如何获取进程的PID?</span><br><span class="line">信号有哪些?</span><br><span class="line">如何通过信号控制Nginx的启停等相关操作?</span><br></pre></td></tr></table></figure>

<p>前面在提到Nginx的高性能，其实也和它的架构模式有关。Nginx默认采用的是多进程的方式来工作的，当将Nginx启动后，我们通过<code>ps -ef | grep nginx</code>命令可以查看到如下内容：</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/7f33b9276e3a44d886f29e7efe998b15.png" alt="在这里插入图片描述"></p>
<p>从上图中可以看到,Nginx后台进程中包含一个master进程和多个worker进程，master进程主要用来管理worker进程，包含接收外界的信息，并将接收到的信号发送给各个worker进程，监控worker进程的状态，当worker进程出现异常退出后，会自动重新启动新的worker进程。而worker进程则是专门用来处理用户请求的，各个worker进程之间是平等的并且相互独立，处理请求的机会也是一样的。nginx的进程模型，我们可以通过下图来说明下：</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/7e0a8fddde3a46998298f314e2c95f93.png" alt="在这里插入图片描述"></p>
<p>我们现在作为管理员，只需要通过给master进程发送信号就可以来控制Nginx,这个时候我们需要有两个前提条件，一个是要操作的master进程，一个是信号。</p>
<p>（1）要想操作Nginx的master进程，就需要获取到master进程的进程号ID。获取方式简单介绍两个，</p>
<p>方式一：通过<code>ps -ef | grep nginx</code>；</p>
<p>方式二：在讲解nginx的<code>./configure</code>的配置参数的时候，有一个参数是<code>--pid-path=PATH</code>默认是<code>/usr/local/nginx/logs/nginx.pid</code>,所以可以通过查看该文件来获取nginx的master进程ID.</p>
<p>（2）信号</p>
<table>
<thead>
<tr>
<th>信号</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>TERM/INT</td>
<td>立即关闭整个服务</td>
</tr>
<tr>
<td>QUIT</td>
<td>“优雅”地关闭整个服务</td>
</tr>
<tr>
<td>HUP</td>
<td>重读配置文件并使用服务对新配置项生效</td>
</tr>
<tr>
<td>USR1</td>
<td>重新打开日志文件，可以用来进行日志切割</td>
</tr>
<tr>
<td>USR2</td>
<td>平滑升级到最新版的nginx</td>
</tr>
<tr>
<td>WINCH</td>
<td>所有子进程不在接收处理新连接，相当于给work进程发送QUIT指令</td>
</tr>
</tbody></table>
<p>调用命令为<code>kill -signal PID</code></p>
<p>signal:即为信号；PID即为获取到的master线程ID</p>
<ol>
<li>发送TERM/INT信号给master进程，会将Nginx服务立即关闭。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill -TERM PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br><span class="line">kill -INT PID / kill -INT `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>发送QUIT信号给master进程，master进程会控制所有的work进程不再接收新的请求，等所有请求处理完后，在把进程都关闭掉。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>发送HUP信号给master进程，master进程会把控制旧的work进程不再接收新的请求，等处理完请求后将旧的work进程关闭掉，然后根据nginx的配置文件重新启动新的work进程</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -HUP PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>发送USR1信号给master进程，告诉Nginx重新开启日志文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -USR1 PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>发送USR2信号给master进程，告诉master进程要平滑升级，这个时候，会重新开启对应的master进程和work进程，整个系统中将会有两个master进程，并且新的master进程的PID会被记录在<code>/usr/local/nginx/logs/nginx.pid</code>而之前的旧的master进程PID会被记录在<code>/usr/local/nginx/logs/nginx.pid.oldbin</code>文件中，接着再次发送QUIT信号给旧的master进程，让其处理完请求后再进行关闭</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -USR2 PID / kill -USR2 `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT PID / kill -QUIT `cat /usr/local/nginx/logs/nginx.pid.oldbin`</span><br></pre></td></tr></table></figure>

<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/19b6c57eca9248748a6be54f83e34c4c.png" alt="在这里插入图片描述"></p>
<ol start="6">
<li>发送WINCH信号给master进程,让master进程控制不让所有的work进程在接收新的请求了，请求处理完后关闭work进程。注意master进程不会被关闭掉</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -WINCH PID /kill -WINCH`cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure>

<h4 id="方式二-Nginx的命令行控制"><a href="#方式二-Nginx的命令行控制" class="headerlink" title="方式二:Nginx的命令行控制"></a>方式二:Nginx的命令行控制</h4><p>此方式是通过Nginx安装目录下的sbin下的可执行文件nginx来进行Nginx状态的控制，我们可以通过<code>nginx -h</code>来查看都有哪些参数可以用：</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/41d45ce5ab974dd995aa9c10f0d68b09.png" alt="在这里插入图片描述"></p>
<p>-?和-h:显示帮助信息</p>
<p>-v:打印版本号信息并退出</p>
<p>-V:打印版本号信息和配置信息并退出</p>
<p>-t:测试nginx的配置文件语法是否正确并退出</p>
<p>-T:测试nginx的配置文件语法是否正确并列出用到的配置文件信息然后退出</p>
<p>-q:在配置测试期间禁止显示非错误消息</p>
<p>-s:signal信号，后面可以跟 ：</p>
<pre><code> stop[快速关闭，类似于TERM/INT信号的作用]

quit[优雅的关闭，类似于QUIT信号的作用]

reopen[重新打开日志文件类似于USR1信号的作用]

reload[类似于HUP信号的作用]
</code></pre>
<p>-p:prefix，指定Nginx的prefix路径，(默认为: /usr/local/nginx/)</p>
<p>-c:filename,指定Nginx的配置文件路径,(默认为: conf/nginx.conf)</p>
<p>-g:用来补充Nginx配置文件，向Nginx服务指定启动时应用全局的配置</p>
<h3 id="Nginx服务器版本升级和新增模块"><a href="#Nginx服务器版本升级和新增模块" class="headerlink" title="Nginx服务器版本升级和新增模块"></a>Nginx服务器版本升级和新增模块</h3><p>如果想对Nginx的版本进行更新，或者要应用一些新的模块，最简单的做法就是停止当前的Nginx服务，然后开启新的Nginx服务。但是这样会导致在一段时间内，用户是无法访问服务器。为了解决这个问题，我们就需要用到Nginx服务器提供的平滑升级功能。这个也是Nginx的一大特点，使用这种方式，就可以使Nginx在7*24小时不间断的提供服务了。接下来我们分析下需求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需求：Nginx的版本最开始使用的是Nginx-1.14.2,由于服务升级，需要将Nginx的版本升级到Nginx-1.16.1,要求Nginx不能中断提供服务。</span><br></pre></td></tr></table></figure>

<p>为了应对上述的需求，这里我们给大家提供两种解决方案:</p>
<p>方案一:使用Nginx服务信号完成Nginx的升级</p>
<p>方案二:使用Nginx安装目录的make命令完成升级</p>
<h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h4><p>（1）先准备两个版本的Nginx分别是 1.14.2和1.16.1</p>
<p>（2）使用Nginx源码安装的方式将1.14.2版本安装成功并正确访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">进入安装目录</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>（3）将Nginx1.16.1进行参数配置和编译，不需要进行安装。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">进入安装目录</span><br><span class="line">./configure</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<h4 id="方案一-使用Nginx服务信号进行升级"><a href="#方案一-使用Nginx服务信号进行升级" class="headerlink" title="方案一:使用Nginx服务信号进行升级"></a>方案一:使用Nginx服务信号进行升级</h4><p>第一步:将1.14.2版本的sbin目录下的nginx进行备份</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin</span><br><span class="line">mv nginx nginxold</span><br></pre></td></tr></table></figure>

<p>第二步:将Nginx1.16.1安装目录编译后的objs目录下的nginx文件，拷贝到原来<code>/usr/local/nginx/sbin</code>目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/nginx/core/nginx-1.16.1/objs</span><br><span class="line">cp nginx /usr/local/nginx/sbin</span><br></pre></td></tr></table></figure>

<p>第三步:发送信号USR2给Nginx的1.14.2版本对应的master进程</p>
<p>第四步:发送信号QUIT给Nginx的1.14.2版本对应的master进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT `more /usr/local/logs/nginx.pid.oldbin`</span><br></pre></td></tr></table></figure>

<h4 id="方案二-使用Nginx安装目录的make命令完成升级"><a href="#方案二-使用Nginx安装目录的make命令完成升级" class="headerlink" title="方案二:使用Nginx安装目录的make命令完成升级"></a>方案二:使用Nginx安装目录的make命令完成升级</h4><p>第一步:将1.14.2版本的sbin目录下的nginx进行备份</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin</span><br><span class="line">mv nginx nginxold</span><br></pre></td></tr></table></figure>

<p>第二步:将Nginx1.16.1安装目录编译后的objs目录下的nginx文件，拷贝到原来<code>/usr/local/nginx/sbin</code>目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/nginx/core/nginx-1.16.1/objs</span><br><span class="line">cp nginx /usr/local/nginx/sbin</span><br></pre></td></tr></table></figure>

<p>第三步:进入到安装目录，执行<code>make upgrade</code></p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/2c2d3b36a9bd4559a2e710fb163b6649.png" alt="在这里插入图片描述"></p>
<p>第四步:查看是否更新成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -v</span><br></pre></td></tr></table></figure>

<p>在整个过程中，其实Nginx是一直对外提供服务的。并且当Nginx的服务器启动成功后，我们是可以通过浏览器进行直接访问的，同时我们可以通过更改html目录下的页面来修改我们在页面上所看到的内容，那么问题来了，为什么我们要修改html目录下的文件，能不能多添加一些页面是Nginx的功能更加丰富，还有前面聊到Nginx的前端功能又是如何来实现的，这就需要我们对Nginx的核心配置文件进行一个详细的学习。</p>
<h2 id="Nginx核心配置文件结构"><a href="#Nginx核心配置文件结构" class="headerlink" title="Nginx核心配置文件结构"></a>Nginx核心配置文件结构</h2><p>从前面的内容学习中，我们知道Nginx的核心配置文件默认是放在<code>/usr/local/nginx/conf/nginx.conf</code>，这一节，我们就来学习下nginx.conf的内容和基本配置方法。</p>
<p>读取Nginx自带的Nginx配置文件，我们将其中的注释部分【学习一个技术点就是在Nginx的配置文件中可以使用<code>#</code>来注释】删除掉后，就剩下下面内容:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">指令名	指令值;  #全局块，主要设置Nginx服务器整体运行的配置指令</span><br><span class="line"></span><br><span class="line"> #events块,主要设置,Nginx服务器与用户的网络连接,这一部分对Nginx服务器的性能影响较大</span><br><span class="line">events &#123;	 </span><br><span class="line">    指令名	指令值;</span><br><span class="line">&#125;</span><br><span class="line">#http块，是Nginx服务器配置中的重要部分，代理、缓存、日志记录、第三方模块配置...             </span><br><span class="line">http &#123;		</span><br><span class="line">    指令名	指令值;</span><br><span class="line">    server &#123; #server块，是Nginx配置和虚拟主机相关的内容</span><br><span class="line">        指令名	指令值;</span><br><span class="line">        location / &#123; </span><br><span class="line">        #location块，基于Nginx服务器接收请求字符串与location后面的值进行匹配，对特定请求进行处理</span><br><span class="line">            指令名	指令值;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单小结下:</p>
<p>nginx.conf配置文件中默认有三大块：全局块、events块、http块</p>
<p>http块中可以配置多个server块，每个server块又可以配置多个location块。</p>
<h3 id="全局块"><a href="#全局块" class="headerlink" title="全局块"></a>全局块</h3><h4 id="user指令"><a href="#user指令" class="headerlink" title="user指令"></a>user指令</h4><p>（1）user:用于配置运行Nginx服务器的worker进程的用户和用户组。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>user user [group]</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>nobody</td>
</tr>
<tr>
<td>位置</td>
<td>全局块</td>
</tr>
</tbody></table>
<p>该属性也可以在编译的时候指定，语法如下<code>./configure --user=user --group=group</code>,如果两个地方都进行了设置，最终生效的是配置文件中的配置。</p>
<p>该指令的使用步骤:</p>
<p>(1)设置一个用户信息”www”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user www;</span><br></pre></td></tr></table></figure>

<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/13bd1b9488b34c2b9184a9f5fc671f00.png" alt="在这里插入图片描述"></p>
<p>(2) 创建一个用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd www</span><br></pre></td></tr></table></figure>

<p>(3)修改user属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user www</span><br></pre></td></tr></table></figure>

<p>(4)创建<code>/root/html/index.html</code>页面，添加如下内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">35em</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>I am WWW<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>(5)修改nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">	root   /root/html;</span><br><span class="line">	index  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(5)测试启动访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">页面会报403拒绝访问的错误</span><br></pre></td></tr></table></figure>

<p>(6)分析原因</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为当前用户没有访问/root/html目录的权限</span><br></pre></td></tr></table></figure>

<p>(7)将文件创建到 <code>/home/www/html/index.html</code>,修改配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">	root   /home/www/html;</span><br><span class="line">	index  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(8)再次测试启动访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">能正常访问。</span><br></pre></td></tr></table></figure>

<p>综上所述，使用user指令可以指定启动运行工作进程的用户及用户组，这样对于系统的权限访问控制的更加精细，也更加安全。</p>
<h4 id="work-process指令"><a href="#work-process指令" class="headerlink" title="work process指令"></a>work process指令</h4><p>master_process:用来指定是否开启工作进程。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>master_process on&#124;off;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>master_process on;</td>
</tr>
<tr>
<td>位置</td>
<td>全局块</td>
</tr>
</tbody></table>
<p>worker_processes:用于配置Nginx生成工作进程的数量，这个是Nginx服务器实现并发处理服务的关键所在。理论上来说workder process的值越大，可以支持的并发处理量也越多，但事实上这个值的设定是需要受到来自服务器自身的限制，建议将该值和服务器CPU的内核数保存一致。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>worker_processes     num/auto;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>1</td>
</tr>
<tr>
<td>位置</td>
<td>全局块</td>
</tr>
</tbody></table>
<p>如果将worker_processes设置成2，则会看到如下内容:</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/6a280d7824ef45fea4f6c22f40f9881b.png" alt="在这里插入图片描述"></p>
<h4 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h4><p>daemon：设定Nginx是否以守护进程的方式启动。</p>
<p>守护式进程是linux后台执行的一种服务进程，特点是独立于控制终端，不会随着终端关闭而停止。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>daemon on&#124;off;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>daemon on;</td>
</tr>
<tr>
<td>位置</td>
<td>全局块</td>
</tr>
</tbody></table>
<p>pid:用来配置Nginx当前master进程的进程号ID存储的文件路径。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>pid file;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>默认为:/usr/local/nginx/logs/nginx.pid</td>
</tr>
<tr>
<td>位置</td>
<td>全局块</td>
</tr>
</tbody></table>
<p>该属性可以通过<code>./configure --pid-path=PATH</code>来指定</p>
<p>error_log:用来配置Nginx的错误日志存放路径</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>error_log  file [日志级别];</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>error_log logs/error.log error;</td>
</tr>
<tr>
<td>位置</td>
<td>全局块、http、server、location</td>
</tr>
</tbody></table>
<p>该属性可以通过<code>./configure --error-log-path=PATH</code>来指定</p>
<p>其中日志级别的值有：debug|info|notice|warn|error|crit|alert|emerg，翻译过来为试|信息|通知|警告|错误|临界|警报|紧急，这块建议大家设置的时候不要设置成info以下的等级，因为会带来大量的磁盘I/O消耗，影响Nginx的性能。</p>
<p>（5）include:用来引入其他配置文件，使Nginx的配置更加灵活</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>include file;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>无</td>
</tr>
<tr>
<td>位置</td>
<td>any</td>
</tr>
</tbody></table>
<h3 id="events块"><a href="#events块" class="headerlink" title="events块"></a>events块</h3><p>（1）accept_mutex:用来设置Nginx网络连接序列化</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>accept_mutex on&#124;off;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>accept_mutex on;</td>
</tr>
<tr>
<td>位置</td>
<td>events</td>
</tr>
</tbody></table>
<p>这个配置主要可以用来解决常说的”惊群”问题。大致意思是在某一个时刻，客户端发来一个请求连接，Nginx后台是以多进程的工作模式，也就是说有多个worker进程会被同时唤醒，但是最终只会有一个进程可以获取到连接，如果每次唤醒的进程数目太多，就会影响Nginx的整体性能。如果将上述值设置为on(开启状态)，将会对多个Nginx进程接收连接进行序列号，一个个来唤醒接收，就防止了多个进程对连接的争抢。</p>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/4b35ad6b8bf14f8189a670f60158b941.png" alt="在这里插入图片描述"></p>
<p>（2）multi_accept:用来设置是否允许同时接收多个网络连接</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>multi_accept on&#124;off;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>multi_accept off;</td>
</tr>
<tr>
<td>位置</td>
<td>events</td>
</tr>
</tbody></table>
<p>如果multi_accept被禁止了，nginx一个工作进程只能同时接受一个新的连接。否则，一个工作进程可以同时接受所有的新连接</p>
<p>（3）worker_connections：用来配置单个worker进程最大的连接数</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>worker_connections number;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>worker_commections 512;</td>
</tr>
<tr>
<td>位置</td>
<td>events</td>
</tr>
</tbody></table>
<p>这里的连接数不仅仅包括和前端用户建立的连接数，而是包括所有可能的连接数。另外，number值不能大于操作系统支持打开的最大文件句柄数量。</p>
<p>（4）use:用来设置Nginx服务器选择哪种事件驱动来处理网络消息。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>use  method;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>根据操作系统定</td>
</tr>
<tr>
<td>位置</td>
<td>events</td>
</tr>
</tbody></table>
<p>注意：此处所选择事件处理模型是Nginx优化部分的一个重要内容，method的可选值有select/poll/epoll/kqueue等，之前在准备centos环境的时候，我们强调过要使用linux内核在2.6以上，就是为了能使用epoll函数来优化Nginx。</p>
<p>另外这些值的选择，我们也可以在编译的时候使用</p>
<p><code>--with-select_module</code>、<code>--without-select_module</code>、</p>
<p><code>--with-poll_module</code>、<code>--without-poll_module</code>来设置是否需要将对应的事件驱动模块编译到Nginx的内核。</p>
<h4 id="events指令配置实例"><a href="#events指令配置实例" class="headerlink" title="events指令配置实例"></a>events指令配置实例</h4><p>打开Nginx的配置文件 nginx.conf,添加如下配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">events&#123;</span><br><span class="line">	accept_mutex on;</span><br><span class="line">	multi_accept on;</span><br><span class="line">	worker_commections 1024;</span><br><span class="line">	use epoll;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./nginx -t</span><br><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure>

<h3 id="http块"><a href="#http块" class="headerlink" title="http块"></a>http块</h3><h4 id="定义MIME-Type"><a href="#定义MIME-Type" class="headerlink" title="定义MIME-Type"></a>定义MIME-Type</h4><p>我们都知道浏览器中可以显示的内容有HTML、XML、GIF等种类繁多的文件、媒体等资源，浏览器为了区分这些资源，就需要使用MIME Type。所以说MIME Type是网络资源的媒体类型。Nginx作为web服务器，也需要能够识别前端请求的资源类型。</p>
<p>在Nginx的配置文件中，默认有两行配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include mime.types;</span><br><span class="line">default_type application/octet-stream;</span><br></pre></td></tr></table></figure>

<p>（1）default_type:用来配置Nginx响应前端请求默认的MIME类型。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>default_type mime-type;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>default_type text/plain；</td>
</tr>
<tr>
<td>位置</td>
<td>http、server、location</td>
</tr>
</tbody></table>
<p>在default_type之前还有一句<code>include mime.types</code>,include之前我们已经介绍过，相当于把mime.types文件中MIMT类型与相关类型文件的文件后缀名的对应关系加入到当前的配置文件中。</p>
<p>举例来说明：</p>
<p>有些时候请求某些接口的时候需要返回指定的文本字符串或者json字符串，如果逻辑非常简单或者干脆是固定的字符串，那么可以使用nginx快速实现，这样就不用编写程序响应请求了，可以减少服务器资源占用并且响应性能非常快。</p>
<p>如何实现:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location /get_text &#123;</span><br><span class="line">	#这里也可以设置成text/plain</span><br><span class="line">    default_type text/html;</span><br><span class="line">    return 200 &quot;This is nginx&#x27;s text&quot;;</span><br><span class="line">&#125;</span><br><span class="line">location /get_json&#123;</span><br><span class="line">    default_type application/json;</span><br><span class="line">    return 200 &#x27;&#123;&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18&#125;&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自定义服务日志"><a href="#自定义服务日志" class="headerlink" title="自定义服务日志"></a>自定义服务日志</h4><p>Nginx中日志的类型分access.log、error.log。</p>
<p>access.log:用来记录用户所有的访问请求。</p>
<p>error.log:记录nginx本身运行时的错误信息，不会记录用户的访问请求。</p>
<p>Nginx服务器支持对服务日志的格式、大小、输出等进行设置，需要使用到两个指令，分别是access_log和log_format指令。</p>
<p>（1）access_log:用来设置用户访问日志的相关属性。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>access_log path[format[buffer=size]]</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>access_log logs/access.log combined;</td>
</tr>
</tbody></table>
<p>| 位置 | <code>http</code><br>, <code>server</code><br>, <code>location</code> |</p>
<p>（2）log_format:用来指定日志的输出格式。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>log_format name [escape=default&#124;json&#124;none] string….;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>log_format combined “…”;</td>
</tr>
<tr>
<td>位置</td>
<td>http</td>
</tr>
</tbody></table>
<h4 id="其他配置指令"><a href="#其他配置指令" class="headerlink" title="其他配置指令"></a>其他配置指令</h4><p>（1）sendfile:用来设置Nginx服务器是否使用sendfile()传输文件，该属性可以大大提高Nginx处理静态资源的性能</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>sendfile on&#124;off；</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>sendfile off;</td>
</tr>
<tr>
<td>位置</td>
<td>http、server、location</td>
</tr>
</tbody></table>
<p>（2）keepalive_timeout:用来设置长连接的超时时间。</p>
<p>》为什么要使用keepalive？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我们都知道HTTP是一种无状态协议，客户端向服务端发送一个TCP请求，服务端响应完毕后断开连接。</span><br><span class="line">如何客户端向服务端发送多个请求，每个请求都需要重新创建一次连接，效率相对来说比较多，使用keepalive模式，可以告诉服务器端在处理完一个请求后保持这个TCP连接的打开状态，若接收到来自这个客户端的其他请求，服务端就会利用这个未被关闭的连接，而不需要重新创建一个新连接，提升效率，但是这个连接也不能一直保持，这样的话，连接如果过多，也会是服务端的性能下降，这个时候就需要我们进行设置其的超时时间。</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>语法</th>
<th>keepalive_timeout time;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>keepalive_timeout 75s;</td>
</tr>
<tr>
<td>位置</td>
<td>http、server、location</td>
</tr>
</tbody></table>
<p>（3）keepalive_requests:用来设置一个keep-alive连接使用的次数。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>keepalive_requests number;</th>
</tr>
</thead>
<tbody><tr>
<td>默认值</td>
<td>keepalive_requests 100;</td>
</tr>
<tr>
<td>位置</td>
<td>http、server、location</td>
</tr>
</tbody></table>
<h3 id="server块和location块"><a href="#server块和location块" class="headerlink" title="server块和location块"></a>server块和location块</h3><p>server块和location块都是我们要重点讲解和学习的内容，因为我们后面会对Nginx的功能进行详细讲解，所以这块内容就放到静态资源部署的地方给大家详细说明。</p>
<p>本节我们主要来认识下Nginx默认给的nginx.conf中的相关内容，以及server块与location块在使用的时候需要注意的一些内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">       listen       80;</span><br><span class="line">       server_name  localhost;</span><br><span class="line">       location / &#123;</span><br><span class="line">           root   html;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">       &#125;</span><br><span class="line">      </span><br><span class="line">       error_page   500 502 503 504 404  /50x.html;</span><br><span class="line">       location = /50x.html &#123;</span><br><span class="line">           root   html;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:869083577@qq.com">南懿烨曦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://kallenblue.github.io/2022/10/17/Nginx/Nginx%E5%9F%BA%E7%A1%80/">https://kallenblue.github.io/2022/10/17/Nginx/Nginx基础/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://kallenblue.github.io" target="_blank">Code Play</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/7568b9a2-f299-48a2-8175-f71c16c42337.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/fd2dd427-0dbb-475e-bde9-698997c1cce8.jpg" target="_blank"><img class="post-qr-code-img" src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/fd2dd427-0dbb-475e-bde9-698997c1cce8.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/db4b8536-6225-4c68-bd78-1039d24093aa.jpg" target="_blank"><img class="post-qr-code-img" src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/db4b8536-6225-4c68-bd78-1039d24093aa.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/10/19/%E5%81%A5%E5%BA%B7%E5%B0%8F%E8%B4%B4%E5%A3%AB/%E5%81%A5%E5%BA%B7%E5%B0%8F%E8%B4%B4%E5%A3%AB-%E9%98%B2%E4%B9%85%E5%9D%90/"><img class="prev-cover" src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/ca5a3588-eef3-408f-8a7c-4c930ee16ae8.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">健康小贴士-防久坐</div></div></a></div><div class="next-post pull-right"><a href="/2022/10/16/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Nacos%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/"><img class="next-cover" src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/cd2cfbd3-425f-48cf-84ef-9cd02b7a78c6.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">微服务-Nacos配置原理</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Livere</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NzI0MS8zMzcwNQ=="></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">Nginx简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">背景介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">1.1.1.</span> <span class="toc-text">名词解释</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%B9%E6%AF%94"><span class="toc-number">1.2.</span> <span class="toc-text">常见服务器对比</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IIS"><span class="toc-number">1.2.1.</span> <span class="toc-text">IIS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tomcat"><span class="toc-number">1.2.2.</span> <span class="toc-text">Tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Apache"><span class="toc-number">1.2.3.</span> <span class="toc-text">Apache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lighttpd"><span class="toc-number">1.2.4.</span> <span class="toc-text">Lighttpd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.2.5.</span> <span class="toc-text">其他的服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nginx%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">1.2.6.</span> <span class="toc-text">Nginx的优点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E9%80%9F%E5%BA%A6%E6%9B%B4%E5%BF%AB%E3%80%81%E5%B9%B6%E5%8F%91%E6%9B%B4%E9%AB%98"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">(1)速度更快、并发更高</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE%E7%AE%80%E5%8D%95%EF%BC%8C%E6%89%A9%E5%B1%95%E6%80%A7%E5%BC%BA"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">(2)配置简单，扩展性强</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">(3)高可靠性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-number">1.2.6.4.</span> <span class="toc-text">(4)热部署</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%88%90%E6%9C%AC%E4%BD%8E%E3%80%81BSD%E8%AE%B8%E5%8F%AF%E8%AF%81"><span class="toc-number">1.2.6.5.</span> <span class="toc-text">(5)成本低、BSD许可证</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E7%9A%84%E5%8A%9F%E8%83%BD%E7%89%B9%E6%80%A7%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.</span> <span class="toc-text">Nginx的功能特性及常用功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%ACHTTP%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.1.</span> <span class="toc-text">基本HTTP服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7HTTP%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.2.</span> <span class="toc-text">高级HTTP服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.3.</span> <span class="toc-text">邮件服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nginx%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">1.3.4.</span> <span class="toc-text">Nginx常用的功能模块</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.</span> <span class="toc-text">Nginx环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E7%89%88%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">Nginx版本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Nginx%E6%BA%90%E7%A0%81"><span class="toc-number">2.2.</span> <span class="toc-text">获取Nginx源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.3.</span> <span class="toc-text">准备服务器系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.4.</span> <span class="toc-text">Nginx安装方式介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#GCC%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">2.4.0.1.</span> <span class="toc-text">GCC编译器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PCRE"><span class="toc-number">2.4.0.2.</span> <span class="toc-text">PCRE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#zlib"><span class="toc-number">2.4.0.3.</span> <span class="toc-text">zlib</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OpenSSL"><span class="toc-number">2.4.0.4.</span> <span class="toc-text">OpenSSL</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9ANginx%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E5%AE%89%E8%A3%85"><span class="toc-number">2.4.1.</span> <span class="toc-text">方案一：Nginx的源码简单安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9Ayum%E5%AE%89%E8%A3%85"><span class="toc-number">2.4.2.</span> <span class="toc-text">方案二：yum安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%89-ubuntu%E4%B8%8B%E5%AE%89%E8%A3%85"><span class="toc-number">2.4.3.</span> <span class="toc-text">方案三: ubuntu下安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E5%AE%89%E8%A3%85%E5%92%8Cyum%E5%AE%89%E8%A3%85%E7%9A%84%E5%B7%AE%E5%BC%82%EF%BC%9A"><span class="toc-number">2.4.4.</span> <span class="toc-text">源码简单安装和yum安装的差异：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E5%8E%8BNginx%E7%9B%AE%E5%BD%95"><span class="toc-number">2.4.4.1.</span> <span class="toc-text">解压Nginx目录</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E5%9B%9B-Nginx%E7%9A%84%E6%BA%90%E7%A0%81%E5%A4%8D%E6%9D%82%E5%AE%89%E8%A3%85"><span class="toc-number">2.4.5.</span> <span class="toc-text">方案四:Nginx的源码复杂安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-number">2.5.</span> <span class="toc-text">Nginx目录结构分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%AF%E5%81%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">2.6.</span> <span class="toc-text">Nginx服务器启停命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80-Nginx%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%BF%A1%E5%8F%B7%E6%8E%A7%E5%88%B6"><span class="toc-number">2.6.1.</span> <span class="toc-text">方式一:Nginx服务的信号控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C-Nginx%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8E%A7%E5%88%B6"><span class="toc-number">2.6.2.</span> <span class="toc-text">方式二:Nginx的命令行控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%92%8C%E6%96%B0%E5%A2%9E%E6%A8%A1%E5%9D%97"><span class="toc-number">2.7.</span> <span class="toc-text">Nginx服务器版本升级和新增模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.7.1.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80-%E4%BD%BF%E7%94%A8Nginx%E6%9C%8D%E5%8A%A1%E4%BF%A1%E5%8F%B7%E8%BF%9B%E8%A1%8C%E5%8D%87%E7%BA%A7"><span class="toc-number">2.7.2.</span> <span class="toc-text">方案一:使用Nginx服务信号进行升级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C-%E4%BD%BF%E7%94%A8Nginx%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95%E7%9A%84make%E5%91%BD%E4%BB%A4%E5%AE%8C%E6%88%90%E5%8D%87%E7%BA%A7"><span class="toc-number">2.7.3.</span> <span class="toc-text">方案二:使用Nginx安装目录的make命令完成升级</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">Nginx核心配置文件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%9D%97"><span class="toc-number">3.1.</span> <span class="toc-text">全局块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#user%E6%8C%87%E4%BB%A4"><span class="toc-number">3.1.1.</span> <span class="toc-text">user指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#work-process%E6%8C%87%E4%BB%A4"><span class="toc-number">3.1.2.</span> <span class="toc-text">work process指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%8C%87%E4%BB%A4"><span class="toc-number">3.1.3.</span> <span class="toc-text">其他指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#events%E5%9D%97"><span class="toc-number">3.2.</span> <span class="toc-text">events块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#events%E6%8C%87%E4%BB%A4%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">events指令配置实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E5%9D%97"><span class="toc-number">3.3.</span> <span class="toc-text">http块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89MIME-Type"><span class="toc-number">3.3.1.</span> <span class="toc-text">定义MIME-Type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1%E6%97%A5%E5%BF%97"><span class="toc-number">3.3.2.</span> <span class="toc-text">自定义服务日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">3.3.3.</span> <span class="toc-text">其他配置指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#server%E5%9D%97%E5%92%8Clocation%E5%9D%97"><span class="toc-number">3.4.</span> <span class="toc-text">server块和location块</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/image/footer-bg.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 By 南懿烨曦</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">wow~你居然翻到了页底~恭喜你发现宝藏🎁</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://kallenblue.github.io/2022/10/17/Nginx/Nginx%E5%9F%BA%E7%A1%80/'
    this.page.identifier = '2022/10/17/Nginx/Nginx基础/'
    this.page.title = 'Nginx基础'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://httpskallenbluegithubio.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Livere' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="Hiraeth,Ephemeral,Limerence,Sonorous,Aurora,Epoch,Epiphany,Petrichor" data-fontsize="15px" data-random="true" async="async"></script><script src="//code.tidio.co/lvwsl5yorrlxergsbml1bxzfxmcqmojl.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>