<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Code Play</title>
  <icon>https://www.gravatar.com/avatar/37f5042e32043c8bcdfe0a7b75ed5267</icon>
  <subtitle>Codes&#39; Playground</subtitle>
  <link href="https://kallenblue.github.io/atom.xml" rel="self"/>
  
  <link href="https://kallenblue.github.io/"/>
  <updated>2023-01-16T14:39:01.477Z</updated>
  <id>https://kallenblue.github.io/</id>
  
  <author>
    <name>南懿烨曦</name>
    <email>869083577@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>关于点滴</title>
    <link href="https://kallenblue.github.io/2023/01/16/%E7%82%B9%E6%BB%B4/%E5%85%B3%E4%BA%8E%E7%82%B9%E6%BB%B4/"/>
    <id>https://kallenblue.github.io/2023/01/16/%E7%82%B9%E6%BB%B4/%E5%85%B3%E4%BA%8E%E7%82%B9%E6%BB%B4/</id>
    <published>2023-01-16T13:18:51.000Z</published>
    <updated>2023-01-16T14:39:01.477Z</updated>
    
    <content type="html"><![CDATA[<p>又有很长时间没有写博客了，</p><p>之前断写是因为b站的教程基本上都有课程笔记，而且记得比自己写的详细得多，所以感觉自己再写笔记是浪费时间</p><p><img src="https://img-blog.csdnimg.cn/5f4283f349804408a3cb2e327c5ccc35.png" alt="在这里插入图片描述"></p><p>但是，一段时间下来，发现自己在学完知识点后没有及时总结会很快忘记，别人的笔记始终是别人的，只有自己消化了才能真正掌握知识，比如现在让我讲一讲Nginx，光是讲使用我都得翻看笔记才能讲得出来</p><p>所以我觉得课程笔记只能当成文档来看，总结始终得自己来，一点一滴地积累，不管多少，详略都是自己的，面试的时候能够说出来的也是这些点滴。以后这一类文章我会不参照任何资料，按照自己的理解记录一些知识点，当然很可能是错的，不全面的，但绝对是有效果的，值得的。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;又有很长时间没有写博客了，&lt;/p&gt;
&lt;p&gt;之前断写是因为b站的教程基本上都有课程笔记，而且记得比自己写的详细得多，所以感觉自己再写笔记是浪费时间&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/5f4283f349804408a3c</summary>
      
    
    
    
    <category term="点滴" scheme="https://kallenblue.github.io/categories/%E7%82%B9%E6%BB%B4/"/>
    
    
  </entry>
  
  <entry>
    <title>B-树和B+树</title>
    <link href="https://kallenblue.github.io/2023/01/16/%E7%82%B9%E6%BB%B4/B-%E6%A0%91%E5%92%8CB-%E6%A0%91/"/>
    <id>https://kallenblue.github.io/2023/01/16/%E7%82%B9%E6%BB%B4/B-%E6%A0%91%E5%92%8CB-%E6%A0%91/</id>
    <published>2023-01-16T13:17:13.000Z</published>
    <updated>2023-01-16T14:38:21.921Z</updated>
    
    
    
    
    
    <category term="点滴" scheme="https://kallenblue.github.io/tags/%E7%82%B9%E6%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>Java面试-并发</title>
    <link href="https://kallenblue.github.io/2022/10/27/Java%E9%9D%A2%E8%AF%95/Java%E9%9D%A2%E8%AF%95-%E5%B9%B6%E5%8F%91/"/>
    <id>https://kallenblue.github.io/2022/10/27/Java%E9%9D%A2%E8%AF%95/Java%E9%9D%A2%E8%AF%95-%E5%B9%B6%E5%8F%91/</id>
    <published>2022-10-27T07:32:20.000Z</published>
    <updated>2022-10-27T12:52:56.197Z</updated>
    
    <content type="html"><![CDATA[<h1 id="java线程中的状态"><a href="#java线程中的状态" class="headerlink" title="java线程中的状态"></a>java线程中的状态</h1><p><img src="https://img-blog.csdnimg.cn/323ae7778103493b8cf1ec61fc5be6be.png"></p><h2 id="NEW-新建"><a href="#NEW-新建" class="headerlink" title="NEW-新建"></a>NEW-新建</h2><p>线程处于新建状态并没有和CPU中的线程关联起来，仅仅是一个线程对象，只有在使用start方法后才和CPU关联起来</p><h2 id="RUNNABLE-可运行"><a href="#RUNNABLE-可运行" class="headerlink" title="RUNNABLE-可运行"></a>RUNNABLE-可运行</h2><p>开始执行代码内容</p><h2 id="TERMINATED-终结"><a href="#TERMINATED-终结" class="headerlink" title="TERMINATED-终结"></a>TERMINATED-终结</h2><p>代码执行完毕后进入终结状态，相关资源被回收</p><h2 id="BLOCKED-阻塞"><a href="#BLOCKED-阻塞" class="headerlink" title="BLOCKED-阻塞"></a>BLOCKED-阻塞</h2><p>在多线程的情况下，可能会出现多个线程争抢同一把锁的时候，没有竞争到锁的线程会进入阻塞状态，当线程获取到锁时会重新进入可运行状态</p><h2 id="WATING-等待"><a href="#WATING-等待" class="headerlink" title="WATING-等待"></a>WATING-等待</h2><p>某些情况下，线程获取锁后还需要满足一些其他条件才能继续运行，线程获得锁后执行了wait()方法，此时线程进入等待状态，并且释放锁，当其他线程使用notify()方法唤醒等待状态的线程时，等待的线程重新去竞争锁再进入可运行状态</p><h2 id="TIMED-WATING-时限等待"><a href="#TIMED-WATING-时限等待" class="headerlink" title="TIMED_WATING-时限等待"></a>TIMED_WATING-时限等待</h2><p>和等待不同的地方在于，wait(long)方法中加入了时间参数，单位为毫秒，如果计时结束还没有收到其他线程的notify()方法，那么线程也会醒来重新去竞争锁。<br>另外，线程调用sleep(long)函数也会进入时限等待状态，但此时线程只会在计时结束后自动苏醒</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;java线程中的状态&quot;&gt;&lt;a href=&quot;#java线程中的状态&quot; class=&quot;headerlink&quot; title=&quot;java线程中的状态&quot;&gt;&lt;/a&gt;java线程中的状态&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Java面试-单例模式</title>
    <link href="https://kallenblue.github.io/2022/10/21/Java%E9%9D%A2%E8%AF%95/Java%E9%9D%A2%E8%AF%95-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>https://kallenblue.github.io/2022/10/21/Java%E9%9D%A2%E8%AF%95/Java%E9%9D%A2%E8%AF%95-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</id>
    <published>2022-10-21T05:06:37.000Z</published>
    <updated>2022-10-26T02:29:09.344Z</updated>
    
    <content type="html"><![CDATA[<h1 id="单例模式的意义"><a href="#单例模式的意义" class="headerlink" title="单例模式的意义"></a>单例模式的意义</h1><ol><li>控制资源的使用，避免对资源的多重占用</li><li>减少内存开销<h1 id="五种实现方式"><a href="#五种实现方式" class="headerlink" title="五种实现方式"></a>五种实现方式</h1><h2 id="1-饿汉式"><a href="#1-饿汉式" class="headerlink" title="1. 饿汉式"></a>1. 饿汉式</h2>所谓饿汉即是在类加载初就会创建对象<br>将构造方法私有化，并创建私有的静态final类对象成员，最后给出供外界调用的获取对象的方法<br>下面给出实现的代码<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.review.singleton;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton1</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Singleton1</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;private Singleton()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton1</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton1</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Singleton1 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="破坏单例的方式"><a href="#破坏单例的方式" class="headerlink" title="破坏单例的方式"></a>破坏单例的方式</h3><h4 id="1-反射创建实例"><a href="#1-反射创建实例" class="headerlink" title="1. 反射创建实例"></a>1. 反射创建实例</h4>通过反射机制，调用单例的私有构造方法创建新的实例对象<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">      <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">    reflection(Singleton1.class);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reflection</span><span class="params">(Class&lt;?&gt; clazz)</span></span><br><span class="line">      <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">    Constructor&lt;?&gt; constructor = clazz.getDeclaredConstructor();</span><br><span class="line">    constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;反射创建实例:&quot;</span> + constructor.newInstance());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li>应对措施<br>在构造方法中判断单例对象是否已经被创建  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">Singleton1</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">if</span> (INSTANCE != <span class="literal">null</span>)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;单例不能被重复创建&quot;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;private Singleton()&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-反序列化破坏单例"><a href="#2-反序列化破坏单例" class="headerlink" title="2.反序列化破坏单例"></a>2.反序列化破坏单例</h4>如果单例里面实现了序列化接口，那么就有可能被反序列化破坏单例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton1</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serializable</span><span class="params">(Object instance)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">  <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">  <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(byteArrayOutputStream);</span><br><span class="line">  oos.writeObject(instance);</span><br><span class="line">  <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(byteArrayOutputStream.toByteArray()));</span><br><span class="line">  System.out.println(<span class="string">&quot;反序列化创建实例：&quot;</span>+ois.readObject());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>应对措施<br>在单例中实现readResolve()方法，返回单例对象，这样在反序列化中获得的对象就会从这个方法里面获取<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-Unsafe破坏单例"><a href="#3-Unsafe破坏单例" class="headerlink" title="3.Unsafe破坏单例"></a>3.Unsafe破坏单例</h4>这个目前我不是很熟，只是知道用这个可以破坏单例，并且没有找到应对措施<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">unsafe</span><span class="params">(Class&lt;?&gt; clazz)</span></span><br><span class="line">    <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">  Class&lt;Unsafe&gt; unsafeClass = Unsafe.class;</span><br><span class="line">  Constructor&lt;Unsafe&gt; unsafeConstructor = unsafeClass.getDeclaredConstructor();</span><br><span class="line">  unsafeConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">  <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> unsafeConstructor.newInstance();</span><br><span class="line">  <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> unsafe.allocateInstance(clazz);</span><br><span class="line">  System.out.println(<span class="string">&quot;Unsafe 创建实例：&quot;</span>+o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-枚举饿汉式"><a href="#2-枚举饿汉式" class="headerlink" title="2. 枚举饿汉式"></a>2. 枚举饿汉式</h2>枚举类中默认设置构造方法为私有方法，枚举类是一种特殊的类，它可以由如下类表示它内部的实现原理<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Sex</span> &#123;</span><br><span class="line">  MALE,FEMALE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Sex</span> <span class="keyword">extends</span> <span class="title class_">Enum</span>&lt;Sex&gt;&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex MALE;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex FEMALE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Sex</span><span class="params">(String name, <span class="type">int</span> ordinal)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>(name, ordinal);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    MALE = <span class="keyword">new</span> <span class="title class_">Sex</span>(<span class="string">&quot;MALE&quot;</span>,<span class="number">0</span>);</span><br><span class="line">    FEMALE = <span class="keyword">new</span> <span class="title class_">Sex</span>(<span class="string">&quot;FEMALE&quot;</span>,<span class="number">1</span>);</span><br><span class="line">    $VALUES = values();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span>  Sex[] $VALUES;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Sex[] $values()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Sex</span>[]&#123;MALE,FEMALE&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Sex[] values()&#123;</span><br><span class="line">    <span class="keyword">return</span> $VALUES.clone();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Sex <span class="title function_">valueOf</span><span class="params">(String value)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Enum.valueOf(Sex.class, value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>通过定义枚举类可以很方便的实现一个单例，其构造方法默认都是私有方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton2</span> &#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line"></span><br><span class="line">  Singleton2()&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;private Singleton2()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getClass().getName()+<span class="string">&quot;@&quot;</span>+Integer.toHexString((hashCode()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Singleton2 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>枚举类单例也是饿汉式单例，在类加载的时候就会生成对象<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">      <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, IOException, ClassNotFoundException &#123;</span><br><span class="line">    Singleton2.otherMethod();</span><br><span class="line">    System.out.println(<span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span>);</span><br><span class="line">    System.out.println(Singleton2.getInstance());</span><br><span class="line">    System.out.println(Singleton2.getInstance());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private Singleton2()</span><br><span class="line">otherMethod()</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">com.review.singleton2.Singleton2@29453f44</span><br><span class="line">com.review.singleton2.Singleton2@29453f44</span><br></pre></td></tr></table></figure><h3 id="破坏单例的方式-1"><a href="#破坏单例的方式-1" class="headerlink" title="破坏单例的方式"></a>破坏单例的方式</h3><h4 id="默认已经处理的方式"><a href="#默认已经处理的方式" class="headerlink" title="默认已经处理的方式"></a>默认已经处理的方式</h4></li><li>枚举型单例中，反序列化不能破坏单例。<br>反序列化对枚举类会进行特殊的处理，它会直接返回单例的实例对象</li><li>使用反射破坏单例在枚举类中也是不允许的，这在枚举类中已经处理了<h4 id="Unsafe破坏单例"><a href="#Unsafe破坏单例" class="headerlink" title="Unsafe破坏单例"></a>Unsafe破坏单例</h4></li><li>unsafe依然可以破坏枚举类的单例<h2 id="3-懒汉式单例"><a href="#3-懒汉式单例" class="headerlink" title="3. 懒汉式单例"></a>3. 懒汉式单例</h2>懒汉式的实现很简单，只需要将单例成员变量的初始赋值设置为null，然后在第一次获取的时候getInstance()中创建即可<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton3</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Singleton3</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;private Singleton()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton3</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Singleton3 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>)&#123;</span><br><span class="line">      INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton3</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;otherMethod&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>测试结果如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">      <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, IOException, ClassNotFoundException &#123;</span><br><span class="line">    Singleton3.otherMethod();</span><br><span class="line">    System.out.println(<span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span>);</span><br><span class="line">    System.out.println(Singleton3.getInstance());</span><br><span class="line">    System.out.println(Singleton3.getInstance());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">otherMethod</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">private Singleton()</span><br><span class="line">com.review.singleton3.Singleton3@29453f44</span><br><span class="line">com.review.singleton3.Singleton3@29453f44</span><br></pre></td></tr></table></figure>可以看到，在调用类方法也就是类加载的时候并没有创建单例，只有在获取单例对象的时候才创建单例<h3 id="懒汉模式下的线程安全问题"><a href="#懒汉模式下的线程安全问题" class="headerlink" title="懒汉模式下的线程安全问题"></a>懒汉模式下的线程安全问题</h3>当单例未创建时，有多个线程同时访问getInstance()方法，有可能会出现多个线程调用构造方法的情况，从而破坏单例，解决方法也很简单，在getInstance()方法上加上同步的关键字synchronized即可，即在此方法上加锁<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton3 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>)&#123;</span><br><span class="line">    INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton3</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>但实际上这样的实现方法效率比较低，因为线程保护只需要在第一次调用getInstance()的时候使用，后续运行中，synchronized只会影响程序的性能，没有实质性作用<h2 id="4-DCL懒汉方式"><a href="#4-DCL懒汉方式" class="headerlink" title="4. DCL懒汉方式"></a>4. DCL懒汉方式</h2>DCL(Double Check Lock)双重检查锁定式懒汉单例，在上一种单例方法中，频繁且无用的同步操作会导致程序性能下降，DCL很好的解决了这个问题，代码如下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton4</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Singleton4</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;private Singleton()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">Singleton4</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Singleton4 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>)&#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (Singleton4.class)&#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>)&#123;</span><br><span class="line">          INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton4</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;otherMethod&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>当多个线程同时第一次调用getInstance()方法时，会进入第一个判断里，然后其中一个线程拿到锁，进入同步代码块，完成对象创建，释放锁。之后一起进入第一次判断的一个线程也进入同步代码块，但此时对象已经创建，所以不会再进行第二次创建，保证了单例的实现<h3 id="关于volatile字段"><a href="#关于volatile字段" class="headerlink" title="关于volatile字段"></a>关于volatile字段</h3>volatile字段主要是保证成员变量在构造时的”可见性”和”有序性”，在这里主要用到”有序性”,这里需要用汇编的知识来解释，所以需要反编译这个类，查看汇编代码<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -c -v -p Singleton4.class</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton4</span>();</span><br></pre></td></tr></table></figure>这行代码对应的汇编指令如下<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">17: new           #6                  // class com/review/singleton4/Singleton4</span><br><span class="line">20: dup</span><br><span class="line">21: invokespecial #7                  // Method &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">24: putstatic     #5                  // Field INSTANCE:Lcom/review/singleton4/Singleton4;</span><br></pre></td></tr></table></figure></li><li>17:分配对象需要的内存</li><li>21:对成员变量的初始化-&gt;执行构造方法</li><li>24:给静态变量赋值，这里就是给INSTANCE变量赋值<br>在执行上述汇编的过程中CPU会对我们的汇编指令进行优化，调整一些汇编指令的执行顺序，比如21和24就有可能被CPU调整执行顺序，因为两者没有没有因果关系，谁先执行都不重要<br>根据以上分析，那么就可能出现这样的情况<br><img src="https://img-blog.csdnimg.cn/4b5b2cf6fb574e0e8121aa5ee5993520.png"><br>蓝色线程在执行**INSTANCE = new Singleton4();**代码的时候，红色线程在进行INSTANCE空值判断，如果CPU将汇编指令的顺序调动，先执行静态变量赋值指令也就是24，那么红色线程就会在空值判断这里判断INSTANCE不为空，并且提前返回INSTANCE，而从汇编代码中可以看到构造方法还未执行，红色线程返回的对象必然是缺省的<br>加上volatile字段后，汇编指令就会按照顺序执行，不会被CPU调换执行顺序，从而避免这个问题<h2 id="5-内部类懒汉式"><a href="#5-内部类懒汉式" class="headerlink" title="5. 内部类懒汉式"></a>5. 内部类懒汉式</h2>之前的懒汉式单例都不可避免的遇到多线程的问题，但内部类懒汉模式较好的规避了这个问题，内部类本身就符合懒惰加载的特征，并且内部类可以访问外部类的私有变量，所以，通过在内部类中创建单例对象就可以实现懒汉式单例模式<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton5</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Singleton5</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;private singleton()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Singleton5</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton5</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Singleton5 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Holder.INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="单例模式在jdk中的体现"><a href="#单例模式在jdk中的体现" class="headerlink" title="单例模式在jdk中的体现"></a>单例模式在jdk中的体现</h1><h2 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h2>截取了部分代码<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Runtime</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Runtime</span> <span class="variable">currentRuntime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runtime</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Runtime <span class="title function_">getRuntime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> currentRuntime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Runtime</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>可以看出Runtime是饿汉式的单例模式<h2 id="System"><a href="#System" class="headerlink" title="System"></a>System</h2>截取System类中的Console对象的创建(Console是一个控制台的抽象类)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">System</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">Console</span> <span class="variable">cons</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> Console <span class="title function_">console</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (cons == <span class="literal">null</span>) &#123;</span><br><span class="line">             <span class="keyword">synchronized</span> (System.class) &#123;</span><br><span class="line">                 cons = sun.misc.SharedSecrets.getJavaIOAccess().console();</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> cons;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>cons = sun.misc.SharedSecrets.getJavaIOAccess().console();在这个方法链中也有一个判断当前cons是否为空的语句<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sun.misc.SharedSecrets.setJavaIOAccess(<span class="keyword">new</span> <span class="title class_">sun</span>.misc.JavaIOAccess() &#123;</span><br><span class="line">    <span class="keyword">public</span> Console <span class="title function_">console</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (istty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cons == <span class="literal">null</span>)</span><br><span class="line">                cons = <span class="keyword">new</span> <span class="title class_">Console</span>();</span><br><span class="line">            <span class="keyword">return</span> cons;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Charset <span class="title function_">charset</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// This method is called in sun.security.util.Password,</span></span><br><span class="line">        <span class="comment">// cons already exists when this method is called</span></span><br><span class="line">        <span class="keyword">return</span> cons.cs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>可以看出是一个双检索懒汉式的单例模型<h2 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h2>集合中有大量的空集合的需求，而这些空集合对象就是用的单例模式创建的<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Collections</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UnmodifiableNavigableSet</span>&lt;E&gt;</span><br><span class="line">                            <span class="keyword">extends</span> <span class="title class_">UnmodifiableSortedSet</span>&lt;E&gt;</span><br><span class="line">                            <span class="keyword">implements</span> <span class="title class_">NavigableSet</span>&lt;E&gt;, Serializable &#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmptyNavigableSet</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">UnmodifiableNavigableSet</span>&lt;E&gt;</span><br><span class="line">          <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">          <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">6291252904449939134L</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">public</span> <span class="title function_">EmptyNavigableSet</span><span class="params">()</span> &#123;</span><br><span class="line">              <span class="built_in">super</span>(<span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;E&gt;());</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span>        &#123; <span class="keyword">return</span> EMPTY_NAVIGABLE_SET; &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> NavigableSet&lt;?&gt; EMPTY_NAVIGABLE_SET =</span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">EmptyNavigableSet</span>&lt;&gt;();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;E&gt; NavigableSet&lt;E&gt; <span class="title function_">emptyNavigableSet</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (NavigableSet&lt;E&gt;) UnmodifiableNavigableSet.EMPTY_NAVIGABLE_SET;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>可以看出EmptyNavigableSet是采用静态内部类的单例模式创建的空对象，其中<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span>        &#123; <span class="keyword">return</span> EMPTY_NAVIGABLE_SET; &#125;</span><br></pre></td></tr></table></figure>还考虑了反序列化破坏单例的问题</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;单例模式的意义&quot;&gt;&lt;a href=&quot;#单例模式的意义&quot; class=&quot;headerlink&quot; title=&quot;单例模式的意义&quot;&gt;&lt;/a&gt;单例模式的意义&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;控制资源的使用，避免对资源的多重占用&lt;/li&gt;
&lt;li&gt;减少内存开销&lt;h1 id=&quot;五种</summary>
      
    
    
    
    <category term="Java面试" scheme="https://kallenblue.github.io/categories/Java%E9%9D%A2%E8%AF%95/"/>
    
    
  </entry>
  
  <entry>
    <title>Java面试-容器</title>
    <link href="https://kallenblue.github.io/2022/10/20/Java%E9%9D%A2%E8%AF%95/Java%E9%9D%A2%E8%AF%95-%E5%AE%B9%E5%99%A8/"/>
    <id>https://kallenblue.github.io/2022/10/20/Java%E9%9D%A2%E8%AF%95/Java%E9%9D%A2%E8%AF%95-%E5%AE%B9%E5%99%A8/</id>
    <published>2022-10-20T01:08:12.000Z</published>
    <updated>2022-10-21T05:08:15.686Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h1><h2 id="创建规则"><a href="#创建规则" class="headerlink" title="创建规则"></a>创建规则</h2><ul><li>当ArrayList使用无参构造时，容器大小为0<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li>如果传入一个集合，那么则以集合的大小为容器的初始容量<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">    elementData = c.toArray();</span><br><span class="line">    <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class="line">        <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">            elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// replace with empty array.</span></span><br><span class="line">        <span class="built_in">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="扩容规则"><a href="#扩容规则" class="headerlink" title="扩容规则"></a>扩容规则</h2><h3 id="add"><a href="#add" class="headerlink" title="add()"></a>add()</h3></li></ul><ul><li><p>如果容器的初始大小为0，那么第一次扩容大小为10</p></li><li><p>之后如果元素个数超出容器大小，每次扩容为原容器的1.5倍</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h3 id="addAll"><a href="#addAll" class="headerlink" title="addAll()"></a>addAll()</h3></li><li><p>选择(默认扩容方式扩容后的大小)与(原来容器的大小加上addAll()中集合参数中的大小)这两者中最大的那个为扩容标准</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">newCapacity = minCapacity;</span><br></pre></td></tr></table></figure><h2 id="FailFast"><a href="#FailFast" class="headerlink" title="FailFast"></a>FailFast</h2><p>在迭代遍历的时候，如果发现容器被修改，则立刻抛出异常，ArrayList是典型代表<br>ArrayList在初始化迭代器时会记录当前容器的修改次数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">expectedModCount</span> <span class="operator">=</span> modCount;</span><br></pre></td></tr></table></figure><p>在后续迭代的过程中会检查这个修改次数有没有发生变化，如果发生了变化则抛出异常</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">checkForComodification</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="FailSafe"><a href="#FailSafe" class="headerlink" title="FailSafe"></a>FailSafe</h2><p>在迭代遍历的时候，如果发现容器被修改，应当有一定措施，例如牺牲一致性来让整个遍历完成，CopyOnWriteArrayList是典型代表<br>CopyOnWriteArrayList在初始化迭代器时会复制一份当前容器的数组，遍历的数组和容器的数组独立起来，从而不会相互影响</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">COWIterator</span><span class="params">(Object[] elements, <span class="type">int</span> initialCursor)</span> &#123;</span><br><span class="line">    cursor = initialCursor;</span><br><span class="line">    snapshot = elements;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ArrayList和LinkedList比较"><a href="#ArrayList和LinkedList比较" class="headerlink" title="ArrayList和LinkedList比较"></a>ArrayList和LinkedList比较</h1></li><li><p>ArrayList</p><ul><li>基于数组，需要连续内存</li><li>随机访问快（根据下标访问）</li><li>尾部的插入和删除性能良好，但其他部分插入、删除都会移动数据，性能差</li><li>可以利用cpu缓存，局部性原理</li></ul></li><li><p>LinkedList</p><ul><li>基于双向链表，无需连续内存</li><li>随机访问慢（要沿着链表遍历）</li><li>头尾插入、删除性能高（删除中间的元素需要一个查询定位，效率低）</li><li>占用内存多</li></ul></li></ul><h1 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h1><h2 id="底层数据结构"><a href="#底层数据结构" class="headerlink" title="底层数据结构"></a>底层数据结构</h2><ul><li>1.7：数组+链表</li><li>1.8以上：数组+（链表|红黑树）</li></ul><h2 id="HashMap中的红黑树"><a href="#HashMap中的红黑树" class="headerlink" title="HashMap中的红黑树"></a>HashMap中的红黑树</h2><ul><li><ol><li>红黑树是用来避免DoS攻击，即用户刻意存储大量拥有相同hash值的元素，这种情况下导致链表很长，导致性能下降。但是一般情况下不会出现这种情况，所以树化应该是偶然情况</li></ol><ul><li><ol><li>hash表的查找、更新的时间复杂度是O(1)，而红黑树的查找，更新的时间复杂度是O(log<del>2</del>n),TreeNode占用空间也比普通Node的空间大，所以，如非必要，尽量使用链表</li></ol></li><li><ol start="2"><li>hash值如果足够随机，则再hash表内按泊松分布，在负载因子为0.75(达到3/4就扩容)的情况下，长度超过8的链表出现概率基本为0，选择树化阈值为8是为了让树化的几率足够小</li></ol></li></ul></li><li><ol start="2"><li>HashMap树化的两个条件：链表长度超过树化阈值；数组容量&gt;=64</li></ol></li><li><ol start="3"><li>退化情况1：在扩容时，一些元素的桶值会发生变化，会使树发生拆分，如果拆分后树的元素个数&lt;=6则会退化成链表</li></ol></li><li><ol start="4"><li>退化情况2：删除树节点时，如果root、root.left、root.right、root.left.left中有一个为null，也会退化成链表<h2 id="HashMap中的哈希"><a href="#HashMap中的哈希" class="headerlink" title="HashMap中的哈希"></a>HashMap中的哈希</h2></li></ol></li><li><ol><li>索引：计算对象的hashcode()，再进行调用HashMap的hash()方法进行二次哈希，最后&amp;(capacity-1)(即取模)得到索引<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></li></ol></li><li><ol start="2"><li>二次hash()是为了综合高位数据(将int数据的高16位与低16位异或)，让哈希分布更为均匀</li></ol></li><li><ol start="3"><li>计算索引时，如果HashMap的容量是2的n次幂，则可以使用位与运算代替取模&amp;(capacity-1)，效率更高;扩容时hash&amp;oldCap == 0的元素留在原来位置，否则新位置 = 旧位置 + oldCap(旧容量)</li></ol></li><li><ol start="4"><li>1，2，3都是为了配合容量为2的n次幂的hashmap的优化手段。实际上容量为质数会使元素的分布更均匀，但设计者为了综合的性能，最终还是选择了使用2的n次幂作为容量</li></ol></li></ul><h2 id="put新增-修改元素过程"><a href="#put新增-修改元素过程" class="headerlink" title="put新增/修改元素过程"></a>put新增/修改元素过程</h2><ul><li><ol><li>HashMap是懒惰创建数组的，首次使用才创建数组</li></ol></li><li><ol start="2"><li>计算索引(桶下标)</li></ol></li><li><ol start="3"><li>如果桶下标还没人占用，创建Node占位返回</li></ol></li><li><ol start="4"><li>如果桶下标已经有人占用</li></ol><ul><li><ol><li>已经是TreeNode走红黑树的添加或更新逻辑</li></ol></li><li><ol start="2"><li>普通的Node，走链表的添加或更新逻辑，如果链表长度超过树化阈值，走树化逻辑</li></ol></li></ul></li><li><ol start="5"><li>返回前检查容量是否超过阈值，一旦超过则进行扩容</li></ol></li><li><ol start="6"><li>1.7和1.8以上的不同点</li></ol><ul><li><ol><li>链表插入节点时，1.7是头插法，1.8是尾插法</li></ol></li><li><ol start="2"><li>1.7大于等于阈值且没有空位时才扩容，而1.8是大于阈值就扩容</li></ol></li><li><ol start="3"><li>1.8在扩容计算Node索引时会进行优化<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">扩容时hash&amp;oldCap == 0的元素留在原来位置，否则新位置 = 旧位置 + oldCap</span><br></pre></td></tr></table></figure><h2 id="负载因子设置为0-75f的原因"><a href="#负载因子设置为0-75f的原因" class="headerlink" title="负载因子设置为0.75f的原因"></a>负载因子设置为0.75f的原因</h2></li></ol></li></ul></li><li><ol><li>在空间占用与查询时间之间取得较好的权衡</li></ol></li><li><ol start="2"><li>大于这个值，空间节省了，但链表就会比较长，影响性能</li></ol></li><li><ol start="3"><li>小于这个值，冲突减少了，但扩容会更频繁，空间占用多</li></ol></li></ul><h2 id="多线程下出现的问题"><a href="#多线程下出现的问题" class="headerlink" title="多线程下出现的问题"></a>多线程下出现的问题</h2><ul><li><ol><li>在1.7中并发扩容可能会出现死链</li></ol></li><li><ol start="2"><li>如果同时插入两个桶下标相同的两个元素，则会发生数据丢失的问题<h2 id="HashMap的key"><a href="#HashMap的key" class="headerlink" title="HashMap的key"></a>HashMap的key</h2></li></ol></li><li><ol><li>HashMap的key可以为null，但Map的其他实现则不然</li></ol></li><li><ol start="2"><li>作为key的对象，必须实现hashCode和equals，并且key的内容不能修改(不可改变)</li></ol></li></ul><h2 id="String对象的hashCode"><a href="#String对象的hashCode" class="headerlink" title="String对象的hashCode()"></a>String对象的hashCode()</h2><p>hashCode()设计的目标是为了达到较为均匀的散列效果，每个字符串的hashCode需要足够独特</p><ul><li><ol><li>字符串中的每一个字符都可以表现为一个数字，称为S<del>i</del>,其中i的范围是0~n-1</li></ol></li><li><ol start="2"><li>散列公式为：S<del>0</del> * 31^n-1^+S<del>1</del> * 31^n-1^+…+s<del>i</del> * 31^n-1-1^+…+S<del>n-1</del> * 31^0^</li></ol></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ArrayList&quot;&gt;&lt;a href=&quot;#ArrayList&quot; class=&quot;headerlink&quot; title=&quot;ArrayList&quot;&gt;&lt;/a&gt;ArrayList&lt;/h1&gt;&lt;h2 id=&quot;创建规则&quot;&gt;&lt;a href=&quot;#创建规则&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="Java面试" scheme="https://kallenblue.github.io/categories/Java%E9%9D%A2%E8%AF%95/"/>
    
    
  </entry>
  
  <entry>
    <title>Pytorch-Tensor基础</title>
    <link href="https://kallenblue.github.io/2022/10/19/Pytorch/Pytorch-Tensor%E5%9F%BA%E7%A1%80/"/>
    <id>https://kallenblue.github.io/2022/10/19/Pytorch/Pytorch-Tensor%E5%9F%BA%E7%A1%80/</id>
    <published>2022-10-19T12:17:55.000Z</published>
    <updated>2022-10-19T13:50:50.210Z</updated>
    
    <content type="html"><![CDATA[<h1 id="tensor中的shape和size"><a href="#tensor中的shape和size" class="headerlink" title="tensor中的shape和size()"></a>tensor中的shape和size()</h1><p>反映了tensor的格式，二维的tensor的shape/size()对应矩阵中的行和列的大小，这样理解即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># 创建0维的tensor-&gt;标量</span></span><br><span class="line">a = torch.tensor(<span class="number">2.5</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="built_in">print</span>(a.size())</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="comment"># 输出:</span></span><br><span class="line"><span class="comment"># tensor(2.5000)</span></span><br><span class="line"><span class="comment"># torch.Size([])</span></span><br><span class="line"><span class="comment"># torch.Size([])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个tensor</span></span><br><span class="line">a = torch.tensor([<span class="number">2.2</span>, <span class="number">3.5</span>])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="built_in">print</span>(a.size())</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([2.2000, 3.5000])</span></span><br><span class="line"><span class="comment"># torch.Size([2])</span></span><br><span class="line"><span class="comment"># torch.Size([2])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个二维度的tensor</span></span><br><span class="line">a = torch.FloatTensor(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="built_in">print</span>(a.size())</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([[3.2605e-12, 7.4086e+28, 7.3697e+28],</span></span><br><span class="line"><span class="comment">#         [1.0947e+27, 1.7785e+25, 1.2122e+04],</span></span><br><span class="line"><span class="comment">#         [7.1846e+22, 6.9983e+28, 2.9593e+21]])</span></span><br><span class="line"><span class="comment"># torch.Size([3, 3])</span></span><br><span class="line"><span class="comment"># torch.Size([3, 3])</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="不同维度的tensor"><a href="#不同维度的tensor" class="headerlink" title="不同维度的tensor"></a>不同维度的tensor</h1><h2 id="0，1维"><a href="#0，1维" class="headerlink" title="0，1维"></a>0，1维</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0维</span></span><br><span class="line">a = torch.tensor(<span class="number">2.2</span>)</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="comment"># 返回维度</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(a.shape))</span><br><span class="line"><span class="built_in">print</span>(a.size())</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># torch.Size([])</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># torch.Size([])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1维</span></span><br><span class="line">a = torch.tensor([<span class="number">1.1</span>])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([1.1000])</span></span><br><span class="line"></span><br><span class="line">a = torch.tensor([<span class="number">1.1</span>, <span class="number">2.2</span>])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([1.1000, 2.2000])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机创建一个一维，长度为1的tensor</span></span><br><span class="line">a = torch.FloatTensor(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([1.4013e-45])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机创建一个一维，长度为2的tensor</span></span><br><span class="line">a = torch.FloatTensor(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([0.0000, 1.8750])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个一维的，长度为2且元素值为1的向量</span></span><br><span class="line">data = np.ones(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># 根据向量创建tensor</span></span><br><span class="line">a = torch.from_numpy(data)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># [1. 1.]</span></span><br><span class="line"><span class="comment"># tensor([1., 1.], dtype=torch.float64)</span></span><br></pre></td></tr></table></figure><h2 id="二、三维"><a href="#二、三维" class="headerlink" title="二、三维"></a>二、三维</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># 根据正态分布随机生成tensor</span></span><br><span class="line">a = torch.randn(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="built_in">print</span>(a.size(<span class="number">0</span>))</span><br><span class="line"><span class="built_in">print</span>(a.size(<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(a.shape[<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([[-0.2871, -0.2379,  0.0436],</span></span><br><span class="line"><span class="comment">#         [ 1.5324,  0.7144,  0.0508]])</span></span><br><span class="line"><span class="comment"># torch.Size([2, 3])</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据正态分布随机生成</span></span><br><span class="line">a = torch.rand(<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="built_in">print</span>(a[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(a.shape))</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([[[0.3967, 0.1736, 0.6457],</span></span><br><span class="line"><span class="comment">#          [0.8819, 0.7055, 0.3417]],</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         [[0.6029, 0.6032, 0.4393],</span></span><br><span class="line"><span class="comment">#          [0.8388, 0.0709, 0.0857]]])</span></span><br><span class="line"><span class="comment"># torch.Size([2, 2, 3])</span></span><br><span class="line"><span class="comment"># tensor([[0.3967, 0.1736, 0.6457],</span></span><br><span class="line"><span class="comment">#         [0.8819, 0.7055, 0.3417]])</span></span><br><span class="line"><span class="comment"># [2, 2, 3]</span></span><br></pre></td></tr></table></figure><h2 id="四维及其他"><a href="#四维及其他" class="headerlink" title="四维及其他"></a>四维及其他</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">a = torch.rand(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="comment"># 返回tensor元素的个数：2*3*4*2</span></span><br><span class="line"><span class="built_in">print</span>(a.numel())</span><br><span class="line"><span class="comment"># 返回tensor元素的维度</span></span><br><span class="line"><span class="built_in">print</span>(a.dim())</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([[[[0.5599, 0.2723],</span></span><br><span class="line"><span class="comment">#           [0.0488, 0.2327],</span></span><br><span class="line"><span class="comment">#           [0.2166, 0.8122],</span></span><br><span class="line"><span class="comment">#           [0.0877, 0.0184]],</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#          [[0.4803, 0.9102],</span></span><br><span class="line"><span class="comment">#           [0.3802, 0.5224],</span></span><br><span class="line"><span class="comment">#           [0.1912, 0.8837],</span></span><br><span class="line"><span class="comment">#           [0.9155, 0.5591]],</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#          [[0.3846, 0.7604],</span></span><br><span class="line"><span class="comment">#           [0.7920, 0.7762],</span></span><br><span class="line"><span class="comment">#           [0.7335, 0.5712],</span></span><br><span class="line"><span class="comment">#           [0.2319, 0.5643]]],</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#         [[[0.3215, 0.3339],</span></span><br><span class="line"><span class="comment">#           [0.4448, 0.2315],</span></span><br><span class="line"><span class="comment">#           [0.7863, 0.2281],</span></span><br><span class="line"><span class="comment">#           [0.1447, 0.7601]],</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#          [[0.9106, 0.8218],</span></span><br><span class="line"><span class="comment">#           [0.6886, 0.8535],</span></span><br><span class="line"><span class="comment">#           [0.9112, 0.8106],</span></span><br><span class="line"><span class="comment">#           [0.2282, 0.9450]],</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#          [[0.5409, 0.3910],</span></span><br><span class="line"><span class="comment">#           [0.6941, 0.9943],</span></span><br><span class="line"><span class="comment">#           [0.6982, 0.7778],</span></span><br><span class="line"><span class="comment">#           [0.7190, 0.3657]]]])</span></span><br><span class="line"><span class="comment"># torch.Size([2, 3, 4, 2])</span></span><br><span class="line"><span class="comment"># 48</span></span><br><span class="line"><span class="comment"># 4</span></span><br></pre></td></tr></table></figure><h1 id="创建tensor"><a href="#创建tensor" class="headerlink" title="创建tensor"></a>创建tensor</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># 创建一个一维，长度为2的array，再通过torch创建tensor</span></span><br><span class="line">array = np.array([<span class="number">2.1</span>, <span class="number">3.3</span>])</span><br><span class="line">a = torch.from_numpy(array)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([2.1000, 3.3000], dtype=torch.float64)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个二维，长度分别为2和3的array，再通过torch创建tensor</span></span><br><span class="line">array = np.ones([<span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">a = torch.from_numpy(array)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([[1., 1., 1.],</span></span><br><span class="line"><span class="comment">#         [1., 1., 1.]], dtype=torch.float64)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># torch通过list直接创建tensor</span></span><br><span class="line">a = torch.tensor([<span class="number">2.</span>, <span class="number">3.2</span>])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">a = torch.tensor([[<span class="number">2.</span>, <span class="number">3.2</span>], [<span class="number">1.</span>, <span class="number">2.6</span>]])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([2.0000, 3.2000])</span></span><br><span class="line"><span class="comment"># tensor([[2.0000, 3.2000],</span></span><br><span class="line"><span class="comment">#         [1.0000, 2.6000]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Tensor()方法根据参数个数创建对应维度的tensor，每个维度的长度为参数的大小</span></span><br><span class="line">a = torch.Tensor(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([[0., 0., 0.],</span></span><br><span class="line"><span class="comment">#         [0., 0., 0.],</span></span><br><span class="line"><span class="comment">#         [0., 0., 0.]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 未初始化的tensor</span></span><br><span class="line">a = torch.IntTensor(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">a = torch.FloatTensor(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([[1, 0, 1],</span></span><br><span class="line"><span class="comment">#         [0, 1, 0]], dtype=torch.int32)</span></span><br><span class="line"><span class="comment"># tensor([[-1.5556e-18,  5.3249e-43,  0.0000e+00],</span></span><br><span class="line"><span class="comment">#         [ 0.0000e+00,  0.0000e+00,  0.0000e+00]])</span></span><br></pre></td></tr></table></figure><p>tensor创建默认是FloatTensor类型，可以通过下面的方式修改默认</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.set_default_tensor_type(torch.DoubleTensor)</span><br></pre></td></tr></table></figure><h2 id="rand"><a href="#rand" class="headerlink" title="rand*"></a>rand*</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 随机创建一个值在(0,1)的3*3二维tensor</span></span><br><span class="line">a = torch.rand(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 传入一个tensor并执行rand函数创建新的tensor</span></span><br><span class="line">a = torch.rand_like(a)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 创建一个值在[1, 10)的3*3二维tensor</span></span><br><span class="line">a = torch.randint(<span class="number">1</span>, <span class="number">10</span>, [<span class="number">3</span>, <span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([[0.2667, 0.3021, 0.1402],</span></span><br><span class="line"><span class="comment">#         [0.9188, 0.2889, 0.4163],</span></span><br><span class="line"><span class="comment">#         [0.2108, 0.9262, 0.5140]])</span></span><br><span class="line"><span class="comment"># tensor([[0.6878, 0.0178, 0.3735],</span></span><br><span class="line"><span class="comment">#         [0.8983, 0.6910, 0.3853],</span></span><br><span class="line"><span class="comment">#         [0.1530, 0.5895, 0.7096]])</span></span><br><span class="line"><span class="comment"># tensor([[2, 5, 6],</span></span><br><span class="line"><span class="comment">#         [6, 9, 8],</span></span><br><span class="line"><span class="comment">#         [8, 6, 7]])</span></span><br></pre></td></tr></table></figure><h2 id="full"><a href="#full" class="headerlink" title="full"></a>full</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># full,创建一个2*3，且元素值皆为7的tensor</span></span><br><span class="line">a = torch.full([<span class="number">2</span>, <span class="number">3</span>], <span class="number">7</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 创建一个元素为7的标量</span></span><br><span class="line">a = torch.full([], <span class="number">7</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([[7, 7, 7],</span></span><br><span class="line"><span class="comment">#         [7, 7, 7]])</span></span><br><span class="line"><span class="comment"># tensor(7)</span></span><br></pre></td></tr></table></figure><h2 id="arange"><a href="#arange" class="headerlink" title="arange"></a>arange</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个差值为1的等差一维tensor</span></span><br><span class="line">a = torch.arange(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 创建一个差值为2的等差一维tensor</span></span><br><span class="line">a = torch.arange(<span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># tensor([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span></span><br><span class="line"><span class="comment"># tensor([0, 2, 4, 6, 8])</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;tensor中的shape和size&quot;&gt;&lt;a href=&quot;#tensor中的shape和size&quot; class=&quot;headerlink&quot; title=&quot;tensor中的shape和size()&quot;&gt;&lt;/a&gt;tensor中的shape和size()&lt;/h1&gt;&lt;p&gt;反映</summary>
      
    
    
    
    <category term="Pytorch" scheme="https://kallenblue.github.io/categories/Pytorch/"/>
    
    
  </entry>
  
  <entry>
    <title>健康小贴士-防久坐</title>
    <link href="https://kallenblue.github.io/2022/10/19/%E5%81%A5%E5%BA%B7%E5%B0%8F%E8%B4%B4%E5%A3%AB/%E5%81%A5%E5%BA%B7%E5%B0%8F%E8%B4%B4%E5%A3%AB-%E9%98%B2%E4%B9%85%E5%9D%90/"/>
    <id>https://kallenblue.github.io/2022/10/19/%E5%81%A5%E5%BA%B7%E5%B0%8F%E8%B4%B4%E5%A3%AB/%E5%81%A5%E5%BA%B7%E5%B0%8F%E8%B4%B4%E5%A3%AB-%E9%98%B2%E4%B9%85%E5%9D%90/</id>
    <published>2022-10-19T04:45:36.000Z</published>
    <updated>2022-10-19T13:12:48.809Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>【【医学博士】每天久坐8小时，身体会发生哪些变化？I 考研党、上班族必须收藏！】 <a href="https://www.bilibili.com/video/BV1mB4y1j77G?share_source=copy_web&vd_source=9060e17fbdb036783f1835e853a478b5">https://www.bilibili.com/video/BV1mB4y1j77G?share_source=copy_web&amp;vd_source=9060e17fbdb036783f1835e853a478b5</a></p></blockquote><blockquote><p>笔记源自<a href="https://www.bilibili.com/h5/note-app/view?cvid=19020101&pagefrom=comment">https://www.bilibili.com/h5/note-app/view?cvid=19020101&amp;pagefrom=comment</a></p></blockquote><p><strong>视频总结+详细笔记</strong><br>━━━━━━━━━<strong>总结</strong><br>1、颈椎疼不要瞎按摩，用热毛巾湿敷；非肌肉型可以用颈托、直腰不低头、升高显示器<br>2、腰疼可以用暖宝宝，如果疼得很厉害可以非甾体抗炎药，久坐可以用椅垫、靠腰、颈枕。<br>3、可以每过半个小时换一下坐姿， PC肌训练可以预防痔疮和前列腺炎<br>━━━━━━━━━<br><strong>目录</strong><br><strong>一、脖子变化（颈型颈椎病）</strong><br><strong>二、腰部变化（腰肌劳损）</strong><br><strong>三、臀部变化（前列腺炎，痔疮）</strong></p><p><strong>一、脖子变化（颈型颈椎病）</strong></p><p><strong>1、症状</strong><br><strong>00:41</strong><br>①平时坐久了脖子就开始疼<br>②低下头摸到自己后颈骨上最突兀的这个骨头，然后向上摸凹陷的小坑，稍微用点力按，有疼痛感。<br><img src="https://img-blog.csdnimg.cn/6150d9d431ec43be935fe6042ba2c1f2.png"></p><p><strong>2、该怎么办？</strong><br><strong>00:59</strong><br>①不要瞎去按摩，因为里面可能会有炎症<br>②应该做就是用热毛巾湿敷，有助于消炎止痛。<br><strong>3、保护颈椎动作</strong><br><strong>01:11</strong><br><strong>①歪头</strong><br>（1）挺胸抬头，坐在椅子上，两眼目视前方然后<br>（2）歪头感觉你的斜方肌在拉伸，坚持8秒回正，再另外一侧歪头，坚持8秒回正<br>（3）来回两次为一组，每组做四次。<br>注：千万不要过度疼痛，要找那种刚要疼就停的感觉。</p><p><strong>②伸手往反方向扭头</strong><br>（1）挺胸，抬头坐在椅子上，两眼目视前方<br>（2）伸右手，同时向左看，达到疼痛的临界点，持续8秒回正，再相反方向做一遍，持续8秒回正<br>（3）来回两次为一组，每组做四次。<br><img src="https://img-blog.csdnimg.cn/20d2df70f056462798a8f5c5ff040558.png"></p><p><strong>4、为什么不能过度疼痛呢？</strong><br><strong>01:48</strong><br>因为如果你是非肌肉型的脖子疼（如下图），那这么做会加大你的损害程度，达到疼痛的临界点就足以拉伸紧张的肌群了。<br><img src="https://img-blog.csdnimg.cn/62fefdb3233d4e749979792ea6a3bd97.png"></p><p><strong>5、非肌肉型的颈椎病该咋办呢？</strong><br><strong>02:01</strong><br>①【用颈托】限制脖子活动范围。比如整个颈托卡在脖子上<br>②【直腰不低头】要写字的时候，腰部就跟着成一条直线倾斜<br>③【目标与视线平行】把你的显示器垫高，大概让眼睛与屏幕上沿平行，就能保证你不低头了。</p><p><strong>二、腰部变化</strong></p><p><strong>1、腰疼该怎么办？</strong><br><strong>02:32</strong><br>①坐在凳子上没一会就开始腰疼<br>用暖宝宝<br>机制：腰肌脑损，你一加热让血管打开，促进血液循环，无菌炎症引起的腰痛就缓解了。<br>②疼得很严重（临床指导下使用）<br>可以使用一些非甾体抗炎药，例如布洛芬、双氯芬酸、塞来昔布等</p><p><strong>2、缓解腰痛动作</strong><br><strong>03:00</strong><br>（1）心疼的抱抱自己<br>站起身慢慢的蹲下，然后双臂抱膝重点来了。此时低头屁股往下坐，慢慢感觉你后背在拉伸，坚持个8秒，再起身做四次完成。<br><img src="https://img-blog.csdnimg.cn/60b9f326365346938af37660048ff5c6.png"></p><p>机制：坐久了竖脊肌过度紧张，这么一拉伸就缓解了。<br>（2）大腿夹矿泉水瓶<br>矿泉水瓶子，坐在椅子上把它夹在两膝盖中间，然后双脚向外撇，坚持8秒，每天做四组<br><img src="https://img-blog.csdnimg.cn/f3d3cf570c504859ba8f2cabfae4001a.png"></p><p><strong>3、正确坐姿</strong><br><strong>03:51</strong><br>可以用椅垫、靠腰、颈枕把人和椅子之间的缝隙填满，也可以用人体工学椅（全贴合）<br><img src="https://img-blog.csdnimg.cn/5cc9990e1c814224af057db75b6b729f.png"></p><p><strong>三、臀部变化</strong><br><strong>1、坐在椅子上，屁股老是往下滑</strong><br><strong>04:33</strong><br>①买那种有包边的硬一点的，能让你髋骨回正的坐垫</p><p><strong>2、久坐导致的疾病</strong><br><strong>04:56</strong><br>疾病：前列腺炎、痔疮<br>原因：坐时间长了，血液循环不畅<br>预防：PC肌训练</p><p><strong>3、PC肌训练</strong><br><strong>05:15</strong><br>①夹紧屁股<br>②屁股注意力往前下方向移，然后再一用力，再放松<br>③找到上厕所时主动断流的那种感觉夹紧<br>④把注意力往后下方移，再用力<br>每天练两组，每一组练四次，每次进行持续8秒的训练基础，不要过度练习。<br><img src="https://img-blog.csdnimg.cn/bf0b6588005e41d088158b0a93383e71.png"></p><p><strong>4、预防久坐最实际有效的方法</strong><br>每半小时变换一下姿势，可以起来活动活动，在合理的角度内调整自己的坐姿（腰背部要填满）<br><strong>5、久坐健康指南</strong><br><img src="https://img-blog.csdnimg.cn/7b003b82c31e4a5f8a8fe904509a50e1.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;【【医学博士】每天久坐8小时，身体会发生哪些变化？I 考研党、上班族必须收藏！】 &lt;a href=&quot;https://www.bilibili.com/video/BV1mB4y1j77G?share_source=copy_web&amp;vd_sourc</summary>
      
    
    
    
    <category term="健康" scheme="https://kallenblue.github.io/categories/%E5%81%A5%E5%BA%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>Nginx基础</title>
    <link href="https://kallenblue.github.io/2022/10/17/Nginx/Nginx%E5%9F%BA%E7%A1%80/"/>
    <id>https://kallenblue.github.io/2022/10/17/Nginx/Nginx%E5%9F%BA%E7%A1%80/</id>
    <published>2022-10-17T08:04:12.000Z</published>
    <updated>2022-10-18T07:31:03.112Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>学习的过程中发现有现成的笔记，所以就不再自己写了</p></blockquote><h2 id="Nginx简介"><a href="#Nginx简介" class="headerlink" title="Nginx简介"></a>Nginx简介</h2><h3 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h3><p>Nginx（“engine x”）一个具有高性能的【HTTP】和【反向代理】的【WEB服务器】，同时也是一个【POP3/SMTP/IMAP代理服务器】，是由伊戈尔·赛索耶夫(俄罗斯人)使用C语言编写的，Nginx的第一个版本是2004年10月4号发布的0.1.0版本。另外值得一提的是伊戈尔·赛索耶夫将Nginx的源码进行了开源，这也为Nginx的发展提供了良好的保障。<br><img src="https://img-blog.csdnimg.cn/fd0b7afcee2b4dc48d2f5ae182f7ccc1.png" alt="在这里插入图片描述"></p><h4 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h4><ol><li>WEB服务器：</li></ol><p>WEB服务器也叫网页服务器，英文名叫Web Server，主要功能是为用户提供网上信息浏览服务。</p><ol start="2"><li>HTTP:</li></ol><p>HTTP是超文本传输协议的缩写，是用于从WEB服务器传输超文本到本地浏览器的传输协议，也是互联网上应用最为广泛的一种网络协议。HTTP是一个客户端和服务器端请求和应答的标准，客户端是终端用户，服务端是网站，通过使用Web浏览器、网络爬虫或者其他工具，客户端发起一个到服务器上指定端口的HTTP请求。</p><ol start="3"><li>POP3/SMTP/IMAP：</li></ol><p>POP3(Post Offic Protocol 3)邮局协议的第三个版本，</p><p>SMTP(Simple Mail Transfer Protocol)简单邮件传输协议，</p><p>IMAP(Internet Mail Access Protocol)交互式邮件存取协议，</p><p>通过上述名词的解释，我们可以了解到Nginx也可以作为电子邮件代理服务器。</p><ol start="4"><li>反向代理</li></ol><p>正向代理</p><p><img src="https://img-blog.csdnimg.cn/a5bfe7d4528d445ca0c3b06befec9fa1.png" alt="请添加图片描述"></p><p>反向代理</p><p><img src="https://img-blog.csdnimg.cn/7e659e9f8c44445f8325f5ec3042db13.png" alt="请添加图片描述"></p><h3 id="常见服务器对比"><a href="#常见服务器对比" class="headerlink" title="常见服务器对比"></a>常见服务器对比</h3><p>在介绍这一节内容之前，我们先来认识一家公司叫Netcraft。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Netcraft公司于1994年底在英国成立，多年来一直致力于互联网市场以及在线安全方面的咨询服务，其中在国际上最具影响力的当属其针对网站服务器、SSL市场所做的客观严谨的分析研究，公司官网每月公布的调研数据（Web Server Survey）已成为当今人们了解全球网站数量以及服务器市场分额情况的主要参考依据，时常被诸如华尔街杂志，英国BBC，Slashdot等媒体报道或引用。</span><br></pre></td></tr></table></figure><p>我们先来看一组数据，我们先打开Nginx的官方网站  <a href="http://nginx.org/">http://nginx.org/</a>,找到Netcraft公司公布的数据，对当前主流服务器产品进行介绍。</p><p><img src="https://img-blog.csdnimg.cn/f7b15dd9a74041719c5c2c3e1e5a987b.png" alt="在这里插入图片描述"></p><p>上面这张图展示了2019年全球主流Web服务器的市场情况，其中有Apache、Microsoft-IIS、google Servers、Nginx、Tomcat等，而我们在了解新事物的时候，往往习惯通过类比来帮助自己理解事物的概貌。所以下面我们把几种常见的服务器来给大家简单介绍下：</p><h4 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h4><pre><code>全称(Internet Information Services)即互联网信息服务，是由微软公司提供的基于windows系统的互联网基本服务。windows作为服务器在稳定性与其他一些性能上都不如类UNIX操作系统，因此在需要高性能Web服务器的场合下，IIS可能就会被&quot;冷落&quot;.</code></pre><h4 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h4><pre><code>Tomcat是一个运行Servlet和JSP的Web应用软件，Tomcat技术先进、性能稳定而且开放源代码，因此深受Java爱好者的喜爱并得到了部分软件开发商的认可，成为目前比较流行的Web应用服务器。但是Tomcat天生是一个重量级的Web服务器，对静态文件和高并发的处理比较弱。</code></pre><h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><pre><code>Apache的发展时期很长，同时也有过一段辉煌的业绩。从上图可以看出大概在2014年以前都是市场份额第一的服务器。Apache有很多优点，如稳定、开源、跨平台等。但是它出现的时间太久了，在它兴起的年代，互联网的产业规模远远不如今天，所以它被设计成一个重量级的、不支持高并发的Web服务器。在Apache服务器上，如果有数以万计的并发HTTP请求同时访问，就会导致服务器上消耗大量能存，操作系统内核对成百上千的Apache进程做进程间切换也会消耗大量的CUP资源，并导致HTTP请求的平均响应速度降低，这些都决定了Apache不可能成为高性能的Web服务器。这也促使了Lighttpd和Nginx的出现。</code></pre><h4 id="Lighttpd"><a href="#Lighttpd" class="headerlink" title="Lighttpd"></a>Lighttpd</h4><pre><code>Lighttpd是德国的一个开源的Web服务器软件，它和Nginx一样，都是轻量级、高性能的Web服务器，欧美的业界开发者比较钟爱Lighttpd,而国内的公司更多的青睐Nginx，同时网上Nginx的资源要更丰富些。</code></pre><h4 id="其他的服务器"><a href="#其他的服务器" class="headerlink" title="其他的服务器"></a>其他的服务器</h4><p>Google Servers，Weblogic, Webshpere(IBM)…</p><p>经过各个服务器的对比，种种迹象都表明，Nginx将以性能为王。这也是我们为什么选择Nginx的理由。</p><h4 id="Nginx的优点"><a href="#Nginx的优点" class="headerlink" title="Nginx的优点"></a>Nginx的优点</h4><h5 id="1-速度更快、并发更高"><a href="#1-速度更快、并发更高" class="headerlink" title="(1)速度更快、并发更高"></a>(1)速度更快、并发更高</h5><p>单次请求或者高并发请求的环境下，Nginx都会比其他Web服务器响应的速度更快。一方面在正常情况下，单次请求会得到更快的响应，另一方面，在高峰期(如有数以万计的并发请求)，Nginx比其他Web服务器更快的响应请求。Nginx之所以有这么高的并发处理能力和这么好的性能原因在于Nginx采用了多进程和I/O多路复用(epoll)的底层实现。</p><h5 id="2-配置简单，扩展性强"><a href="#2-配置简单，扩展性强" class="headerlink" title="(2)配置简单，扩展性强"></a>(2)配置简单，扩展性强</h5><p>Nginx的设计极具扩展性，它本身就是由很多模块组成，这些模块的使用可以通过配置文件的配置来添加。这些模块有官方提供的也有第三方提供的模块，如果需要完全可以开发服务自己业务特性的定制模块。</p><h5 id="3-高可靠性"><a href="#3-高可靠性" class="headerlink" title="(3)高可靠性"></a>(3)高可靠性</h5><p>Nginx采用的是多进程模式运行，其中有一个master主进程和N多个worker进程，worker进程的数量我们可以手动设置，每个worker进程之间都是相互独立提供服务，并且master主进程可以在某一个worker进程出错时，快速去”拉起”新的worker进程提供服务。</p><h5 id="4-热部署"><a href="#4-热部署" class="headerlink" title="(4)热部署"></a>(4)热部署</h5><p>现在互联网项目都要求以7*24小时进行服务的提供，针对于这一要求，Nginx也提供了热部署功能，即可以在Nginx不停止的情况下，对Nginx进行文件升级、更新配置和更换日志文件等功能。</p><h5 id="5-成本低、BSD许可证"><a href="#5-成本低、BSD许可证" class="headerlink" title="(5)成本低、BSD许可证"></a>(5)成本低、BSD许可证</h5><p>BSD是一个开源的许可证，世界上的开源许可证有很多，现在比较流行的有六种分别是GPL、BSD、MIT、Mozilla、Apache、LGPL。这六种的区别是什么，我们可以通过下面一张图来解释下：</p><p><img src="https://img-blog.csdnimg.cn/51eb964159dd4fdc8f8e477e4869f6e2.png" alt="在这里插入图片描述"></p><p>Nginx本身是开源的，我们不仅可以免费的将Nginx应用在商业领域，而且还可以在项目中直接修改Nginx的源码来定制自己的特殊要求。这些点也都是Nginx为什么能吸引无数开发者继续为Nginx来贡献自己的智慧和青春。OpenRestry [Nginx+Lua]   Tengine[淘宝]</p><h3 id="Nginx的功能特性及常用功能"><a href="#Nginx的功能特性及常用功能" class="headerlink" title="Nginx的功能特性及常用功能"></a>Nginx的功能特性及常用功能</h3><p>Nginx提供的基本功能服务从大体上归纳为”基本HTTP服务”、“高级HTTP服务”和”邮件服务”等三大类。</p><h4 id="基本HTTP服务"><a href="#基本HTTP服务" class="headerlink" title="基本HTTP服务"></a>基本HTTP服务</h4><p>Nginx可以提供基本HTTP服务，可以作为HTTP代理服务器和反向代理服务器，支持通过缓存加速访问，可以完成简单的负载均衡和容错，支持包过滤功能，支持SSL等。</p><ul><li>处理静态文件、处理索引文件以及支持自动索引；</li><li>提供反向代理服务器，并可以使用缓存加上反向代理，同时完成负载均衡和容错；</li><li>提供对FastCGI、memcached等服务的缓存机制，，同时完成负载均衡和容错；</li><li>使用Nginx的模块化特性提供过滤器功能。Nginx基本过滤器包括gzip压缩、ranges支持、chunked响应、XSLT、SSI以及图像缩放等。其中针对包含多个SSI的页面，经由FastCGI或反向代理，SSI过滤器可以并行处理。</li><li>支持HTTP下的安全套接层安全协议SSL.</li><li>支持基于加权和依赖的优先权的HTTP/2</li></ul><h4 id="高级HTTP服务"><a href="#高级HTTP服务" class="headerlink" title="高级HTTP服务"></a>高级HTTP服务</h4><ul><li>支持基于名字和IP的虚拟主机设置</li><li>支持HTTP/1.0中的KEEP-Alive模式和管线(PipeLined)模型连接</li><li>自定义访问日志格式、带缓存的日志写操作以及快速日志轮转。</li><li>提供3xx~5xx错误代码重定向功能</li><li>支持重写（Rewrite)模块扩展</li><li>支持重新加载配置以及在线升级时无需中断正在处理的请求</li><li>支持网络监控</li><li>支持FLV和MP4流媒体传输</li></ul><h4 id="邮件服务"><a href="#邮件服务" class="headerlink" title="邮件服务"></a>邮件服务</h4><p>Nginx提供邮件代理服务也是其基本开发需求之一，主要包含以下特性：</p><ul><li>支持IMPA/POP3代理服务功能</li><li>支持内部SMTP代理服务功能</li></ul><h4 id="Nginx常用的功能模块"><a href="#Nginx常用的功能模块" class="headerlink" title="Nginx常用的功能模块"></a>Nginx常用的功能模块</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">静态资源部署</span><br><span class="line">Rewrite地址重写</span><br><span class="line">正则表达式</span><br><span class="line">反向代理</span><br><span class="line">负载均衡</span><br><span class="line">轮询、加权轮询、ip_hash、url_hash、fair</span><br><span class="line">Web缓存</span><br><span class="line">环境部署</span><br><span class="line">高可用的环境</span><br><span class="line">用户认证模块...</span><br></pre></td></tr></table></figure><p>Nginx的核心组成</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx二进制可执行文件</span><br><span class="line">nginx.conf配置文件</span><br><span class="line">error.log错误的日志记录</span><br><span class="line">access.log访问日志记录</span><br></pre></td></tr></table></figure><h2 id="Nginx环境准备"><a href="#Nginx环境准备" class="headerlink" title="Nginx环境准备"></a>Nginx环境准备</h2><h3 id="Nginx版本介绍"><a href="#Nginx版本介绍" class="headerlink" title="Nginx版本介绍"></a>Nginx版本介绍</h3><p>Nginx的官方网站为: <a href="http://nginx.org/">http://nginx.org</a></p><p>打开源码可以看到如下的页面内容</p><p><img src="https://img-blog.csdnimg.cn/063fc4f2ad5a43198ec610a45dfcea43.png" alt="在这里插入图片描述"></p><p>Nginx的官方下载网站为<a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a>，当然你也可以之间在首页选中右边的download进入版本下载网页。在下载页面我们会看到如下内容：</p><p><img src="https://img-blog.csdnimg.cn/d207636aecf64c3bb3f72e35cadc710a.png" alt="在这里插入图片描述"></p><h3 id="获取Nginx源码"><a href="#获取Nginx源码" class="headerlink" title="获取Nginx源码"></a>获取Nginx源码</h3><p><a href="http://nginx.org/download/">http://nginx.org/download/</a></p><p>打开上述网站，就可以查看到Nginx的所有版本，选中自己需要的版本进行下载。下载我们可以直接在windows上下载然后上传到服务器，也可以直接从服务器上下载，这个时候就需要准备一台服务器。</p><p><img src="https://img-blog.csdnimg.cn/5b9a267e83ff4a05bb2cae0ddaf8c5ba.png" alt="在这里插入图片描述"></p><h3 id="准备服务器系统"><a href="#准备服务器系统" class="headerlink" title="准备服务器系统"></a>准备服务器系统</h3><p>环境准备</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VMware WorkStation</span><br><span class="line">Centos7</span><br><span class="line">MobaXterm</span><br><span class="line">xsheel,SecureCRT</span><br><span class="line">网络</span><br></pre></td></tr></table></figure><p>(1)确认centos的内核</p><p>准备一个内核为2.6及以上版本的操作系统，因为linux2.6及以上内核才支持epoll,而Nginx需要解决高并发压力问题是需要用到epoll，所以我们需要有这样的版本要求。</p><p>我们可以使用<code>uname -a</code>命令来查询linux的内核版本。</p><p><img src="https://img-blog.csdnimg.cn/4579d240547a4df596868fe72ca62928.png" alt="在这里插入图片描述"></p><p>(2)确保centos能联网</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/82c54ad7bba9424fa4e58f833f13d0ea.png" alt="在这里插入图片描述"></p><p>(3)确认关闭防火墙</p><p>这一项的要求仅针对于那些对linux系统的防火墙设置规则不太清楚的，建议大家把防火墙都关闭掉，因为我们此次课程主要的内容是对Nginx的学习，把防火墙关闭掉，可以省掉后续Nginx学习过程中遇到的诸多问题。</p><p>关闭的方式有如下两种：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld      关闭运行的防火墙，系统重新启动后，防火墙将重新打开</span><br><span class="line">systemctl disable firewalld   永久关闭防火墙，，系统重新启动后，防火墙依然关闭</span><br><span class="line">systemctl status firewalld 查看防火墙状态</span><br></pre></td></tr></table></figure><p>（4）确认停用selinux</p><p>selinux(security-enhanced linux),美国安全局对于强制访问控制的实现，在linux2.6内核以后的版本中，selinux已经成功内核中的一部分。可以说selinux是linux史上最杰出的新安全子系统之一。虽然有了selinux，我们的系统会更安全，但是对于我们的学习Nginx的历程中，会多很多设置，所以这块建议大家将selinux进行关闭。</p><p><img src="https://img-blog.csdnimg.cn/8f2431de204947bab7cc5de1d69f641e.png" alt="在这里插入图片描述"></p><p>sestatus查看状态</p><p><img src="https://img-blog.csdnimg.cn/eaa69c26076d4ca292e7a4315620d52b.png" alt="在这里插入图片描述"></p><p>如果查看不是disabled状态，我们可以通过修改配置文件来进行设置,修改SELINUX=disabled，然后重启下系统即可生效。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/a485806000214e239fd018e64853b7ba.png" alt="在这里插入图片描述"></p><h3 id="Nginx安装方式介绍"><a href="#Nginx安装方式介绍" class="headerlink" title="Nginx安装方式介绍"></a>Nginx安装方式介绍</h3><p>Nginx的安装方式有两种分别是:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通过Nginx源码</span><br><span class="line">通过Nginx源码简单安装 (1)</span><br><span class="line">通过Nginx源码复杂安装 (3)</span><br><span class="line">通过yum安装 (2)</span><br></pre></td></tr></table></figure><p>如果通过Nginx源码安装需要提前准备的内容：</p><h5 id="GCC编译器"><a href="#GCC编译器" class="headerlink" title="GCC编译器"></a>GCC编译器</h5><p>Nginx是使用C语言编写的程序，因此想要运行Nginx就需要安装一个编译工具。GCC就是一个开源的编译器集合，用于处理各种各样的语言，其中就包含了C语言。</p><p>使用命令<code>yum install -y gcc</code>来安装</p><p>安装成功后，可以通过<code>gcc --version</code>来查看gcc是否安装成功</p><h5 id="PCRE"><a href="#PCRE" class="headerlink" title="PCRE"></a>PCRE</h5><p>Nginx在编译过程中需要使用到PCRE库（perl Compatible Regular Expressoin 兼容正则表达式库)，因为在Nginx的Rewrite模块和http核心模块都会使用到PCRE正则表达式语法。</p><p>可以使用命令<code>yum install -y pcre pcre-devel</code>来进行安装</p><p>安装成功后，可以通过<code>rpm -qa pcre pcre-devel</code>来查看是否安装成功</p><h5 id="zlib"><a href="#zlib" class="headerlink" title="zlib"></a>zlib</h5><p>zlib库提供了开发人员的压缩算法，在Nginx的各个模块中需要使用gzip压缩，所以我们也需要提前安装其库及源代码zlib和zlib-devel</p><p>可以使用命令<code>yum install -y zlib zlib-devel</code>来进行安装</p><p>安装成功后，可以通过<code>rpm -qa zlib zlib-devel</code>来查看是否安装成功</p><h5 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h5><p>OpenSSL是一个开放源代码的软件库包，应用程序可以使用这个包进行安全通信，并且避免被窃听。</p><p>SSL:Secure Sockets Layer安全套接协议的缩写，可以在Internet上提供秘密性传输，其目标是保证两个应用间通信的保密性和可靠性。在Nginx中，如果服务器需要提供安全网页时就需要用到OpenSSL库，所以我们需要对OpenSSL的库文件及它的开发安装包进行一个安装。</p><p>可以使用命令<code>yum install -y openssl openssl-devel</code>来进行安装</p><p>安装成功后，可以通过<code>rpm -qa openssl openssl-devel</code>来查看是否安装成功</p><p>上述命令，一个个来的话比较麻烦，我们也可以通过一条命令来进行安装</p><p><code>yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel</code>进行全部安装。</p><h4 id="方案一：Nginx的源码简单安装"><a href="#方案一：Nginx的源码简单安装" class="headerlink" title="方案一：Nginx的源码简单安装"></a>方案一：Nginx的源码简单安装</h4><p>(1)进入官网查找需要下载版本的链接地址，然后使用wget命令进行下载</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.16.1.tar.gz</span><br></pre></td></tr></table></figure><p>(2)建议大家将下载的资源进行包管理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p nginx/core</span><br><span class="line">mv nginx-1.16.1.tar.gz nginx/core</span><br></pre></td></tr></table></figure><p>(3)解压缩</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf nginx-1.16.1.tar.gz</span><br></pre></td></tr></table></figure><p>(4)进入资源文件中，发现configure</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure><p>(5)编译</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><p>(6)安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="方案二：yum安装"><a href="#方案二：yum安装" class="headerlink" title="方案二：yum安装"></a>方案二：yum安装</h4><p>使用源码进行简单安装，我们会发现安装的过程比较繁琐，需要提前准备GCC编译器、PCRE兼容正则表达式库、zlib压缩库、OpenSSL安全通信的软件库包，然后才能进行Nginx的安装。</p><p>（1）安装yum-utils</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum  install -y yum-utils</span><br></pre></td></tr></table></figure><p>（2）添加yum源文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br></pre></td></tr></table></figure><p>（3）查看是否安装成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list | grep nginx</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/7d0d7f50f6154cb4ad8873ed7f3521a1.png" alt="在这里插入图片描述"></p><p>（4）使用yum进行安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yun install -y nginx</span><br></pre></td></tr></table></figure><p>（5）查看nginx的安装位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/a347aaf129ff49d1bd8518aad8caef04.png" alt="在这里插入图片描述"></p><p>（6）启动测试</p><h4 id="方案三-ubuntu下安装"><a href="#方案三-ubuntu下安装" class="headerlink" title="方案三: ubuntu下安装"></a>方案三: ubuntu下安装</h4><p>官方网站上有各个linux发行版的<a href="https://nginx.org/en/linux_packages.html#Ubuntu">安装教程</a><br><strong>Ubuntu</strong><br>安装必备组件：</p><blockquote><p>sudo apt install curl gnupg2 ca-certificates lsb-release ubuntu-keyring </p></blockquote><p>导入一个官方的nginx签名密钥，以便apt可以验证软件包的真实性。获取密钥：</p><blockquote><p>curl <a href="https://nginx.org/keys/nginx_signing.key">https://nginx.org/keys/nginx_signing.key</a> | gpg –dearmor \     | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null </p></blockquote><p>验证下载的文件是否包含正确的密钥：</p><blockquote><p>gpg –dry-run –quiet –no-keyring –import –import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg </p></blockquote><p>输出应包含完整的指纹，如下所示573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62:</p><blockquote><p>pub   rsa2048 2011-08-19 [SC] [expires: 2024-06-14]       573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62 uid                      nginx signing key <a href="mailto:&#x73;&#x69;&#103;&#110;&#x69;&#x6e;&#x67;&#45;&#107;&#101;&#121;&#x40;&#110;&#103;&#105;&#x6e;&#x78;&#46;&#99;&#111;&#x6d;">&#x73;&#x69;&#103;&#110;&#x69;&#x6e;&#x67;&#45;&#107;&#101;&#121;&#x40;&#110;&#103;&#105;&#x6e;&#x78;&#46;&#99;&#111;&#x6d;</a> </p></blockquote><p>如果指纹不同，请删除该文件。<br>要为稳定的nginx软件包设置apt存储库，请运行以下命令：</p><blockquote><p>echo “deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \ <a href="http://nginx.org/packages/ubuntu">http://nginx.org/packages/ubuntu</a> <code>lsb_release -cs</code> nginx” \     | sudo tee /etc/apt/sources.list.d/nginx.list </p></blockquote><p>如果你想使用主线nginx包，请改为运行以下命令：</p><blockquote><p>echo “deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \ <a href="http://nginx.org/packages/mainline/ubuntu">http://nginx.org/packages/mainline/ubuntu</a> <code>lsb_release -cs</code> nginx” \     | sudo tee /etc/apt/sources.list.d/nginx.list </p></blockquote><p>设置存储库固定，以优先选择我们的软件包而不是分发版提供的软件包：</p><blockquote><p>echo -e “Package: *\nPin: origin nginx.org\nPin: release o=nginx\nPin-Priority: 900\n” \     | sudo tee /etc/apt/preferences.d/99nginx </p></blockquote><p>要安装 nginx，请运行以下命令：</p><blockquote><p>sudo apt update<br>sudo apt install nginx </p></blockquote><h4 id="源码简单安装和yum安装的差异："><a href="#源码简单安装和yum安装的差异：" class="headerlink" title="源码简单安装和yum安装的差异："></a>源码简单安装和yum安装的差异：</h4><p>这里先介绍一个命令: <code>./nginx -V</code>,通过该命令可以查看到所安装Nginx的版本及相关配置信息。</p><p>简单安装</p><p><img src="https://img-blog.csdnimg.cn/536246c7b0b14e2b829f3427331902a0.png" alt="在这里插入图片描述"></p><p>yum安装</p><p><img src="https://img-blog.csdnimg.cn/e555308fb24f403ebe28bd2e6123d72a.png" alt="在这里插入图片描述"></p><h5 id="解压Nginx目录"><a href="#解压Nginx目录" class="headerlink" title="解压Nginx目录"></a>解压Nginx目录</h5><p>执行<code>tar -zxvf nginx-1.16.1.tar.gz</code>对下载的资源进行解压缩，进入压缩后的目录，可以看到如下结构</p><p><img src="https://img-blog.csdnimg.cn/f469df49ced843daa6bd1457b435d1ed.png" alt="在这里插入图片描述"></p><p>内容解释：</p><p>auto:存放的是编译相关的脚本</p><p>CHANGES:版本变更记录</p><p>CHANGES.ru:俄罗斯文的版本变更记录</p><p>conf:nginx默认的配置文件</p><p>configure:nginx软件的自动脚本程序,是一个比较重要的文件，作用如下：</p><pre><code>（1）检测环境及根据环境检测结果生成C代码（2）生成编译代码需要的Makefile文件</code></pre><p>contrib:存放的是几个特殊的脚本文件，其中README中对脚本有着详细的说明</p><p>html:存放的是Nginx自带的两个html页面，访问Nginx的首页和错误页面</p><p>LICENSE:许可证的相关描述文件</p><p>man:nginx的man手册</p><p>README:Nginx的阅读指南</p><p>src:Nginx的源代码</p><h4 id="方案四-Nginx的源码复杂安装"><a href="#方案四-Nginx的源码复杂安装" class="headerlink" title="方案四:Nginx的源码复杂安装"></a>方案四:Nginx的源码复杂安装</h4><p>这种方式和简单的安装配置不同的地方在第一步，通过<code>./configure</code>来对编译参数进行设置，需要我们手动来指定。那么都有哪些参数可以进行设置，接下来我们进行一个详细的说明。</p><p>PATH:是和路径相关的配置信息</p><p>with:是启动模块，默认是关闭的</p><p>without:是关闭模块，默认是开启的</p><p>我们先来认识一些简单的路径配置已经通过这些配置来完成一个简单的编译：</p><p>–prefix=PATH</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向Nginx的安装目录，默认值为/usr/local/nginx</span><br></pre></td></tr></table></figure><p>–sbin-path=PATH</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向(执行)程序文件(nginx)的路径,默认值为&lt;prefix&gt;/sbin/nginx</span><br></pre></td></tr></table></figure><p>–modules-path=PATH</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向Nginx动态模块安装目录，默认值为&lt;prefix&gt;/modules</span><br></pre></td></tr></table></figure><p>–conf-path=PATH</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向配置文件(nginx.conf)的路径,默认值为&lt;prefix&gt;/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>–error-log-path=PATH</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向错误日志文件的路径,默认值为&lt;prefix&gt;/logs/error.log</span><br></pre></td></tr></table></figure><p>–http-log-path=PATH</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向访问日志文件的路径,默认值为&lt;prefix&gt;/logs/access.log</span><br></pre></td></tr></table></figure><p>–pid-path=PATH</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向Nginx启动后进行ID的文件路径，默认值为&lt;prefix&gt;/logs/nginx.pid</span><br></pre></td></tr></table></figure><p>–lock-path=PATH</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指向Nginx锁文件的存放路径,默认值为&lt;prefix&gt;/logs/nginx.lock</span><br></pre></td></tr></table></figure><p>要想使用可以通过如下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx \</span><br><span class="line">--sbin-path=/usr/local/nginx/sbin/nginx \</span><br><span class="line">--modules-path=/usr/local/nginx/modules \</span><br><span class="line">--conf-path=/usr/local/nginx/conf/nginx.conf \</span><br><span class="line">--error-log-path=/usr/local/nginx/logs/error.log \</span><br><span class="line">--http-log-path=/usr/local/nginx/logs/access.log \</span><br><span class="line">--pid-path=/usr/local/nginx/logs/nginx.pid \</span><br><span class="line">--lock-path=/usr/local/nginx/logs/nginx.lock</span><br></pre></td></tr></table></figure><p>在使用上述命令之前，需要将之前服务器已经安装的nginx进行卸载，卸载的步骤分为三步骤：</p><p>步骤一：需要将nginx的进程关闭</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s stop</span><br></pre></td></tr></table></figure><p>步骤二:将安装的nginx进行删除</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /usr/local/nginx</span><br></pre></td></tr></table></figure><p>步骤三:将安装包之前编译的环境清除掉</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure><h3 id="Nginx目录结构分析"><a href="#Nginx目录结构分析" class="headerlink" title="Nginx目录结构分析"></a>Nginx目录结构分析</h3><p>在使用Nginx之前，我们先对安装好的Nginx目录文件进行一个分析，在这块给大家介绍一个工具tree，通过tree我们可以很方面的去查看centos系统上的文件目录结构，当然，如果想使用tree工具，就得先通过<code>yum install -y tree</code>来进行安装，安装成功后，可以通过执行<code>tree /usr/local/nginx</code>(tree后面跟的是Nginx的安装目录)，获取的结果如下：</p><p><img src="https://img-blog.csdnimg.cn/3618a28076f74fa3b99677b38153a367.png" alt="在这里插入图片描述"></p><p>conf:nginx所有配置文件目录</p><pre><code>CGI(Common Gateway Interface)通用网关【接口】，主要解决的问题是从客户端发送一个请求和数据，服务端获取到请求和数据后可以调用调用CGI【程序】处理及相应结果给客户端的一种标准规范。fastcgi.conf:fastcgi相关配置文件fastcgi.conf.default:fastcgi.conf的备份文件fastcgi_params:fastcgi的参数文件fastcgi_params.default:fastcgi的参数备份文件scgi_params:scgi的参数文件scgi_params.default：scgi的参数备份文件uwsgi_params:uwsgi的参数文件uwsgi_params.default:uwsgi的参数备份文件mime.types:记录的是HTTP协议中的Content-Type的值和文件后缀名的对应关系mime.types.default:mime.types的备份文件nginx.conf:这个是Nginx的核心配置文件，这个文件非常重要，也是我们即将要学习的重点nginx.conf.default:nginx.conf的备份文件koi-utf、koi-win、win-utf这三个文件都是与编码转换映射相关的配置文件，用来将一种编码转换成另一种编码</code></pre><p>html:存放nginx自带的两个静态的html页面</p><pre><code>50x.html:访问失败后的失败页面index.html:成功访问的默认首页</code></pre><p>logs:记录入门的文件，当nginx服务器启动后，这里面会有 access.log error.log 和nginx.pid三个文件出现。</p><p>sbin:是存放执行程序文件nginx</p><pre><code>nginx是用来控制Nginx的启动和停止等相关的命令。</code></pre><h3 id="Nginx服务器启停命令"><a href="#Nginx服务器启停命令" class="headerlink" title="Nginx服务器启停命令"></a>Nginx服务器启停命令</h3><p>Nginx安装完成后，接下来我们要学习的是如何启动、重启和停止Nginx的服务。</p><p>对于Nginx的启停在linux系统中也有很多种方式，我们本次课程介绍两种方式：</p><ol><li> Nginx服务的信号控制 </li><li> Nginx的命令行控制 </li></ol><h4 id="方式一-Nginx服务的信号控制"><a href="#方式一-Nginx服务的信号控制" class="headerlink" title="方式一:Nginx服务的信号控制"></a>方式一:Nginx服务的信号控制</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Nginx中的master和worker进程?</span><br><span class="line">Nginx的工作方式?</span><br><span class="line">如何获取进程的PID?</span><br><span class="line">信号有哪些?</span><br><span class="line">如何通过信号控制Nginx的启停等相关操作?</span><br></pre></td></tr></table></figure><p>前面在提到Nginx的高性能，其实也和它的架构模式有关。Nginx默认采用的是多进程的方式来工作的，当将Nginx启动后，我们通过<code>ps -ef | grep nginx</code>命令可以查看到如下内容：</p><p><img src="https://img-blog.csdnimg.cn/7f33b9276e3a44d886f29e7efe998b15.png" alt="在这里插入图片描述"></p><p>从上图中可以看到,Nginx后台进程中包含一个master进程和多个worker进程，master进程主要用来管理worker进程，包含接收外界的信息，并将接收到的信号发送给各个worker进程，监控worker进程的状态，当worker进程出现异常退出后，会自动重新启动新的worker进程。而worker进程则是专门用来处理用户请求的，各个worker进程之间是平等的并且相互独立，处理请求的机会也是一样的。nginx的进程模型，我们可以通过下图来说明下：</p><p><img src="https://img-blog.csdnimg.cn/7e0a8fddde3a46998298f314e2c95f93.png" alt="在这里插入图片描述"></p><p>我们现在作为管理员，只需要通过给master进程发送信号就可以来控制Nginx,这个时候我们需要有两个前提条件，一个是要操作的master进程，一个是信号。</p><p>（1）要想操作Nginx的master进程，就需要获取到master进程的进程号ID。获取方式简单介绍两个，</p><p>方式一：通过<code>ps -ef | grep nginx</code>；</p><p>方式二：在讲解nginx的<code>./configure</code>的配置参数的时候，有一个参数是<code>--pid-path=PATH</code>默认是<code>/usr/local/nginx/logs/nginx.pid</code>,所以可以通过查看该文件来获取nginx的master进程ID.</p><p>（2）信号</p><table><thead><tr><th>信号</th><th>作用</th></tr></thead><tbody><tr><td>TERM/INT</td><td>立即关闭整个服务</td></tr><tr><td>QUIT</td><td>“优雅”地关闭整个服务</td></tr><tr><td>HUP</td><td>重读配置文件并使用服务对新配置项生效</td></tr><tr><td>USR1</td><td>重新打开日志文件，可以用来进行日志切割</td></tr><tr><td>USR2</td><td>平滑升级到最新版的nginx</td></tr><tr><td>WINCH</td><td>所有子进程不在接收处理新连接，相当于给work进程发送QUIT指令</td></tr></tbody></table><p>调用命令为<code>kill -signal PID</code></p><p>signal:即为信号；PID即为获取到的master线程ID</p><ol><li>发送TERM/INT信号给master进程，会将Nginx服务立即关闭。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill -TERM PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br><span class="line">kill -INT PID / kill -INT `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><ol start="2"><li>发送QUIT信号给master进程，master进程会控制所有的work进程不再接收新的请求，等所有请求处理完后，在把进程都关闭掉。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><ol start="3"><li>发送HUP信号给master进程，master进程会把控制旧的work进程不再接收新的请求，等处理完请求后将旧的work进程关闭掉，然后根据nginx的配置文件重新启动新的work进程</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -HUP PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><ol start="4"><li>发送USR1信号给master进程，告诉Nginx重新开启日志文件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -USR1 PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><ol start="5"><li>发送USR2信号给master进程，告诉master进程要平滑升级，这个时候，会重新开启对应的master进程和work进程，整个系统中将会有两个master进程，并且新的master进程的PID会被记录在<code>/usr/local/nginx/logs/nginx.pid</code>而之前的旧的master进程PID会被记录在<code>/usr/local/nginx/logs/nginx.pid.oldbin</code>文件中，接着再次发送QUIT信号给旧的master进程，让其处理完请求后再进行关闭</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -USR2 PID / kill -USR2 `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT PID / kill -QUIT `cat /usr/local/nginx/logs/nginx.pid.oldbin`</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/19b6c57eca9248748a6be54f83e34c4c.png" alt="在这里插入图片描述"></p><ol start="6"><li>发送WINCH信号给master进程,让master进程控制不让所有的work进程在接收新的请求了，请求处理完后关闭work进程。注意master进程不会被关闭掉</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -WINCH PID /kill -WINCH`cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><h4 id="方式二-Nginx的命令行控制"><a href="#方式二-Nginx的命令行控制" class="headerlink" title="方式二:Nginx的命令行控制"></a>方式二:Nginx的命令行控制</h4><p>此方式是通过Nginx安装目录下的sbin下的可执行文件nginx来进行Nginx状态的控制，我们可以通过<code>nginx -h</code>来查看都有哪些参数可以用：</p><p><img src="https://img-blog.csdnimg.cn/41d45ce5ab974dd995aa9c10f0d68b09.png" alt="在这里插入图片描述"></p><p>-?和-h:显示帮助信息</p><p>-v:打印版本号信息并退出</p><p>-V:打印版本号信息和配置信息并退出</p><p>-t:测试nginx的配置文件语法是否正确并退出</p><p>-T:测试nginx的配置文件语法是否正确并列出用到的配置文件信息然后退出</p><p>-q:在配置测试期间禁止显示非错误消息</p><p>-s:signal信号，后面可以跟 ：</p><pre><code> stop[快速关闭，类似于TERM/INT信号的作用]quit[优雅的关闭，类似于QUIT信号的作用]reopen[重新打开日志文件类似于USR1信号的作用]reload[类似于HUP信号的作用]</code></pre><p>-p:prefix，指定Nginx的prefix路径，(默认为: /usr/local/nginx/)</p><p>-c:filename,指定Nginx的配置文件路径,(默认为: conf/nginx.conf)</p><p>-g:用来补充Nginx配置文件，向Nginx服务指定启动时应用全局的配置</p><h3 id="Nginx服务器版本升级和新增模块"><a href="#Nginx服务器版本升级和新增模块" class="headerlink" title="Nginx服务器版本升级和新增模块"></a>Nginx服务器版本升级和新增模块</h3><p>如果想对Nginx的版本进行更新，或者要应用一些新的模块，最简单的做法就是停止当前的Nginx服务，然后开启新的Nginx服务。但是这样会导致在一段时间内，用户是无法访问服务器。为了解决这个问题，我们就需要用到Nginx服务器提供的平滑升级功能。这个也是Nginx的一大特点，使用这种方式，就可以使Nginx在7*24小时不间断的提供服务了。接下来我们分析下需求：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需求：Nginx的版本最开始使用的是Nginx-1.14.2,由于服务升级，需要将Nginx的版本升级到Nginx-1.16.1,要求Nginx不能中断提供服务。</span><br></pre></td></tr></table></figure><p>为了应对上述的需求，这里我们给大家提供两种解决方案:</p><p>方案一:使用Nginx服务信号完成Nginx的升级</p><p>方案二:使用Nginx安装目录的make命令完成升级</p><h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h4><p>（1）先准备两个版本的Nginx分别是 1.14.2和1.16.1</p><p>（2）使用Nginx源码安装的方式将1.14.2版本安装成功并正确访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">进入安装目录</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>（3）将Nginx1.16.1进行参数配置和编译，不需要进行安装。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">进入安装目录</span><br><span class="line">./configure</span><br><span class="line">make</span><br></pre></td></tr></table></figure><h4 id="方案一-使用Nginx服务信号进行升级"><a href="#方案一-使用Nginx服务信号进行升级" class="headerlink" title="方案一:使用Nginx服务信号进行升级"></a>方案一:使用Nginx服务信号进行升级</h4><p>第一步:将1.14.2版本的sbin目录下的nginx进行备份</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin</span><br><span class="line">mv nginx nginxold</span><br></pre></td></tr></table></figure><p>第二步:将Nginx1.16.1安装目录编译后的objs目录下的nginx文件，拷贝到原来<code>/usr/local/nginx/sbin</code>目录下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/nginx/core/nginx-1.16.1/objs</span><br><span class="line">cp nginx /usr/local/nginx/sbin</span><br></pre></td></tr></table></figure><p>第三步:发送信号USR2给Nginx的1.14.2版本对应的master进程</p><p>第四步:发送信号QUIT给Nginx的1.14.2版本对应的master进程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT `more /usr/local/logs/nginx.pid.oldbin`</span><br></pre></td></tr></table></figure><h4 id="方案二-使用Nginx安装目录的make命令完成升级"><a href="#方案二-使用Nginx安装目录的make命令完成升级" class="headerlink" title="方案二:使用Nginx安装目录的make命令完成升级"></a>方案二:使用Nginx安装目录的make命令完成升级</h4><p>第一步:将1.14.2版本的sbin目录下的nginx进行备份</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin</span><br><span class="line">mv nginx nginxold</span><br></pre></td></tr></table></figure><p>第二步:将Nginx1.16.1安装目录编译后的objs目录下的nginx文件，拷贝到原来<code>/usr/local/nginx/sbin</code>目录下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/nginx/core/nginx-1.16.1/objs</span><br><span class="line">cp nginx /usr/local/nginx/sbin</span><br></pre></td></tr></table></figure><p>第三步:进入到安装目录，执行<code>make upgrade</code></p><p><img src="https://img-blog.csdnimg.cn/2c2d3b36a9bd4559a2e710fb163b6649.png" alt="在这里插入图片描述"></p><p>第四步:查看是否更新成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -v</span><br></pre></td></tr></table></figure><p>在整个过程中，其实Nginx是一直对外提供服务的。并且当Nginx的服务器启动成功后，我们是可以通过浏览器进行直接访问的，同时我们可以通过更改html目录下的页面来修改我们在页面上所看到的内容，那么问题来了，为什么我们要修改html目录下的文件，能不能多添加一些页面是Nginx的功能更加丰富，还有前面聊到Nginx的前端功能又是如何来实现的，这就需要我们对Nginx的核心配置文件进行一个详细的学习。</p><h2 id="Nginx核心配置文件结构"><a href="#Nginx核心配置文件结构" class="headerlink" title="Nginx核心配置文件结构"></a>Nginx核心配置文件结构</h2><p>从前面的内容学习中，我们知道Nginx的核心配置文件默认是放在<code>/usr/local/nginx/conf/nginx.conf</code>，这一节，我们就来学习下nginx.conf的内容和基本配置方法。</p><p>读取Nginx自带的Nginx配置文件，我们将其中的注释部分【学习一个技术点就是在Nginx的配置文件中可以使用<code>#</code>来注释】删除掉后，就剩下下面内容:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">指令名指令值;  #全局块，主要设置Nginx服务器整体运行的配置指令</span><br><span class="line"></span><br><span class="line"> #events块,主要设置,Nginx服务器与用户的网络连接,这一部分对Nginx服务器的性能影响较大</span><br><span class="line">events &#123; </span><br><span class="line">    指令名指令值;</span><br><span class="line">&#125;</span><br><span class="line">#http块，是Nginx服务器配置中的重要部分，代理、缓存、日志记录、第三方模块配置...             </span><br><span class="line">http &#123;</span><br><span class="line">    指令名指令值;</span><br><span class="line">    server &#123; #server块，是Nginx配置和虚拟主机相关的内容</span><br><span class="line">        指令名指令值;</span><br><span class="line">        location / &#123; </span><br><span class="line">        #location块，基于Nginx服务器接收请求字符串与location后面的值进行匹配，对特定请求进行处理</span><br><span class="line">            指令名指令值;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简单小结下:</p><p>nginx.conf配置文件中默认有三大块：全局块、events块、http块</p><p>http块中可以配置多个server块，每个server块又可以配置多个location块。</p><h3 id="全局块"><a href="#全局块" class="headerlink" title="全局块"></a>全局块</h3><h4 id="user指令"><a href="#user指令" class="headerlink" title="user指令"></a>user指令</h4><p>（1）user:用于配置运行Nginx服务器的worker进程的用户和用户组。</p><table><thead><tr><th>语法</th><th>user user [group]</th></tr></thead><tbody><tr><td>默认值</td><td>nobody</td></tr><tr><td>位置</td><td>全局块</td></tr></tbody></table><p>该属性也可以在编译的时候指定，语法如下<code>./configure --user=user --group=group</code>,如果两个地方都进行了设置，最终生效的是配置文件中的配置。</p><p>该指令的使用步骤:</p><p>(1)设置一个用户信息”www”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user www;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/13bd1b9488b34c2b9184a9f5fc671f00.png" alt="在这里插入图片描述"></p><p>(2) 创建一个用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd www</span><br></pre></td></tr></table></figure><p>(3)修改user属性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user www</span><br></pre></td></tr></table></figure><p>(4)创建<code>/root/html/index.html</code>页面，添加如下内容</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">35em</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>I am WWW<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>(5)修改nginx.conf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">root   /root/html;</span><br><span class="line">index  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(5)测试启动访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">页面会报403拒绝访问的错误</span><br></pre></td></tr></table></figure><p>(6)分析原因</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为当前用户没有访问/root/html目录的权限</span><br></pre></td></tr></table></figure><p>(7)将文件创建到 <code>/home/www/html/index.html</code>,修改配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">root   /home/www/html;</span><br><span class="line">index  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(8)再次测试启动访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">能正常访问。</span><br></pre></td></tr></table></figure><p>综上所述，使用user指令可以指定启动运行工作进程的用户及用户组，这样对于系统的权限访问控制的更加精细，也更加安全。</p><h4 id="work-process指令"><a href="#work-process指令" class="headerlink" title="work process指令"></a>work process指令</h4><p>master_process:用来指定是否开启工作进程。</p><table><thead><tr><th>语法</th><th>master_process on&#124;off;</th></tr></thead><tbody><tr><td>默认值</td><td>master_process on;</td></tr><tr><td>位置</td><td>全局块</td></tr></tbody></table><p>worker_processes:用于配置Nginx生成工作进程的数量，这个是Nginx服务器实现并发处理服务的关键所在。理论上来说workder process的值越大，可以支持的并发处理量也越多，但事实上这个值的设定是需要受到来自服务器自身的限制，建议将该值和服务器CPU的内核数保存一致。</p><table><thead><tr><th>语法</th><th>worker_processes     num/auto;</th></tr></thead><tbody><tr><td>默认值</td><td>1</td></tr><tr><td>位置</td><td>全局块</td></tr></tbody></table><p>如果将worker_processes设置成2，则会看到如下内容:</p><p><img src="https://img-blog.csdnimg.cn/6a280d7824ef45fea4f6c22f40f9881b.png" alt="在这里插入图片描述"></p><h4 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h4><p>daemon：设定Nginx是否以守护进程的方式启动。</p><p>守护式进程是linux后台执行的一种服务进程，特点是独立于控制终端，不会随着终端关闭而停止。</p><table><thead><tr><th>语法</th><th>daemon on&#124;off;</th></tr></thead><tbody><tr><td>默认值</td><td>daemon on;</td></tr><tr><td>位置</td><td>全局块</td></tr></tbody></table><p>pid:用来配置Nginx当前master进程的进程号ID存储的文件路径。</p><table><thead><tr><th>语法</th><th>pid file;</th></tr></thead><tbody><tr><td>默认值</td><td>默认为:/usr/local/nginx/logs/nginx.pid</td></tr><tr><td>位置</td><td>全局块</td></tr></tbody></table><p>该属性可以通过<code>./configure --pid-path=PATH</code>来指定</p><p>error_log:用来配置Nginx的错误日志存放路径</p><table><thead><tr><th>语法</th><th>error_log  file [日志级别];</th></tr></thead><tbody><tr><td>默认值</td><td>error_log logs/error.log error;</td></tr><tr><td>位置</td><td>全局块、http、server、location</td></tr></tbody></table><p>该属性可以通过<code>./configure --error-log-path=PATH</code>来指定</p><p>其中日志级别的值有：debug|info|notice|warn|error|crit|alert|emerg，翻译过来为试|信息|通知|警告|错误|临界|警报|紧急，这块建议大家设置的时候不要设置成info以下的等级，因为会带来大量的磁盘I/O消耗，影响Nginx的性能。</p><p>（5）include:用来引入其他配置文件，使Nginx的配置更加灵活</p><table><thead><tr><th>语法</th><th>include file;</th></tr></thead><tbody><tr><td>默认值</td><td>无</td></tr><tr><td>位置</td><td>any</td></tr></tbody></table><h3 id="events块"><a href="#events块" class="headerlink" title="events块"></a>events块</h3><p>（1）accept_mutex:用来设置Nginx网络连接序列化</p><table><thead><tr><th>语法</th><th>accept_mutex on&#124;off;</th></tr></thead><tbody><tr><td>默认值</td><td>accept_mutex on;</td></tr><tr><td>位置</td><td>events</td></tr></tbody></table><p>这个配置主要可以用来解决常说的”惊群”问题。大致意思是在某一个时刻，客户端发来一个请求连接，Nginx后台是以多进程的工作模式，也就是说有多个worker进程会被同时唤醒，但是最终只会有一个进程可以获取到连接，如果每次唤醒的进程数目太多，就会影响Nginx的整体性能。如果将上述值设置为on(开启状态)，将会对多个Nginx进程接收连接进行序列号，一个个来唤醒接收，就防止了多个进程对连接的争抢。</p><p><img src="https://img-blog.csdnimg.cn/4b35ad6b8bf14f8189a670f60158b941.png" alt="在这里插入图片描述"></p><p>（2）multi_accept:用来设置是否允许同时接收多个网络连接</p><table><thead><tr><th>语法</th><th>multi_accept on&#124;off;</th></tr></thead><tbody><tr><td>默认值</td><td>multi_accept off;</td></tr><tr><td>位置</td><td>events</td></tr></tbody></table><p>如果multi_accept被禁止了，nginx一个工作进程只能同时接受一个新的连接。否则，一个工作进程可以同时接受所有的新连接</p><p>（3）worker_connections：用来配置单个worker进程最大的连接数</p><table><thead><tr><th>语法</th><th>worker_connections number;</th></tr></thead><tbody><tr><td>默认值</td><td>worker_commections 512;</td></tr><tr><td>位置</td><td>events</td></tr></tbody></table><p>这里的连接数不仅仅包括和前端用户建立的连接数，而是包括所有可能的连接数。另外，number值不能大于操作系统支持打开的最大文件句柄数量。</p><p>（4）use:用来设置Nginx服务器选择哪种事件驱动来处理网络消息。</p><table><thead><tr><th>语法</th><th>use  method;</th></tr></thead><tbody><tr><td>默认值</td><td>根据操作系统定</td></tr><tr><td>位置</td><td>events</td></tr></tbody></table><p>注意：此处所选择事件处理模型是Nginx优化部分的一个重要内容，method的可选值有select/poll/epoll/kqueue等，之前在准备centos环境的时候，我们强调过要使用linux内核在2.6以上，就是为了能使用epoll函数来优化Nginx。</p><p>另外这些值的选择，我们也可以在编译的时候使用</p><p><code>--with-select_module</code>、<code>--without-select_module</code>、</p><p><code>--with-poll_module</code>、<code>--without-poll_module</code>来设置是否需要将对应的事件驱动模块编译到Nginx的内核。</p><h4 id="events指令配置实例"><a href="#events指令配置实例" class="headerlink" title="events指令配置实例"></a>events指令配置实例</h4><p>打开Nginx的配置文件 nginx.conf,添加如下配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">events&#123;</span><br><span class="line">accept_mutex on;</span><br><span class="line">multi_accept on;</span><br><span class="line">worker_commections 1024;</span><br><span class="line">use epoll;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动测试</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./nginx -t</span><br><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="http块"><a href="#http块" class="headerlink" title="http块"></a>http块</h3><h4 id="定义MIME-Type"><a href="#定义MIME-Type" class="headerlink" title="定义MIME-Type"></a>定义MIME-Type</h4><p>我们都知道浏览器中可以显示的内容有HTML、XML、GIF等种类繁多的文件、媒体等资源，浏览器为了区分这些资源，就需要使用MIME Type。所以说MIME Type是网络资源的媒体类型。Nginx作为web服务器，也需要能够识别前端请求的资源类型。</p><p>在Nginx的配置文件中，默认有两行配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include mime.types;</span><br><span class="line">default_type application/octet-stream;</span><br></pre></td></tr></table></figure><p>（1）default_type:用来配置Nginx响应前端请求默认的MIME类型。</p><table><thead><tr><th>语法</th><th>default_type mime-type;</th></tr></thead><tbody><tr><td>默认值</td><td>default_type text/plain；</td></tr><tr><td>位置</td><td>http、server、location</td></tr></tbody></table><p>在default_type之前还有一句<code>include mime.types</code>,include之前我们已经介绍过，相当于把mime.types文件中MIMT类型与相关类型文件的文件后缀名的对应关系加入到当前的配置文件中。</p><p>举例来说明：</p><p>有些时候请求某些接口的时候需要返回指定的文本字符串或者json字符串，如果逻辑非常简单或者干脆是固定的字符串，那么可以使用nginx快速实现，这样就不用编写程序响应请求了，可以减少服务器资源占用并且响应性能非常快。</p><p>如何实现:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location /get_text &#123;</span><br><span class="line">#这里也可以设置成text/plain</span><br><span class="line">    default_type text/html;</span><br><span class="line">    return 200 &quot;This is nginx&#x27;s text&quot;;</span><br><span class="line">&#125;</span><br><span class="line">location /get_json&#123;</span><br><span class="line">    default_type application/json;</span><br><span class="line">    return 200 &#x27;&#123;&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18&#125;&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="自定义服务日志"><a href="#自定义服务日志" class="headerlink" title="自定义服务日志"></a>自定义服务日志</h4><p>Nginx中日志的类型分access.log、error.log。</p><p>access.log:用来记录用户所有的访问请求。</p><p>error.log:记录nginx本身运行时的错误信息，不会记录用户的访问请求。</p><p>Nginx服务器支持对服务日志的格式、大小、输出等进行设置，需要使用到两个指令，分别是access_log和log_format指令。</p><p>（1）access_log:用来设置用户访问日志的相关属性。</p><table><thead><tr><th>语法</th><th>access_log path[format[buffer=size]]</th></tr></thead><tbody><tr><td>默认值</td><td>access_log logs/access.log combined;</td></tr></tbody></table><p>| 位置 | <code>http</code><br>, <code>server</code><br>, <code>location</code> |</p><p>（2）log_format:用来指定日志的输出格式。</p><table><thead><tr><th>语法</th><th>log_format name [escape=default&#124;json&#124;none] string….;</th></tr></thead><tbody><tr><td>默认值</td><td>log_format combined “…”;</td></tr><tr><td>位置</td><td>http</td></tr></tbody></table><h4 id="其他配置指令"><a href="#其他配置指令" class="headerlink" title="其他配置指令"></a>其他配置指令</h4><p>（1）sendfile:用来设置Nginx服务器是否使用sendfile()传输文件，该属性可以大大提高Nginx处理静态资源的性能</p><table><thead><tr><th>语法</th><th>sendfile on&#124;off；</th></tr></thead><tbody><tr><td>默认值</td><td>sendfile off;</td></tr><tr><td>位置</td><td>http、server、location</td></tr></tbody></table><p>（2）keepalive_timeout:用来设置长连接的超时时间。</p><p>》为什么要使用keepalive？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我们都知道HTTP是一种无状态协议，客户端向服务端发送一个TCP请求，服务端响应完毕后断开连接。</span><br><span class="line">如何客户端向服务端发送多个请求，每个请求都需要重新创建一次连接，效率相对来说比较多，使用keepalive模式，可以告诉服务器端在处理完一个请求后保持这个TCP连接的打开状态，若接收到来自这个客户端的其他请求，服务端就会利用这个未被关闭的连接，而不需要重新创建一个新连接，提升效率，但是这个连接也不能一直保持，这样的话，连接如果过多，也会是服务端的性能下降，这个时候就需要我们进行设置其的超时时间。</span><br></pre></td></tr></table></figure><table><thead><tr><th>语法</th><th>keepalive_timeout time;</th></tr></thead><tbody><tr><td>默认值</td><td>keepalive_timeout 75s;</td></tr><tr><td>位置</td><td>http、server、location</td></tr></tbody></table><p>（3）keepalive_requests:用来设置一个keep-alive连接使用的次数。</p><table><thead><tr><th>语法</th><th>keepalive_requests number;</th></tr></thead><tbody><tr><td>默认值</td><td>keepalive_requests 100;</td></tr><tr><td>位置</td><td>http、server、location</td></tr></tbody></table><h3 id="server块和location块"><a href="#server块和location块" class="headerlink" title="server块和location块"></a>server块和location块</h3><p>server块和location块都是我们要重点讲解和学习的内容，因为我们后面会对Nginx的功能进行详细讲解，所以这块内容就放到静态资源部署的地方给大家详细说明。</p><p>本节我们主要来认识下Nginx默认给的nginx.conf中的相关内容，以及server块与location块在使用的时候需要注意的一些内容。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">       listen       80;</span><br><span class="line">       server_name  localhost;</span><br><span class="line">       location / &#123;</span><br><span class="line">           root   html;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">       &#125;</span><br><span class="line">      </span><br><span class="line">       error_page   500 502 503 504 404  /50x.html;</span><br><span class="line">       location = /50x.html &#123;</span><br><span class="line">           root   html;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;学习的过程中发现有现成的笔记，所以就不再自己写了&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Nginx简介&quot;&gt;&lt;a href=&quot;#Nginx简介&quot; class=&quot;headerlink&quot; title=&quot;Nginx简介&quot;&gt;&lt;/a&gt;Nginx简</summary>
      
    
    
    
    <category term="Nginx" scheme="https://kallenblue.github.io/categories/Nginx/"/>
    
    
  </entry>
  
  <entry>
    <title>微服务-Nacos配置原理</title>
    <link href="https://kallenblue.github.io/2022/10/16/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Nacos%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/"/>
    <id>https://kallenblue.github.io/2022/10/16/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Nacos%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/</id>
    <published>2022-10-16T13:39:07.000Z</published>
    <updated>2022-10-16T15:20:05.732Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Nacos实现配置管理"><a href="#Nacos实现配置管理" class="headerlink" title="Nacos实现配置管理"></a>Nacos实现配置管理</h1><ul><li><p>配置管理原理<br><img src="https://img-blog.csdnimg.cn/14fdc99f14194aa2b23ea354a8eb2dd6.png"></p></li><li><p>配置过程<br><img src="https://img-blog.csdnimg.cn/5ba551988503426bbde0b1f4bbab30ce.png"><br><img src="https://img-blog.csdnimg.cn/f80003109f884e4ea5b9a72d1fa39cd1.png"></p><h1 id="微服务配置拉取"><a href="#微服务配置拉取" class="headerlink" title="微服务配置拉取"></a>微服务配置拉取</h1><h2 id="配置获取步骤"><a href="#配置获取步骤" class="headerlink" title="配置获取步骤"></a>配置获取步骤</h2><p><img src="https://img-blog.csdnimg.cn/f7b070c0ad6d4ef49f5b8b87958e9660.png"></p></li><li><p>1.引入Nacos的配置管理客户端依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos的配置管理依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>2.在resource目录添加一个bootstrap.yml文件，这个文件是引导文件，优先级高于application.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 环境</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">nacos:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br></pre></td></tr></table></figure><h1 id="配置热更新"><a href="#配置热更新" class="headerlink" title="配置热更新"></a>配置热更新</h1><p><img src="https://img-blog.csdnimg.cn/bfd904f84f4840f9b608dbddd218d995.png"><br><img src="https://img-blog.csdnimg.cn/1c25ff68b8b94656a73740768fc7058b.png"><br><img src="https://img-blog.csdnimg.cn/54f67e45ce324a31a5b5724afc22bbc7.png"></p><h1 id="多环境配置共享"><a href="#多环境配置共享" class="headerlink" title="多环境配置共享"></a>多环境配置共享</h1><p><img src="https://img-blog.csdnimg.cn/e2dc4cbe9f3c4fdfbb07990e3642e27d.png"></p></li><li><p>多环境配置优先级<br><img src="https://img-blog.csdnimg.cn/1372486e741b410d96fe6c265aae0f67.png"></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Nacos实现配置管理&quot;&gt;&lt;a href=&quot;#Nacos实现配置管理&quot; class=&quot;headerlink&quot; title=&quot;Nacos实现配置管理&quot;&gt;&lt;/a&gt;Nacos实现配置管理&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;配置管理原理&lt;br&gt;&lt;img src=&quot;https</summary>
      
    
    
    
    <category term="微服务" scheme="https://kallenblue.github.io/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>微服务-Nacos</title>
    <link href="https://kallenblue.github.io/2022/10/14/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Nacos/"/>
    <id>https://kallenblue.github.io/2022/10/14/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Nacos/</id>
    <published>2022-10-14T09:16:21.000Z</published>
    <updated>2022-10-16T13:38:13.442Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Nacos安装指南"><a href="#Nacos安装指南" class="headerlink" title="Nacos安装指南"></a>Nacos安装指南</h1><h2 id="1-Windows安装"><a href="#1-Windows安装" class="headerlink" title="1.Windows安装"></a>1.Windows安装</h2><p>开发阶段采用单机安装即可。</p><h3 id="1-1-下载安装包"><a href="#1-1-下载安装包" class="headerlink" title="1.1.下载安装包"></a>1.1.下载安装包</h3><p>在Nacos的GitHub页面，提供有下载链接，可以下载编译好的Nacos服务端或者源代码：</p><p>GitHub主页：<a href="https://github.com/alibaba/nacos">https://github.com/alibaba/nacos</a></p><p>GitHub的Release下载页：<a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p><p>如图：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/75804e9a-76b8-42d4-911e-733fa48ac570.png" alt="image-20210402161102887"></p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/50c23cae-a096-412a-9af8-3b2c0ac0fdfa.png" alt="image-20210402161130261"></p><p>windows版本使用<code>nacos-server-1.4.1.zip</code>包即可。</p><h3 id="1-2-解压"><a href="#1-2-解压" class="headerlink" title="1.2.解压"></a>1.2.解压</h3><p>将这个包解压到任意非中文目录下，如图：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/3b1886ca-470e-47cb-a193-dae5ad063fee.png" alt="image-20210402161843337"></p><p>目录说明：</p><ul><li>bin：启动脚本</li><li>conf：配置文件</li></ul><h3 id="1-3-端口配置"><a href="#1-3-端口配置" class="headerlink" title="1.3.端口配置"></a>1.3.端口配置</h3><p>Nacos的默认端口是8848，如果你电脑上的其它进程占用了8848端口，请先尝试关闭该进程。</p><p><strong>如果无法关闭占用8848端口的进程</strong>，也可以进入nacos的conf目录，修改配置文件中的端口：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/121512b7-8fb2-431e-ab02-a348ca4adc56.png" alt="image-20210402162008280"></p><p>修改其中的内容：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/cd17c06a-cc4e-4e50-afe6-0d2063e52f5d.png" alt="image-20210402162251093"></p><h3 id="1-4-启动"><a href="#1-4-启动" class="headerlink" title="1.4.启动"></a>1.4.启动</h3><p>启动非常简单，进入bin目录，结构如下：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/8fd9af97-7b53-41fd-b3ee-438af9121e82.png" alt="image-20210402162350977"></p><blockquote><p>1.4.4nacos默认要求是使用集群的方式启动，集群要求至少有三台nacos服务器,所以需要修改配置</p></blockquote><p>将set MODE=”cluster”修改为set MODE=”standalone”，再次双击startup.cmd启动即可<br><img src="https://img-blog.csdnimg.cn/e6c2e0a5f2f64e14906a2cfd92841841.png"></p><p>然后执行命令即可：</p><ul><li><p>windows命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure></li></ul><p>执行后的效果如图：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/f8783315-b0b0-4462-870b-de885025d58e.png" alt="image-20210402162526774"></p><h3 id="1-5-访问"><a href="#1-5-访问" class="headerlink" title="1.5.访问"></a>1.5.访问</h3><p>在浏览器输入地址：<a href="http://127.0.0.1:8848/nacos">http://127.0.0.1:8848/nacos</a> 即可：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/3facf74a-4506-4b39-a4cb-bda3308add4d.png" alt="image-20210402162630427"></p><p>默认的账号和密码都是nacos，进入后：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/2ec50808-43df-4093-8e21-e82762d0296c.png" alt="image-20210402162709515"></p><h2 id="2-Linux安装"><a href="#2-Linux安装" class="headerlink" title="2.Linux安装"></a>2.Linux安装</h2><p>Linux或者Mac安装方式与Windows类似。</p><h3 id="2-1-安装JDK"><a href="#2-1-安装JDK" class="headerlink" title="2.1.安装JDK"></a>2.1.安装JDK</h3><p>Nacos依赖于JDK运行，索引Linux上也需要安装JDK才行。</p><p>上传jdk安装包：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/1211a2fd-f76b-46c9-8a6e-32e8e3cd9fd6.png" alt="image-20210402172334810"></p><p>上传到某个目录，例如：<code>/usr/local/</code></p><p>然后解压缩：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf jdk-8u144-linux-x64.tar.gz</span><br></pre></td></tr></table></figure><p>然后重命名为java</p><p>配置环境变量：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/java</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br></pre></td></tr></table></figure><p>设置环境变量：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h3 id="2-2-上传安装包"><a href="#2-2-上传安装包" class="headerlink" title="2.2.上传安装包"></a>2.2.上传安装包</h3><p>如图：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/26be463c-78c0-441f-b280-351e815330a6.png" alt="image-20210402161102887"></p><p>也可以直接使用tar.gz：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/50c23cae-a096-412a-9af8-3b2c0ac0fdfa.png" alt="image-20210402161130261"></p><p>上传到Linux服务器的某个目录，例如<code>/usr/local/src</code>目录下：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/e16526ca-acc2-474b-bf8c-95a5a77719e8.png" alt="image-20210402163715580"></p><h3 id="2-3-解压"><a href="#2-3-解压" class="headerlink" title="2.3.解压"></a>2.3.解压</h3><p>命令解压缩安装包：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf nacos-server-1.4.1.tar.gz</span><br></pre></td></tr></table></figure><p>然后删除安装包：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf nacos-server-1.4.1.tar.gz</span><br></pre></td></tr></table></figure><p>目录中最终样式：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/38a47218-766a-4da6-addc-8ab2b9bb59a4.png" alt="image-20210402163858429"></p><p>目录内部：</p><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/84643c32-9809-41f7-9699-bb1058019660.png" alt="image-20210402164414827"></p><h3 id="2-4-端口配置"><a href="#2-4-端口配置" class="headerlink" title="2.4.端口配置"></a>2.4.端口配置</h3><p>与windows中类似</p><h3 id="2-5-启动"><a href="#2-5-启动" class="headerlink" title="2.5.启动"></a>2.5.启动</h3><p>在nacos/bin目录中，输入命令启动Nacos：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh startup.sh -m standalone</span><br></pre></td></tr></table></figure><h1 id="Nacos注册使用"><a href="#Nacos注册使用" class="headerlink" title="Nacos注册使用"></a>Nacos注册使用</h1><h2 id="Nacos的依赖"><a href="#Nacos的依赖" class="headerlink" title="Nacos的依赖"></a>Nacos的依赖</h2><p>父工程：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos的管理依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>客户端：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacos客户端依赖包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="配置地址信息"><a href="#配置地址信息" class="headerlink" title="配置地址信息"></a>配置地址信息</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacos服务地址</span></span><br></pre></td></tr></table></figure><h1 id="Nacos服务多级存储模型"><a href="#Nacos服务多级存储模型" class="headerlink" title="Nacos服务多级存储模型"></a>Nacos服务多级存储模型</h1><h2 id="Nacos服务分级存储模型"><a href="#Nacos服务分级存储模型" class="headerlink" title="Nacos服务分级存储模型"></a>Nacos服务分级存储模型</h2><p><img src="https://img-blog.csdnimg.cn/57ad4c30b4a14ebca648a338bb1123eb.png"></p><h2 id="服务跨集群调用问题"><a href="#服务跨集群调用问题" class="headerlink" title="服务跨集群调用问题"></a>服务跨集群调用问题</h2><p><img src="https://img-blog.csdnimg.cn/ab3561fa71224c74813ea03bc653b424.png"></p><h2 id="模拟集群"><a href="#模拟集群" class="headerlink" title="模拟集群"></a>模拟集群</h2><p>在属性配置中加上集群的配置即可</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacos服务地址</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span> <span class="comment">#集群名称，代指杭州</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/42f57b7cb792429ebec140bb45110f8f.png"></p><h1 id="NacosRule负载均衡"><a href="#NacosRule负载均衡" class="headerlink" title="NacosRule负载均衡"></a>NacosRule负载均衡</h1><p>NacosRule负载均衡策略</p><ul><li>优先选择同集群服务实例列表</li><li>本地集群找不到提供者，才去其它集群寻找，并且会报警告<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10-14 23:15:11:759  WARN 25900 --- [nio-8082-exec-5] c.alibaba.cloud.nacos.ribbon.NacosRule   : A cross-cluster call occurs，name = userservice, clusterName = BJ, instance = [Instance&#123;instanceId=&#x27;192.168.137.1#8085#SH#DEFAULT_GROUP@@userservice&#x27;, ip=&#x27;192.168.137.1&#x27;, port=8085, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName=&#x27;SH&#x27;, serviceName=&#x27;DEFAULT_GROUP@@userservice&#x27;, metadata=&#123;preserved.register.source=SPRING_CLOUD&#125;&#125;]</span><br></pre></td></tr></table></figure></li><li>确定了可用实例列表后，再采用随机负载均衡挑选实例</li></ul><blockquote><p>设置负载均衡的配置</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span>  <span class="comment"># 负载均衡规则</span></span><br></pre></td></tr></table></figure><h1 id="服务实例权重的设置"><a href="#服务实例权重的设置" class="headerlink" title="服务实例权重的设置"></a>服务实例权重的设置</h1><p><img src="https://img-blog.csdnimg.cn/d80c9a32261c45ec8f49983c3698e7ba.png"><br><img src="https://img-blog.csdnimg.cn/a44b90dcd1c44e94b8267a6aaf421c64.png"></p><h1 id="Nacos环境隔离"><a href="#Nacos环境隔离" class="headerlink" title="Nacos环境隔离"></a>Nacos环境隔离</h1><h2 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h2><p><img src="https://img-blog.csdnimg.cn/ce1c866b7a7f449982ff986262b21efa.png"></p><h2 id="创建新的命名空间"><a href="#创建新的命名空间" class="headerlink" title="创建新的命名空间"></a>创建新的命名空间</h2><ul><li>在Nacos控制台可以创建namespace，用来隔离不同环境<br><img src="https://img-blog.csdnimg.cn/b22f11f4a7454e648e03b10e5709e95b.png"></li><li>填写一个新的命名空间信息<br><img src="https://img-blog.csdnimg.cn/ddd09703b9b94964822b459c101e56bd.png"></li><li>保存后可以看到这个命名空间的id<br><img src="https://img-blog.csdnimg.cn/12d8907678b24bb7b660181aa993ad25.png"></li><li>修改配置文件，添加namespace<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">c241845e-d5a8-4163-83ce-dbfc64754f38</span> <span class="comment">#命名空间id</span></span><br></pre></td></tr></table></figure>不同命名空间的服务不能直接相互调用，否则会报错<h1 id="Nacos注册中心原理"><a href="#Nacos注册中心原理" class="headerlink" title="Nacos注册中心原理"></a>Nacos注册中心原理</h1><h2 id="与eureka的区别"><a href="#与eureka的区别" class="headerlink" title="与eureka的区别"></a>与eureka的区别</h2><img src="https://img-blog.csdnimg.cn/3c5f9916507b4215aa02d19d28d79031.png"><br><img src="https://img-blog.csdnimg.cn/f07d4025a35b471a9bea1ab259d6ad20.png"><h2 id="注册非临时实例"><a href="#注册非临时实例" class="headerlink" title="注册非临时实例"></a>注册非临时实例</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">ephemeral:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Nacos安装指南&quot;&gt;&lt;a href=&quot;#Nacos安装指南&quot; class=&quot;headerlink&quot; title=&quot;Nacos安装指南&quot;&gt;&lt;/a&gt;Nacos安装指南&lt;/h1&gt;&lt;h2 id=&quot;1-Windows安装&quot;&gt;&lt;a href=&quot;#1-Windows安装&quot; c</summary>
      
    
    
    
    <category term="微服务" scheme="https://kallenblue.github.io/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>微服务-Eureka</title>
    <link href="https://kallenblue.github.io/2022/10/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Eureka/"/>
    <id>https://kallenblue.github.io/2022/10/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Eureka/</id>
    <published>2022-10-13T12:52:00.000Z</published>
    <updated>2022-10-14T14:51:45.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Eureka作用"><a href="#Eureka作用" class="headerlink" title="Eureka作用"></a>Eureka作用</h1><ul><li>向消费者提供服务提供者具体信息<ul><li>服务提供者启动时向eureka注册自己的信息</li><li>eureka保存这些信息</li><li>消费者根据服务名称向eureka拉取提供者信息</li></ul></li></ul><ul><li>帮助消费者选择服务提供者<ul><li>服务消费者利用负载均衡算法，从服务列表中挑选一个合适的服务提供者</li></ul></li><li>干着服务提供者健康状态<ul><li>服务提供者每隔30秒想EurekaServer发送心跳请求，报告健康状态</li><li>eureka会更新记录服务列表信息，心跳不正常会被删除</li><li>消费者可以拉取到最新的信息</li></ul></li></ul><h1 id="搭建EurekaServer"><a href="#搭建EurekaServer" class="headerlink" title="搭建EurekaServer"></a>搭建EurekaServer</h1><h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka服务端--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="在启动类中添加-EnableEurekaServer注解"><a href="#在启动类中添加-EnableEurekaServer注解" class="headerlink" title="在启动类中添加@EnableEurekaServer注解"></a>在启动类中添加@EnableEurekaServer注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(EurekaApplication.class,args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="编写配置"><a href="#编写配置" class="headerlink" title="编写配置"></a>编写配置</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10086</span> <span class="comment"># 服务端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eurekaserver</span> <span class="comment"># eureka的服务名称</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span>  <span class="comment"># eureka的地址信息</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br></pre></td></tr></table></figure><h1 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h1><p>服务注册和eureka的注册相同，引入依赖，编写好配置信息即可</p><ul><li>引入依赖<br>这里为客户端依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--eureka客户端依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>编写配置</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userserver</span> <span class="comment"># eureka的服务名称</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span>  <span class="comment"># eureka的地址信息</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br></pre></td></tr></table></figure><h2 id="idea模拟多实例部署"><a href="#idea模拟多实例部署" class="headerlink" title="idea模拟多实例部署"></a>idea模拟多实例部署</h2><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/c4cb11a1-38c8-4f59-b88b-1d465304a7d5.png"></p><blockquote><p>启动情况如下<br><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/80d68b7a-be16-49a5-b165-ec4e3bf2ab8a.png"></p></blockquote><h1 id="完成服务拉取"><a href="#完成服务拉取" class="headerlink" title="完成服务拉取"></a>完成服务拉取</h1><ul><li>修改访问url路径</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://userservice/user/&quot;</span>+order.getUserId();</span><br></pre></td></tr></table></figure><ul><li>在RestTemplate的bean中加上负载均衡的注解</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="负载均衡流程"><a href="#负载均衡流程" class="headerlink" title="负载均衡流程"></a>负载均衡流程</h1><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/dcf45685-e05d-4382-9130-a442cd15f708.png"><br><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/48459266-b109-498d-9abf-f35da7ed90a7.png"></p><h1 id="负载均衡策略"><a href="#负载均衡策略" class="headerlink" title="负载均衡策略"></a>负载均衡策略</h1><blockquote><p>Ribbon的负载均衡规则是一个叫做IRule的接口来定义的，每一个实现类都是一种规则<br><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/02b76ed4-71dc-456c-b361-8986ed84aacc.png"><br><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/2fe159f3-590f-4630-98b0-22bace140501.png"></p></blockquote><h2 id="修改负载均衡策略"><a href="#修改负载均衡策略" class="headerlink" title="修改负载均衡策略"></a>修改负载均衡策略</h2><p>介绍两种方式</p><ul><li>1.在启动类中定义一个新的IRule的bean<br>这种方式是全局配置<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> IRule <span class="title function_">randomRule</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>2.在yml配置文件中添加配置<br>这种方式只针对某一个微服务<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRul</span>  <span class="comment"># 负载均衡规则</span></span><br></pre></td></tr></table></figure><h2 id="饥饿加载"><a href="#饥饿加载" class="headerlink" title="饥饿加载"></a>饥饿加载</h2>Ribbon默认采用懒加载，即第一次访问时才会去创建LoadBalanceClient，请求时间较长。<br>而饥饿加载会在项目启动时创建，降低第一次访问的耗时<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启饥饿加载</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="comment"># 指定饥饿加载的服务名称</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">userservice</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Eureka作用&quot;&gt;&lt;a href=&quot;#Eureka作用&quot; class=&quot;headerlink&quot; title=&quot;Eureka作用&quot;&gt;&lt;/a&gt;Eureka作用&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;向消费者提供服务提供者具体信息&lt;ul&gt;
&lt;li&gt;服务提供者启动时向eureka注</summary>
      
    
    
    
    <category term="微服务" scheme="https://kallenblue.github.io/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>微服务-Spring框架中发起http请求</title>
    <link href="https://kallenblue.github.io/2022/10/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Spring%E6%A1%86%E6%9E%B6%E4%B8%AD%E5%8F%91%E8%B5%B7http%E8%AF%B7%E6%B1%82/"/>
    <id>https://kallenblue.github.io/2022/10/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1-Spring%E6%A1%86%E6%9E%B6%E4%B8%AD%E5%8F%91%E8%B5%B7http%E8%AF%B7%E6%B1%82/</id>
    <published>2022-10-13T09:30:16.000Z</published>
    <updated>2022-10-13T12:31:13.834Z</updated>
    
    <content type="html"><![CDATA[<h1 id="在启动类中注册RestTemplate"><a href="#在启动类中注册RestTemplate" class="headerlink" title="在启动类中注册RestTemplate"></a>在启动类中注册RestTemplate</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h1><p>直接使用restTemplate.getForObject()方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">        <span class="comment">// 2.查询用户</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8083/user/&quot;</span>+order.getUserId();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);</span><br><span class="line">        <span class="comment">// 3.封装User信息</span></span><br><span class="line">        order.setUser(user);</span><br><span class="line">        <span class="comment">// 4.返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;在启动类中注册RestTemplate&quot;&gt;&lt;a href=&quot;#在启动类中注册RestTemplate&quot; class=&quot;headerlink&quot; title=&quot;在启动类中注册RestTemplate&quot;&gt;&lt;/a&gt;在启动类中注册RestTemplate&lt;/h1&gt;&lt;figu</summary>
      
    
    
    
    <category term="SpringBoot" scheme="https://kallenblue.github.io/categories/SpringBoot/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringBoot原理-启动过程</title>
    <link href="https://kallenblue.github.io/2022/10/12/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/SpringBoot%E5%8E%9F%E7%90%86-%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/"/>
    <id>https://kallenblue.github.io/2022/10/12/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/SpringBoot%E5%8E%9F%E7%90%86-%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/</id>
    <published>2022-10-12T12:16:09.000Z</published>
    <updated>2022-10-13T01:36:25.529Z</updated>
    
    <content type="html"><![CDATA[<h1 id="启动过程思想"><a href="#启动过程思想" class="headerlink" title="启动过程思想"></a>启动过程思想</h1><ul><li>初始化各种属性，加载成对象<ul><li>读取环境属性</li><li>系统配置</li><li>参数</li></ul></li><li>床架Spring容器对象ApplicationContext，加载各种配置</li><li>在容器创建前，通过监听器机制，应对不同阶段加载数据，更新数据的要求</li><li>容器初始化过程中追加各种功能，例如统计时间、输出日志等</li></ul><h1 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h1><p>按照源代码的流程一步步往下深挖</p><ul><li>SpringBootStartupApplication[10] -&gt; SpringApplication.run(SpringBootStartupApplication.class, args)<ul><li>SpringApplication[817] -&gt; return run(new Class[]{primarySource}, args);<ul><li>SpringApplication[821] -&gt; return (new SpringApplication(primarySources)).run(args);<ul><li>SpringApplication[821] -&gt; SpringApplication(primarySources)<blockquote><p>加载各种配置信息，初始化各种配置对象</p></blockquote><ul><li>SpringApplication[98] -&gt; this((ResourceLoader)null, primarySources);<ul><li>SpringApplication[102-121] -&gt; public SpringApplication(ResourceLoader resourceLoader, Class&lt;?&gt;… primarySources)<ul><li>this.resourceLoader = resourceLoader;<blockquote><p>扩大应用范围</p></blockquote></li><li>this.primarySources = new LinkedHashSet(Arrays.asList(primarySources));<blockquote><p>初始化配置类的类名信息(格式转换)</p></blockquote></li><li>this.webApplicationType = WebApplicationType.deduceFromClasspath();<blockquote><p>确认当前容器加载的类型</p></blockquote></li><li>this.bootstrapRegistryInitializers = new ArrayList(this.getSpringFactoriesInstances(BootstrapRegistryInitializer.class));<blockquote><p>获取系统配置引导信息</p></blockquote></li><li>this.setInitializers(this.getSpringFactoriesInstances(ApplicationContextInitializer.class));<blockquote><p>获取ApplicationContextInitializer.class对应的实例</p></blockquote></li><li>this.setListeners(this.getSpringFactoriesInstances(ApplicationListener.class));<blockquote><p>初始化监听器，对初始化过程及运行过程进行干预</p></blockquote></li><li>this.mainApplicationClass = this.deduceMainApplicationClass();<blockquote><p>初始化了引导类类名信息，备用</p></blockquote></li></ul></li></ul></li><li>SpringApplication[821] -&gt; (new SpringApplication(primarySources)).run(args);<blockquote><p>初始化容器</p></blockquote><ul><li>long startTime = System.nanoTime();<blockquote><p>设置计时器 </p></blockquote></li><li>DefaultBootstrapContext bootstrapContext = this.createBootstrapContext();<blockquote><p>系统引导信息对应的上下文对象 </p></blockquote></li><li> ConfigurableApplicationContext context = null;</li><li>this.configureHeadlessProperty();<blockquote><p> 模拟输入输出信号，避免出现因缺少外设导致的信号传输失败，进而引发错误(模拟显示器，键盘，鼠标等) </p></blockquote></li><li>SpringApplicationRunListeners listeners = this.getRunListeners(args);<blockquote><p>获取当前注册的所有监听器 </p></blockquote></li><li>listeners.starting(bootstrapContext, this.mainApplicationClass);<blockquote><p>监听器执行了对应的操作步骤 </p></blockquote></li><li>ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);<blockquote><p>获取参数 </p></blockquote></li><li>ConfigurableEnvironment environment = this.prepareEnvironment(listeners, bootstrapContext, applicationArguments);<blockquote><p>将前期读取的数据加载成了一个环境对象，用来描述信息  </p></blockquote></li><li>this.configureIgnoreBeanInfo(environment);<blockquote><p>做了一个配置，备用  </p></blockquote></li><li>Banner printedBanner = this.printBanner(environment);<blockquote><p>初始化logo </p></blockquote></li><li>context = this.createApplicationContext();<blockquote><p>创建容器对象，根据前期配置的容器类型进行判定并创建 </p></blockquote></li><li>context.setApplicationStartup(this.applicationStartup);<blockquote><p>设置启动模式  </p></blockquote></li><li>this.prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);<blockquote><p> 对容器进行设置，参数来源于前期的设定 </p></blockquote></li><li>this.refreshContext(context);<blockquote><p>刷新容器环境 </p></blockquote></li><li>this.afterRefresh(context, applicationArguments);<blockquote><p>刷新完毕后做后处理  </p></blockquote></li><li>Duration timeTakenToStartup = Duration.ofNanos(System.nanoTime() - startTime);<blockquote><p>计时结束点  </p></blockquote></li><li>if (this.logStartupInfo) {<blockquote><p>判定是否记录启动时间的日志  </p></blockquote></li><li>(new StartupInfoLogger(this.mainApplicationClass)).logStarted(this.getApplicationLog(), timeTakenToStartup);<blockquote><p>创建日志对应的对象，输出日志信息，包含启动时间  </p></blockquote></li><li>listeners.started(context, timeTakenToStartup);<blockquote><p>监听器执行了对应的操作步骤   </p></blockquote></li><li> this.callRunners(context, applicationArguments);</li><li>Duration timeTakenToReady = Duration.ofNanos(System.nanoTime() - startTime);<blockquote><p>计时结束点  </p></blockquote></li><li>listeners.ready(context, timeTakenToReady);<blockquote><p>监听器执行了对应的操作步骤   </p></blockquote></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;启动过程思想&quot;&gt;&lt;a href=&quot;#启动过程思想&quot; class=&quot;headerlink&quot; title=&quot;启动过程思想&quot;&gt;&lt;/a&gt;启动过程思想&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;初始化各种属性，加载成对象&lt;ul&gt;
&lt;li&gt;读取环境属性&lt;/li&gt;
&lt;li&gt;系统配置&lt;/li&gt;
</summary>
      
    
    
    
    <category term="SpringBoot" scheme="https://kallenblue.github.io/categories/SpringBoot/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringBoot原理-自定义Starter</title>
    <link href="https://kallenblue.github.io/2022/10/10/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/SpringBoot%E5%8E%9F%E7%90%86-%E8%87%AA%E5%AE%9A%E4%B9%89Starter/"/>
    <id>https://kallenblue.github.io/2022/10/10/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/SpringBoot%E5%8E%9F%E7%90%86-%E8%87%AA%E5%AE%9A%E4%B9%89Starter/</id>
    <published>2022-10-10T10:25:10.000Z</published>
    <updated>2022-10-12T07:35:54.744Z</updated>
    
    <content type="html"><![CDATA[<p>在SpringBoot中我们需要引入一项新的技术或者功能，往往只是在pom中引入相应的坐标这样简单就完成了，那么现在我们先尝试一下自定义一个starter模块，然后再使用一下</p><h1 id="模块功能"><a href="#模块功能" class="headerlink" title="模块功能"></a>模块功能</h1><p>在web应用中加入一个访问检测器，每当有用户访问网页时，后台打印出其ip地址和访问次数</p><h1 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h1><ul><li>需要一个web依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>创建一个新的模块，实现一个业务类，具体功能如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpCount</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Map&lt;String,Integer&gt; ipCountMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> HttpServletRequest request;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">count</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ipAddress</span> <span class="operator">=</span> request.getRemoteAddr();</span><br><span class="line">    <span class="keyword">if</span> (ipCountMap.containsKey(ipAddress))&#123;</span><br><span class="line">      ipCountMap.put(ipAddress,ipCountMap.get(ipAddress)+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      ipCountMap.put(ipAddress,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;ipAddress:&quot;</span>+ipAddress+<span class="string">&quot;count:&quot;</span>+ipCountMap.get(ipAddress));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> HttpServletRequest request;</span><br></pre></td></tr></table></figure><p>HttpServletRequest的bean由使用这个模块的项目提供</p><ul><li>创建一个自动配置类，并初始化刚刚创建的业务类的bean</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpAutoConfiguration</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> IpCount <span class="title function_">ipCount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IpCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>在resources下创建META-INF/spring.factories文件，将自动装配信息填入<br>这样就会自动配置IpAutoConfiguration类的bean，同时启动它所依赖的所有bean</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">  cn.ipcount.autoconfig.IpAutoConfiguration</span><br></pre></td></tr></table></figure><p>写好之后用maven上传到本地的库中<br><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/4a55c039-e118-4441-8940-9efe143f7660.png"></p></li><li><p>在需要使用的项目中引入这个依赖即可</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.ipcount<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ipcount_spring_boot_starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>现在就可以将其当做一个普通的第三方包使用了</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/account&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  IpCount ipCount;</span><br><span class="line">  <span class="meta">@GetMapping</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getAccount</span><span class="params">()</span>&#123;</span><br><span class="line">    ipCount.count();</span><br><span class="line">    System.out.println(<span class="string">&quot;get...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="定义属性"><a href="#定义属性" class="headerlink" title="定义属性"></a>定义属性</h1><p>现在我们需要能够自定义属性，在使用时没有配置属性就用默认属性，配置了属性就使用配置的属性</p><ul><li>创建一个配置类<br>这里仅仅设置一个简易的属性note，默认为”检测到用户访问”<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;ipcount&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpProperties</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> <span class="variable">note</span> <span class="operator">=</span> <span class="string">&quot;检测到用户访问&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getNote</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> note;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNote</span><span class="params">(String note)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.note = note;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>在自动装配类中启用配置</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(IpProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpAutoConfiguration</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> IpCount <span class="title function_">ipCount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IpCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>简单修改一下业务类中的方法，直接让其打印出note</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpCount</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Map&lt;String,Integer&gt; ipCountMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> IpProperties ipProperties;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> HttpServletRequest request;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">count</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ipAddress</span> <span class="operator">=</span> request.getRemoteAddr();</span><br><span class="line">    <span class="keyword">if</span> (ipCountMap.containsKey(ipAddress))&#123;</span><br><span class="line">      ipCountMap.put(ipAddress,ipCountMap.get(ipAddress)+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      ipCountMap.put(ipAddress,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(ipProperties.getNote());</span><br><span class="line">    System.out.println(<span class="string">&quot;ipAddress:&quot;</span>+ipAddress+<span class="string">&quot;count:&quot;</span>+ipCountMap.get(ipAddress));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在，如果没有配置属性，程序会在运行时打印默认的参数，如果在项目中配置了这个属性，那么则会打印配置的值</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ipcount:</span></span><br><span class="line">  <span class="attr">note:</span> <span class="string">&quot;test&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test</span><br><span class="line">ipAddress:[0:0:0:0:0:0:0:1]count:1</span><br><span class="line">get...</span><br></pre></td></tr></table></figure><h1 id="加一个拦截器"><a href="#加一个拦截器" class="headerlink" title="加一个拦截器"></a>加一个拦截器</h1><p>这个模块目前只能在一个account-get请求里面使用，我们希望在所有资源请求都使用这个功能，于是想到了使用拦截器，当然也可以使用AOP，但是这是一个web应用，优先考虑拦截器。关于拦截器的知识也在之前的文章中已经解释过</p><ul><li>自定义拦截器</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> IpCount ipCount;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">      <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    ipCount.count();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>设置核心配置类，加载拦截器</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> IpInterceptor <span class="title function_">interceptor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IpInterceptor</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    registry.addInterceptor(interceptor()).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在IpAutoConfiguration中引入SpringMvcConfig</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(IpProperties.class)</span></span><br><span class="line"><span class="meta">@Import(SpringMvcConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpAutoConfiguration</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> IpCount <span class="title function_">ipCount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IpCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="开启配置提示功能"><a href="#开启配置提示功能" class="headerlink" title="开启配置提示功能"></a>开启配置提示功能</h1><p>目前设计的starter在配置上面没有提示功能，如果拿给别人用的话别人也搞不明白你这些配置到底是干嘛用的，所以一般会加上提示功能</p><ul><li>引入依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>引入依赖后重新打包项目，项目中会出现target/classes/META-INF/spring-configuration-metadata.json这个文件</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;groups&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ipcount&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.ipcount.properties.IpProperties&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sourceType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.ipcount.properties.IpProperties&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ipcount.note&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.String&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sourceType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.ipcount.properties.IpProperties&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;defaultValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;收到用户访问&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hints&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>把这个文件移动到项目中的resources/META-INF文件夹中，然后把上面引入的依赖去掉，否则会出现两种提示，实际上自己来编写这个spring-configuration-metadata.json文件也是可以的，只是依赖生成可以省去书写的过程</p><ul><li>hints提示可以选择的值</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;hints&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ipcount.note&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;values&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;提示1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;提示的一种模式.&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;提示2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;提示的另一种模式.&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>最后效果如下<br><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/fce7c0be-a5ba-4c23-af66-1ead91863512.png"><br>ok，这样一来我们就成功定义了一个相对完整的starter，进一步了解了SpringBoot的自动装配机制</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在SpringBoot中我们需要引入一项新的技术或者功能，往往只是在pom中引入相应的坐标这样简单就完成了，那么现在我们先尝试一下自定义一个starter模块，然后再使用一下&lt;/p&gt;
&lt;h1 id=&quot;模块功能&quot;&gt;&lt;a href=&quot;#模块功能&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="SpringBoot" scheme="https://kallenblue.github.io/categories/SpringBoot/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringBoot原理-自动装配</title>
    <link href="https://kallenblue.github.io/2022/10/09/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/SpringBoot%E5%8E%9F%E7%90%86-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/"/>
    <id>https://kallenblue.github.io/2022/10/09/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/SpringBoot%E5%8E%9F%E7%90%86-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/</id>
    <published>2022-10-09T11:53:33.000Z</published>
    <updated>2022-10-10T09:18:55.927Z</updated>
    
    <content type="html"><![CDATA[<h1 id="bean的加载控制"><a href="#bean的加载控制" class="headerlink" title="bean的加载控制"></a>bean的加载控制</h1><p>springboot最常使用的控制bean加载的注解为@Condition<strong>，即在</strong>情况下加载bean<br>比如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(name = &quot;com.kallen.springbootlearning.bean.Mouse&quot;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;com.kallen.springbootlearning.bean.Dog&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="bean的依赖属性配置"><a href="#bean的依赖属性配置" class="headerlink" title="bean的依赖属性配置"></a>bean的依赖属性配置</h1><p>用一个简单的案例模拟springboot的属性配置</p><ul><li>将业务功能bean运行需要的资源抽取成独立的属性类（***Properties），设置读取配置文件信息</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;cartoon&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartoonProperties</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Cat cat;</span><br><span class="line">  <span class="keyword">private</span> Mouse mouse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>配置的属性如下<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cartoon:</span></span><br><span class="line">  <span class="attr">cat:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;coco&quot;</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">4</span></span><br><span class="line">  <span class="attr">mouse:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;tutu&quot;</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure></li><li>业务类如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(CartoonProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TomAndJerry</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Cat cat;</span><br><span class="line">  <span class="keyword">private</span> Mouse mouse;</span><br><span class="line">  <span class="keyword">private</span> CartoonProperties cartoonProperties;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">TomAndJerry</span><span class="params">(CartoonProperties cartoonProperties)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.cartoonProperties = cartoonProperties;</span><br><span class="line">    cat = <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">    cat.setName(cartoonProperties.getCat()!=<span class="literal">null</span> &amp;&amp; StringUtils.hasText(cartoonProperties.getCat().getName())?cartoonProperties.getCat().getName():<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">    cat.setAge(cartoonProperties.getCat()!=<span class="literal">null</span>&amp;&amp;cartoonProperties.getCat().getAge()!=<span class="literal">null</span>?cartoonProperties.getCat().getAge():<span class="number">3</span>);</span><br><span class="line">    mouse = <span class="keyword">new</span> <span class="title class_">Mouse</span>();</span><br><span class="line">    mouse.setName(cartoonProperties.getMouse()!=<span class="literal">null</span> &amp;&amp; StringUtils.hasText(cartoonProperties.getMouse().getName())?cartoonProperties.getMouse().getName():<span class="string">&quot;jerry&quot;</span>);</span><br><span class="line">    mouse.setAge(cartoonProperties.getMouse()!=<span class="literal">null</span>&amp;&amp;cartoonProperties.getMouse().getAge()!=<span class="literal">null</span>?cartoonProperties.getMouse().getAge():<span class="number">3</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(cat.getAge()+<span class="string">&quot;岁的&quot;</span>+cat.getName()+<span class="string">&quot;在抓&quot;</span>+ mouse.getAge()+<span class="string">&quot;岁的&quot;</span>+ mouse.getName());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，@EnableConfigurationProperties(CartoonProperties.class)和配置类联系在了一起，只有在业务类启用时才会去加载配置类</p><ul><li>实体类如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mouse</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时如果在配置文件中配置了Cat和Mouse的属性，那么配置的属性就会覆盖默认值，没有配置也不影响，程序会按照默认配置运行。并且只有使用了业务类，程序才会去加载与业务类相关的一系列的bean</p><h1 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h1><h2 id="自动装配思想"><a href="#自动装配思想" class="headerlink" title="自动装配思想"></a>自动装配思想</h2><ul><li>1.收集整理常用的技术列表-&gt;(技术集A)</li><li>2.收集常用技术列表中的使用参数-&gt;(设置集B)</li><li>3.初始化基础环境，加载自定义的bean并导入其他坐标</li><li>4.将技术集A中的所有技术都定义出来，在Spring/SpringBoot启动时默认全部加载</li><li>5.将技术集A设置成按条件加载，由开发者决定是否使用该技术</li><li>6.将设置集B作为默认配置加载(<strong>约定大于配置</strong>),减少配置的工作量</li><li>7.开放设置集B的配置覆盖接口，由开发者根据自身需要决定是否覆盖默认配置</li></ul><h2 id="自动装配原理"><a href="#自动装配原理" class="headerlink" title="自动装配原理"></a>自动装配原理</h2><p>很好奇，启动springboot项目只需要启动一个Application类下带有@SpringBootApplication注解的main方法即可，于是我们重点来看这个@SpringBootApplication注解<br>逐一点开可以看到它的层级如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line">  <span class="meta">@SpringBootConfiguration</span></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">      <span class="meta">@Component</span></span><br><span class="line">    <span class="comment">//运行期加速启动</span></span><br><span class="line">    <span class="meta">@Indexed</span></span><br><span class="line">  <span class="meta">@EnableAutoConfiguration</span></span><br><span class="line">    <span class="meta">@AutoConfigurationPackage</span></span><br><span class="line">      <span class="comment">//设置当前配置所在包作为扫描包，后续要针对当前的包进行包扫描</span></span><br><span class="line">      <span class="meta">@Import(AutoConfigurationPackages.Registrar.class)</span></span><br><span class="line">    <span class="meta">@Import(AutoConfigurationImportSelector.class)</span></span><br><span class="line">  <span class="meta">@ComponentScan(excludeFilters = &#123;</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br></pre></td></tr></table></figure><p>下面进行一一解释，但不会完全解释，只是简述一下各部分的功能，有些重点的地方会展开解释</p><h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><p>顶层配置</p><h4 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="@SpringBootConfiguration"></a>@SpringBootConfiguration</h4><p>标记为配置类，封装了@Configuration，并做了一些加强</p><h5 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h5><h6 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h6><h5 id="Indexed"><a href="#Indexed" class="headerlink" title="@Indexed"></a>@Indexed</h5><p>运行期加速启动</p><h4 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h4><p>自动配置的主要实现方式</p><h5 id="AutoConfigurationPackage"><a href="#AutoConfigurationPackage" class="headerlink" title="@AutoConfigurationPackage"></a>@AutoConfigurationPackage</h5><p>设置当前配置所在包作为扫描包，后续要针对当前的包进行包扫描</p><h6 id="Import-AutoConfigurationPackages-Registrar-class"><a href="#Import-AutoConfigurationPackages-Registrar-class" class="headerlink" title="@Import(AutoConfigurationPackages.Registrar.class)"></a>@Import(AutoConfigurationPackages.Registrar.class)</h6><p>查看Registrar</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Registrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span>, DeterminableImports &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">register(registry, <span class="keyword">new</span> <span class="title class_">PackageImports</span>(metadata).getPackageNames().toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title function_">determineImports</span><span class="params">(AnnotationMetadata metadata)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> Collections.singleton(<span class="keyword">new</span> <span class="title class_">PackageImports</span>(metadata));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">register(registry, <span class="keyword">new</span> <span class="title class_">PackageImports</span>(metadata).getPackageNames()</span><br></pre></td></tr></table></figure><p>则是获取启动器所在的包的报名<br>查看这个方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(BeanDefinitionRegistry registry, String... packageNames)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (registry.containsBeanDefinition(BEAN)) &#123;</span><br><span class="line"><span class="type">BasePackagesBeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> (BasePackagesBeanDefinition) registry.getBeanDefinition(BEAN);</span><br><span class="line">beanDefinition.addBasePackages(packageNames);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">registry.registerBeanDefinition(BEAN, <span class="keyword">new</span> <span class="title class_">BasePackagesBeanDefinition</span>(packageNames));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registry.registerBeanDefinition(BEAN, <span class="keyword">new</span> <span class="title class_">BasePackagesBeanDefinition</span>(packageNames));</span><br></pre></td></tr></table></figure><p>则是注册这个启动器的bean，为后续扫路径下的包做准备</p><h5 id="Import-AutoConfigurationImportSelector-class"><a href="#Import-AutoConfigurationImportSelector-class" class="headerlink" title="@Import(AutoConfigurationImportSelector.class)"></a>@Import(AutoConfigurationImportSelector.class)</h5><p>这个选择器是用来选择项目所需要的资源，加载初始集<br>查看AutoConfigurationImportSelector</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title class_">DeferredImportSelector</span>, BeanClassLoaderAware,</span><br><span class="line">ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered</span><br></pre></td></tr></table></figure><p>这个类继承了很多接口，分为三类：以Aware结尾的接口可以获取各个类型的bean及其信息(BeanClassLoaderAware,ResourceLoaderAware, BeanFactoryAware, EnvironmentAware)，Ordered用来规定bean的加载顺序，DeferredImportSelector为延时加载选择器<br>AutoConfigurationImportSelector类通过DeferredImportSelector接口实现了process方法，加载资源主要就源自这里</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(AnnotationMetadata annotationMetadata, DeferredImportSelector deferredImportSelector)</span> &#123;</span><br><span class="line">Assert.state(deferredImportSelector <span class="keyword">instanceof</span> AutoConfigurationImportSelector,</span><br><span class="line">() -&gt; String.format(<span class="string">&quot;Only %s implementations are supported, got %s&quot;</span>,</span><br><span class="line">AutoConfigurationImportSelector.class.getSimpleName(),</span><br><span class="line">deferredImportSelector.getClass().getName()));</span><br><span class="line"><span class="type">AutoConfigurationEntry</span> <span class="variable">autoConfigurationEntry</span> <span class="operator">=</span> ((AutoConfigurationImportSelector) deferredImportSelector)</span><br><span class="line">.getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line"><span class="built_in">this</span>.autoConfigurationEntries.add(autoConfigurationEntry);</span><br><span class="line"><span class="keyword">for</span> (String importClassName : autoConfigurationEntry.getConfigurations()) &#123;</span><br><span class="line"><span class="built_in">this</span>.entries.putIfAbsent(importClassName, annotationMetadata);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查看</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AutoConfigurationEntry</span> <span class="variable">autoConfigurationEntry</span> <span class="operator">=</span> ((AutoConfigurationImportSelector) deferredImportSelector)</span><br><span class="line">    .getAutoConfigurationEntry(annotationMetadata);</span><br></pre></td></tr></table></figure><p>中的getAutoConfigurationEntry方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AutoConfigurationEntry <span class="title function_">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line"><span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">&#125;</span><br><span class="line">   <span class="comment">//排除不需要的资源</span></span><br><span class="line"><span class="type">AnnotationAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> getAttributes(annotationMetadata);</span><br><span class="line">List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">configurations = removeDuplicates(configurations);</span><br><span class="line">Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);</span><br><span class="line">checkExcludedClasses(configurations, exclusions);</span><br><span class="line">configurations.removeAll(exclusions);</span><br><span class="line">configurations = getConfigurationClassFilter().filter(configurations);</span><br><span class="line">fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AutoConfigurationEntry</span>(configurations, exclusions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br></pre></td></tr></table></figure><p>就是获得所有的技术集，继续查看getCandidateConfigurations方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> List&lt;String&gt; <span class="title function_">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> &#123;</span><br><span class="line">List&lt;String&gt; configurations = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(</span><br><span class="line">SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(), getBeanClassLoader()));</span><br><span class="line">ImportCandidates.load(AutoConfiguration.class, getBeanClassLoader()).forEach(configurations::add);</span><br><span class="line">Assert.notEmpty(configurations,</span><br><span class="line"><span class="string">&quot;No auto configuration classes found in META-INF/spring.factories nor in META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports. If you &quot;</span></span><br><span class="line">+ <span class="string">&quot;are using a custom packaging, make sure that file is correct.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查看其中的SpringFactoriesLoader.loadFactoryNames()方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryType, <span class="meta">@Nullable</span> ClassLoader classLoader)</span> &#123;</span><br><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoaderToUse</span> <span class="operator">=</span> classLoader;</span><br><span class="line"><span class="keyword">if</span> (classLoaderToUse == <span class="literal">null</span>) &#123;</span><br><span class="line">classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">String</span> <span class="variable">factoryTypeName</span> <span class="operator">=</span> factoryType.getName();</span><br><span class="line"><span class="keyword">return</span> loadSpringFactories(classLoaderToUse).getOrDefault(factoryTypeName, Collections.emptyList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中的loadSpringFactories()方法就是最终获取技术集的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">loadSpringFactories</span><span class="params">(ClassLoader classLoader)</span> &#123;</span><br><span class="line">Map&lt;String, List&lt;String&gt;&gt; result = cache.get(classLoader);</span><br><span class="line"><span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Enumeration&lt;URL&gt; urls = classLoader.getResources(FACTORIES_RESOURCE_LOCATION);</span><br><span class="line"><span class="keyword">while</span> (urls.hasMoreElements()) &#123;</span><br><span class="line"><span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> urls.nextElement();</span><br><span class="line"><span class="type">UrlResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlResource</span>(url);</span><br><span class="line"><span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">factoryTypeName</span> <span class="operator">=</span> ((String) entry.getKey()).trim();</span><br><span class="line">String[] factoryImplementationNames =</span><br><span class="line">StringUtils.commaDelimitedListToStringArray((String) entry.getValue());</span><br><span class="line"><span class="keyword">for</span> (String factoryImplementationName : factoryImplementationNames) &#123;</span><br><span class="line">result.computeIfAbsent(factoryTypeName, key -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;())</span><br><span class="line">.add(factoryImplementationName.trim());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Replace all lists with unmodifiable lists containing unique elements</span></span><br><span class="line">result.replaceAll((factoryType, implementations) -&gt; implementations.stream().distinct()</span><br><span class="line">.collect(Collectors.collectingAndThen(Collectors.toList(), Collections::unmodifiableList)));</span><br><span class="line">cache.put(classLoader, result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unable to load factories from location [&quot;</span> +</span><br><span class="line">FACTORIES_RESOURCE_LOCATION + <span class="string">&quot;]&quot;</span>, ex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中的classLoader.getResources(FACTORIES_RESOURCE_LOCATION);<br>FACTORIES_RESOURCE_LOCATION的定义如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FACTORIES_RESOURCE_LOCATION</span> <span class="operator">=</span> <span class="string">&quot;META-INF/spring.factories&quot;</span>;</span><br></pre></td></tr></table></figure><p>而这个文件中就保存了所有的技术集<br>而至于技术集是否应用则是通过是否有引入来决定了，在注解中使用@Conditional**来实现</p><h4 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h4><p>这一部分主要就是用来过滤一些不需要的东西</p><h2 id="自定义自动配置"><a href="#自定义自动配置" class="headerlink" title="自定义自动配置"></a>自定义自动配置</h2><p>在resources包下新建META-INF/spring.factories文件，格式如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">  com.kallen.springbootlearning.bean.TomAndJerry</span><br></pre></td></tr></table></figure><p>将需要配置的包写在下面即可</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;bean的加载控制&quot;&gt;&lt;a href=&quot;#bean的加载控制&quot; class=&quot;headerlink&quot; title=&quot;bean的加载控制&quot;&gt;&lt;/a&gt;bean的加载控制&lt;/h1&gt;&lt;p&gt;springboot最常使用的控制bean加载的注解为@Condition&lt;stro</summary>
      
    
    
    
    <category term="SpringBoot" scheme="https://kallenblue.github.io/categories/SpringBoot/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringBoot原理篇-Bean加载方式</title>
    <link href="https://kallenblue.github.io/2022/10/09/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87-Bean%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/"/>
    <id>https://kallenblue.github.io/2022/10/09/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87-Bean%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/</id>
    <published>2022-10-08T16:38:43.000Z</published>
    <updated>2022-10-09T04:59:44.842Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-XML方式声明bean"><a href="#1-XML方式声明bean" class="headerlink" title="1.XML方式声明bean"></a>1.XML方式声明bean</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath*:*.properties&quot;</span> <span class="attr">system-properties-mode</span>=<span class="string">&quot;NEVER&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--声明自定义bean--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.Learning1.service.impl.Service&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--声明第三方开发bean--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="2-XML-注解方式声明bean"><a href="#2-XML-注解方式声明bean" class="headerlink" title="2.XML+注解方式声明bean"></a>2.XML+注解方式声明bean</h1><ul><li>此种方式需要在xml配置文件中声明命名空间<br>开启命名空间后，指定包扫描位置<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">  http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.Learning2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>然后使用@Component注解以及其衍生注解@Controller，@Service，@Repository定义bean<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>如果要定义第三方bean，需要使用@Bean注解定义在方法上面，并将所在类定义为配置类或Bean<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbConfig</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> DruidDataSource <span class="title function_">getDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    <span class="keyword">return</span> dataSource;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>@Configuration注解包含了@Component注解</li></ul><h1 id="3-纯注解加载Bean"><a href="#3-纯注解加载Bean" class="headerlink" title="3.纯注解加载Bean"></a>3.纯注解加载Bean</h1><p>将xml配置文件改为一个配置类，用配置类取代xml配置的功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.Learning2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="关于FactoryBean接口的类"><a href="#关于FactoryBean接口的类" class="headerlink" title="关于FactoryBean接口的类"></a>关于FactoryBean接口的类</h2><p>实现FactoryBean接口的类也是用来创建bean的，它存在的意义就在于能够在bean创建之前进行一系列的前置工作，比如判断创建条件，设置bean的信息等<br>对实现了FactoryBean接口的类加上@Bean注解，创建出来的bean不是那个类而是工厂造出来的对象的bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDaoFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;TestDao&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> TestDao <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TestDaoImpl</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">    <span class="keyword">return</span> TestDao.class;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="关于-Configuration注解中的proxyBeanMethods属性"><a href="#关于-Configuration注解中的proxyBeanMethods属性" class="headerlink" title="关于@Configuration注解中的proxyBeanMethods属性"></a>关于@Configuration注解中的proxyBeanMethods属性</h2><p>proxyBeanMethods=true可以保证调用有@Configuration注解的类的方法得到的对象是从spring容器中获取的而不是重新创建的。proxyBeanMethods的默认值是true</p><h1 id="4-使用-Import注解导入"><a href="#4-使用-Import注解导入" class="headerlink" title="4.使用@Import注解导入"></a>4.使用@Import注解导入</h1><p>将需要其对象注册为Bean的类作为参数填入@Import注解中即可<br>这种形式可以有效的降低源代码与spring技术的耦合度</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;JdbcConfig.class,MybatisConfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-使用上下文对象在容器初始化完毕后注入bean"><a href="#5-使用上下文对象在容器初始化完毕后注入bean" class="headerlink" title="5.使用上下文对象在容器初始化完毕后注入bean"></a>5.使用上下文对象在容器初始化完毕后注入bean</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">    applicationContext.register(UserService.class);</span><br><span class="line">    applicationContext.registerBean(<span class="string">&quot;testDao&quot;</span>,TestDao.class);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="6-通过ImportSelector接口加载bean"><a href="#6-通过ImportSelector接口加载bean" class="headerlink" title="6.通过ImportSelector接口加载bean"></a>6.通过ImportSelector接口加载bean</h1><p>在配置类中导入实现了ImportSelector接口的类，实现对导入源的编程式处理<br>谁引用了这个类，这个类就可以获取这个类的一系列信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;MyImportSelector.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">    importingClassMetadata.hasAnnotation(<span class="string">&quot;org.springframework.context.annotation.Configuration&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;com.Learning2.Dog&quot;</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="7-通过ImportBeanDefinitionRegistrar接口创建bean"><a href="#7-通过ImportBeanDefinitionRegistrar接口创建bean" class="headerlink" title="7.通过ImportBeanDefinitionRegistrar接口创建bean"></a>7.通过ImportBeanDefinitionRegistrar接口创建bean</h1><p>这种方法深入到bean的定义过程，使用方法和上一种类似<br>导入实现了ImportBeanDefinitionRegistrar接口的类，通过beanDefinition的注册器注册实名bean，实现对容器中bean的裁定</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;MyImportBeanDefinitionRegistrar.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata,</span></span><br><span class="line"><span class="params">      BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> BeanDefinitionBuilder</span><br><span class="line">                                    .rootBeanDefinition(Dog.class)</span><br><span class="line">                                    .getBeanDefinition();</span><br><span class="line">    registry.registerBeanDefinition(<span class="string">&quot;dodo&quot;</span>,beanDefinition);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="8-BeanDefinitionRegistryPostProcessor决定bean的创建"><a href="#8-BeanDefinitionRegistryPostProcessor决定bean的创建" class="headerlink" title="8.BeanDefinitionRegistryPostProcessor决定bean的创建"></a>8.BeanDefinitionRegistryPostProcessor决定bean的创建</h1><p>这个接口是bean创建的最终决定接口，实现了这个接口的类可以处理之前过程中已经创建的bean，也可以新增bean，是一个最终裁定的接口<br>使用方式和上一个接口的方式类似<br>导入实现了BeanDefinitionRegistryPostProcessor接口的类，通过BeanDefinition的注册器注册实名bean，实现对容器中bean的最终裁定</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;MyPostProcessor.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry beanDefinitionRegistry)</span></span><br><span class="line">      <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> BeanDefinitionBuilder</span><br><span class="line">        .rootBeanDefinition(Dog.class)</span><br><span class="line">        .getBeanDefinition();</span><br><span class="line">    beanDefinitionRegistry.registerBeanDefinition(<span class="string">&quot;dodo&quot;</span>,beanDefinition);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(</span></span><br><span class="line"><span class="params">      ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>除了上面8种方式spring还有一些其他的加载bean的方式，这里就不再叙述了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-XML方式声明bean&quot;&gt;&lt;a href=&quot;#1-XML方式声明bean&quot; class=&quot;headerlink&quot; title=&quot;1.XML方式声明bean&quot;&gt;&lt;/a&gt;1.XML方式声明bean&lt;/h1&gt;&lt;figure class=&quot;highlight xml&quot;</summary>
      
    
    
    
    <category term="SpringBoot" scheme="https://kallenblue.github.io/categories/SpringBoot/"/>
    
    
  </entry>
  
  <entry>
    <title>MybatisPlus</title>
    <link href="https://kallenblue.github.io/2022/10/07/MybatisPlus/MybatisPlus/"/>
    <id>https://kallenblue.github.io/2022/10/07/MybatisPlus/MybatisPlus/</id>
    <published>2022-10-07T12:43:20.173Z</published>
    <updated>2022-10-08T08:33:05.986Z</updated>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><ul><li>MybatisPlus(MP)是基于Mybatis框架基础上开发的增强型工具，旨在简化开发、提高效率<br>关于Springboot整合MP已经在之前的文章中提到过，不再解释<h1 id="标准数据层CRUD功能"><a href="#标准数据层CRUD功能" class="headerlink" title="标准数据层CRUD功能"></a>标准数据层CRUD功能</h1><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/e89fb90f-d525-45a8-a643-ef6f06b2b1ed.png"></li></ul><h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><p>分页查询需要配置一个分页拦截器作为spring管理的bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpConfig</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">pageInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">    <span class="keyword">return</span> interceptor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectPage</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="type">IPage</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">  accountDao.selectPage(page,<span class="literal">null</span>);</span><br><span class="line">  System.out.println(<span class="string">&quot;当前页码:&quot;</span>+page.getCurrent());</span><br><span class="line">  System.out.println(<span class="string">&quot;每页数据总量:&quot;</span>+page.getSize());</span><br><span class="line">  System.out.println(<span class="string">&quot;总页数：&quot;</span>+page.getPages());</span><br><span class="line">  System.out.println(<span class="string">&quot;数据总量:&quot;</span>+page.getTotal());</span><br><span class="line">  System.out.println(<span class="string">&quot;当前页数据:&quot;</span>+page.getRecords());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>还可以开启日志查看查询过程<br>在配置文件中配置</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><p>日志结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6bee793f] was not registered for synchronization because synchronization is not active</span><br><span class="line">JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@32bb0072] will not be managed by Spring</span><br><span class="line">==&gt;  Preparing: SELECT COUNT(*) AS total FROM account</span><br><span class="line">==&gt; Parameters: </span><br><span class="line">&lt;==    Columns: total</span><br><span class="line">&lt;==        Row: 2</span><br><span class="line">&lt;==      Total: 1</span><br><span class="line">==&gt;  Preparing: SELECT account_name,property,account_id FROM account LIMIT ?</span><br><span class="line">==&gt; Parameters: 2(Long)</span><br><span class="line">&lt;==    Columns: account_name, property, account_id</span><br><span class="line">&lt;==        Row: kallen5, 500.0, 1</span><br><span class="line">&lt;==        Row: kallen, 1650.0, 2</span><br><span class="line">&lt;==      Total: 2</span><br><span class="line">Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6bee793f]</span><br></pre></td></tr></table></figure><h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><h3 id="常规格式"><a href="#常规格式" class="headerlink" title="常规格式"></a>常规格式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQuerySelect</span><span class="params">()</span>&#123;</span><br><span class="line">  QueryWrapper&lt;Account&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  queryWrapper.lt(<span class="string">&quot;property&quot;</span>,<span class="number">3000</span>);</span><br><span class="line">  queryWrapper.gt(<span class="string">&quot;property&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">  List&lt;Account&gt; accounts = accountDao.selectList(queryWrapper);</span><br><span class="line">  System.out.println(accounts);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">queryWrapper.lt(<span class="string">&quot;property&quot;</span>,<span class="number">3000</span>);</span><br><span class="line">queryWrapper.gt(<span class="string">&quot;property&quot;</span>,<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>可以简化为链式格式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryWrapper.lt(<span class="string">&quot;property&quot;</span>,<span class="number">3000</span>).gt(<span class="string">&quot;property&quot;</span>,<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>这是”与”查询，”或”查询加个or</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryWrapper.lt(<span class="string">&quot;property&quot;</span>,<span class="number">1000</span>).or().gt(<span class="string">&quot;property&quot;</span>,<span class="number">1500</span>);</span><br></pre></td></tr></table></figure><h3 id="lambda格式"><a href="#lambda格式" class="headerlink" title="lambda格式"></a>lambda格式</h3><p>lambda格式不会有误写字段的问题</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQuerySelect</span><span class="params">()</span> &#123;</span><br><span class="line">  LambdaQueryWrapper&lt;Account&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">  lambdaQueryWrapper.lt(Account::getProperty, <span class="number">3000</span>).gt(Account::getProperty, <span class="number">1000</span>);</span><br><span class="line">  List&lt;Account&gt; accounts = accountDao.selectList(lambdaQueryWrapper);</span><br><span class="line">  System.out.println(accounts);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="空值判定"><a href="#空值判定" class="headerlink" title="空值判定"></a>空值判定</h3><p>在实际运用中，条件查询的值都是变化的，不会设置为一个固定的值，所以也会存在为null的情况，这时就要规定，查询值为null就不让其生效</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryWrapper.lt(<span class="literal">null</span> != account.getPages,<span class="string">&quot;property&quot;</span>,account.getProperty)</span><br></pre></td></tr></table></figure><h1 id="查询投影"><a href="#查询投影" class="headerlink" title="查询投影"></a>查询投影</h1><p>规定需要查询的字段和设置字段别名<br>lambda形式不能设置字段别名</p><blockquote><p>lambda格式</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LambdaQueryWrapper&lt;Account&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">lambdaQueryWrapper.select(Account::getAccountId,Account::getAccountName);</span><br><span class="line">List&lt;Account&gt; accounts = accountDao.selectList(lambdaQueryWrapper);</span><br><span class="line">System.out.println(accounts);</span><br></pre></td></tr></table></figure><blockquote><p>普通格式</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QueryWrapper&lt;Account&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">queryWrapper.groupBy(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; maps = accountDao.selectMaps(queryWrapper);</span><br><span class="line">System.out.println(maps);</span><br></pre></td></tr></table></figure><h1 id="字段映射与表名映射"><a href="#字段映射与表名映射" class="headerlink" title="字段映射与表名映射"></a>字段映射与表名映射</h1><p>专门针对实体类和数据库设计名称不对应而生的</p><blockquote><p>属性与字段不同</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TableField(value = &quot;account_name&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>属性为类中特有属性，在数据表中不存在</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">  <span class="meta">@TableField(exist = false)</span></span><br><span class="line">  <span class="keyword">private</span> Integer online;</span><br><span class="line">&#125;</span><br><span class="line">&gt;设置属性是否参与查询</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">  <span class="meta">@TableField(select = false)</span></span><br><span class="line">  <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>数据库表名和类名不对应</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;tbl_account&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h1><p>在秒杀等业务中需要进行加锁，mp实现了一个轻量级的加锁策略，version策略，在某一个进程修改数据时会检查它的version并且在操作成功后使version+1，使在未修改数据时同时拿到version的进程只有一个进程可以操作数据<br>下面介绍使用方法</p><h2 id="在数据库表中添加锁标记字段"><a href="#在数据库表中添加锁标记字段" class="headerlink" title="在数据库表中添加锁标记字段"></a>在数据库表中添加锁标记字段</h2><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/ec3d9373-64e5-419d-96df-91f9d63f1eb6.png"></p><h2 id="实体类中添加对应字段，并设定当前字段为逻辑删除标记字段"><a href="#实体类中添加对应字段，并设定当前字段为逻辑删除标记字段" class="headerlink" title="实体类中添加对应字段，并设定当前字段为逻辑删除标记字段"></a>实体类中添加对应字段，并设定当前字段为逻辑删除标记字段</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">  <span class="meta">@Version</span></span><br><span class="line">  <span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="配置乐观锁拦截器实现锁机制对应的动态sql语句拼装"><a href="#配置乐观锁拦截器实现锁机制对应的动态sql语句拼装" class="headerlink" title="配置乐观锁拦截器实现锁机制对应的动态sql语句拼装"></a>配置乐观锁拦截器实现锁机制对应的动态sql语句拼装</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpConfig</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">pageInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">OptimisticLockerInnerInterceptor</span>());</span><br><span class="line">    <span class="keyword">return</span> interceptor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用乐观锁机制在修改之前必须先获取到对应数据的version方可正常进行"><a href="#使用乐观锁机制在修改之前必须先获取到对应数据的version方可正常进行" class="headerlink" title="使用乐观锁机制在修改之前必须先获取到对应数据的version方可正常进行"></a>使用乐观锁机制在修改之前必须先获取到对应数据的version方可正常进行</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQuerySelect</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> accountDao.selectById(<span class="number">1L</span>);</span><br><span class="line">  account.setName(<span class="string">&quot;kallen&quot;</span>);</span><br><span class="line">  accountDao.updateById(account);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h1><p>这是一个超级懒人使用的方法，直接生成所有的开发模块，比如domain，service等，下面介绍使用方法</p><h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="使用用例"><a href="#使用用例" class="headerlink" title="使用用例"></a>使用用例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerator</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//创建代码生成器对象，执行生成代码操作</span></span><br><span class="line">    <span class="type">AutoGenerator</span> <span class="variable">autoGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">    <span class="comment">//数据源相关配置，读取数据库中的信息，根据数据库表结构生成代码</span></span><br><span class="line">    <span class="type">DataSourceConfig</span> <span class="variable">dataSourceConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">    dataSourceConfig.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/testgeneration&quot;</span>);</span><br><span class="line">    dataSourceConfig.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">    dataSourceConfig.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    dataSourceConfig.setPassword(<span class="string">&quot;1234&quot;</span>);</span><br><span class="line">    autoGenerator.setDataSource(dataSourceConfig);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置全局配置</span></span><br><span class="line">    <span class="type">GlobalConfig</span> <span class="variable">globalConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">    <span class="comment">//设置生成的文件位置</span></span><br><span class="line">    globalConfig.setOutputDir(System.getProperty(<span class="string">&quot;user.dir&quot;</span>)+<span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">    <span class="comment">//是否打开文件夹</span></span><br><span class="line">    globalConfig.setOpen(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//设置作者名</span></span><br><span class="line">    globalConfig.setAuthor(<span class="string">&quot;kallen&quot;</span>);</span><br><span class="line">    <span class="comment">//设置是否覆盖原文件</span></span><br><span class="line">    globalConfig.setFileOverride(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//设置以Dao结尾</span></span><br><span class="line">    globalConfig.setMapperName(<span class="string">&quot;%sDao&quot;</span>);</span><br><span class="line">    <span class="comment">//设置数据库id创建方式</span></span><br><span class="line">    globalConfig.setIdType(IdType.ASSIGN_ID);</span><br><span class="line">    autoGenerator.setGlobalConfig(globalConfig);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//包相关配置</span></span><br><span class="line">    <span class="type">PackageConfig</span> <span class="variable">packageConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">    <span class="comment">//设置包位置</span></span><br><span class="line">    packageConfig.setParent(<span class="string">&quot;com.kallen.springbootlearning&quot;</span>);</span><br><span class="line">    <span class="comment">//设置实体类别名</span></span><br><span class="line">    packageConfig.setEntity(<span class="string">&quot;domain&quot;</span>);</span><br><span class="line">    <span class="comment">//设置数据层别名</span></span><br><span class="line">    packageConfig.setMapper(<span class="string">&quot;dao&quot;</span>);</span><br><span class="line">    autoGenerator.setPackageInfo(packageConfig);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//策略相关配置</span></span><br><span class="line">    <span class="type">StrategyConfig</span> <span class="variable">strategyConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">    <span class="comment">//设置需要生成的表</span></span><br><span class="line">    strategyConfig.setInclude(<span class="string">&quot;account&quot;</span>);</span><br><span class="line">    <span class="comment">//设置数据库表前缀</span></span><br><span class="line">    strategyConfig.setTablePrefix(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">//设置rest风格</span></span><br><span class="line">    strategyConfig.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//设置lombok</span></span><br><span class="line">    strategyConfig.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//设置逻辑删除</span></span><br><span class="line">    strategyConfig.setLogicDeleteFieldName(<span class="string">&quot;deleted&quot;</span>);</span><br><span class="line">    <span class="comment">//设置乐观锁</span></span><br><span class="line">    strategyConfig.setVersionFieldName(<span class="string">&quot;version&quot;</span>);</span><br><span class="line">    autoGenerator.setStrategy(strategyConfig);</span><br><span class="line"></span><br><span class="line">    autoGenerator.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="关于lombok"><a href="#关于lombok" class="headerlink" title="关于lombok"></a>关于lombok</h1><blockquote><p>一个java类库，提供了一组注解，简化pojo实体类开发</p></blockquote><p>导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>实体类上加上@Data即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String accountName;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">double</span> property;</span><br><span class="line">  <span class="keyword">private</span> Long accountId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>为当前实体类再编译期设置对应的get/set方法，无参/有参构造方法，toString方法，hashCode方法，equals方法等</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;MybatisPlus(MP)是基于Mybatis框架基础上开发的增强型工具，旨在简化开发、提高效率&lt;br&gt;关于Springbo</summary>
      
    
    
    
    <category term="MybatisPlus" scheme="https://kallenblue.github.io/categories/MybatisPlus/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringBoot-基础操作</title>
    <link href="https://kallenblue.github.io/2022/10/06/SpringBoot/SpringBoot-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/"/>
    <id>https://kallenblue.github.io/2022/10/06/SpringBoot/SpringBoot-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/</id>
    <published>2022-10-06T05:47:13.000Z</published>
    <updated>2022-10-08T08:28:26.752Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringBoot项目打包并运行"><a href="#SpringBoot项目打包并运行" class="headerlink" title="SpringBoot项目打包并运行"></a>SpringBoot项目打包并运行</h1><h2 id="执行Maven构建指令package"><a href="#执行Maven构建指令package" class="headerlink" title="执行Maven构建指令package"></a>执行Maven构建指令package</h2><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/d217da00-98c2-4908-9b25-f1c8e49039c6.png"></p><h2 id="在jar包的目录下启动指令"><a href="#在jar包的目录下启动指令" class="headerlink" title="在jar包的目录下启动指令"></a>在jar包的目录下启动指令</h2><blockquote><p>java -jar [jar文件名]</p></blockquote><p>需要确保打包时具有maven插件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure><h1 id="使用maven依赖管理变更起步依赖"><a href="#使用maven依赖管理变更起步依赖" class="headerlink" title="使用maven依赖管理变更起步依赖"></a>使用maven依赖管理变更起步依赖</h1><blockquote><p>更换tomcat为jetty</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web起步依赖环境中，排除Tomcat起步依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--添加Jetty起步依赖，版本由SpringBoot的starter控制--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="配置格式"><a href="#配置格式" class="headerlink" title="配置格式"></a>配置格式</h1><ul><li>application.properties</li><li>application.yml</li></ul><p>配置默认提示信息</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">warn</span></span><br></pre></td></tr></table></figure><p>现在提示信息只有这么点了：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#x27;_ | &#x27;_| | &#x27;_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::                (v2.7.4)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="yaml数据读取方式"><a href="#yaml数据读取方式" class="headerlink" title="yaml数据读取方式"></a>yaml数据读取方式</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">warn</span></span><br><span class="line"></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kallen</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">likes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">basketball</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">football</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">swim</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="使用-Value读取单个数据"><a href="#使用-Value读取单个数据" class="headerlink" title="使用@Value读取单个数据"></a>使用@Value读取单个数据</h2><p>属性名引用方式：${一级属性名.二级属性名}</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> port;</span><br></pre></td></tr></table></figure><h2 id="封装全部数据到Environment对象"><a href="#封装全部数据到Environment对象" class="headerlink" title="封装全部数据到Environment对象"></a>封装全部数据到Environment对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> Environment environment;</span><br><span class="line">  <span class="meta">@GetMapping</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(environment.getProperty(<span class="string">&quot;server.port&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义对象封装指定数据"><a href="#自定义对象封装指定数据" class="headerlink" title="自定义对象封装指定数据"></a>自定义对象封装指定数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">  <span class="keyword">private</span> String[] likes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="多环境启动"><a href="#多环境启动" class="headerlink" title="多环境启动"></a>多环境启动</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">pro</span> <span class="comment">#启动指定环境</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">pro</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">81</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">82</span></span><br></pre></td></tr></table></figure><p>上面的是过时格式推荐格式如下，但更麻烦</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure><h2 id="打包后带参数启动Springboot"><a href="#打包后带参数启动Springboot" class="headerlink" title="打包后带参数启动Springboot"></a>打包后带参数启动Springboot</h2><blockquote><p>java -jar [jar包名] –spring.profile.active=[模式名] –server.port=[端口号]</p></blockquote><h1 id="SpringBoot整合Mybatis"><a href="#SpringBoot整合Mybatis" class="headerlink" title="SpringBoot整合Mybatis"></a>SpringBoot整合Mybatis</h1><h2 id="选择需要的技术集"><a href="#选择需要的技术集" class="headerlink" title="选择需要的技术集"></a>选择需要的技术集</h2><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/0b85811d-0e47-48a7-8957-738b5a7a1701.png"></p><h2 id="设置数据源参数"><a href="#设置数据源参数" class="headerlink" title="设置数据源参数"></a>设置数据源参数</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/testgeneration</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">1234</span></span><br></pre></td></tr></table></figure><h2 id="定义数据层接口与映射配置"><a href="#定义数据层接口与映射配置" class="headerlink" title="定义数据层接口与映射配置"></a>定义数据层接口与映射配置</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Select(&quot;select account_id as id,account_name as name,property from account&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> List&lt;Account&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结束。。<br>相比于spring，简化了一大堆的配置，简直不要太爽，到现在，我才终于体会到springboot的强大之处，之前学习的时候都是直接使用Springboot，没有这样的感受，而且在讲原理的时候有很多地方都感觉莫名其妙，直到看完了spring的各种配置和原理，才真正明白springboot是个什么东西，springboot不过是个简化工具，真正有重量的东西在spring框架上面，这几天也算基本看完了spring的一套东西，可以很明显的感受到编程在一步步的简化，它的趋势是这样的</p><blockquote><p>xml-&gt;部分注解配置-&gt;spring全注解配置-&gt;springboot注解自动配置</p></blockquote><h1 id="SpringBoot-整合mybatisplus（mp）"><a href="#SpringBoot-整合mybatisplus（mp）" class="headerlink" title="SpringBoot 整合mybatisplus（mp）"></a>SpringBoot 整合mybatisplus（mp）</h1><h2 id="手动添加mp起步依赖"><a href="#手动添加mp起步依赖" class="headerlink" title="手动添加mp起步依赖"></a>手动添加mp起步依赖</h2><blockquote><p>mp未被收录到idea的内置配置中</p></blockquote><h2 id="设置jdbc参数"><a href="#设置jdbc参数" class="headerlink" title="设置jdbc参数"></a>设置jdbc参数</h2><blockquote><p>和上面那个案例一样，不解释了</p></blockquote><h2 id="创建domain实体类"><a href="#创建domain实体类" class="headerlink" title="创建domain实体类"></a>创建domain实体类</h2><h2 id="定义数据接口，继承BaseMapper"><a href="#定义数据接口，继承BaseMapper" class="headerlink" title="定义数据接口，继承BaseMapper"></a>定义数据接口，继承BaseMapper<Account></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Account&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>完成。</p></blockquote><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><blockquote><p>直接调用方法即可</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootLearningApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Account&gt; accounts = accountDao.selectList(<span class="literal">null</span>);</span><br><span class="line">    accounts.forEach(System.out::println);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="简化日志"><a href="#简化日志" class="headerlink" title="简化日志"></a>简化日志</h1><p>日志太多干扰正常信息，可以设置简化日志</p><h2 id="设置xml配置文件"><a href="#设置xml配置文件" class="headerlink" title="设置xml配置文件"></a>设置xml配置文件</h2><p>在resources文件夹下新建xml文件并设置一个空的configuration即可</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="禁用banner"><a href="#禁用banner" class="headerlink" title="禁用banner"></a>禁用banner</h2><p>在springboot的配置类中打出banner即可自动搜索出banner的配置，设置为禁用即可</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">banner-mode:</span> <span class="string">off</span></span><br></pre></td></tr></table></figure><p>当然想要自定义banner也从这里入手</p><h1 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h1><p>其实就是更改代码后快速重启一下服务器方便测试<br>热部署仅仅加载当前开发者自定义开发的资源，不加载jar资源，所以热部署比手动重启要快一些<br>引入依赖即可使用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>idea下ctrl+f9激活</p><blockquote><p>idea提供了自动构建项目的功能<br><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/965e26df-135b-470b-8119-a549ceac79c8.png"><br><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/048cdb7c-65f8-4b77-8c13-b1460d53ffbb.png"><br>这个设置在2021版的idea中被调到了设置里面，上网查了才知道<br>idea失去焦点5秒后会自动热部署 </p></blockquote><ul><li>取消热部署可以在配置文件中设置,devtools.restart.exclude</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SpringBoot项目打包并运行&quot;&gt;&lt;a href=&quot;#SpringBoot项目打包并运行&quot; class=&quot;headerlink&quot; title=&quot;SpringBoot项目打包并运行&quot;&gt;&lt;/a&gt;SpringBoot项目打包并运行&lt;/h1&gt;&lt;h2 id=&quot;执行Mav</summary>
      
    
    
    
    <category term="SpringBoot" scheme="https://kallenblue.github.io/categories/SpringBoot/"/>
    
    
  </entry>
  
  <entry>
    <title>SSM-拦截器</title>
    <link href="https://kallenblue.github.io/2022/10/05/SSM/SSM-%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    <id>https://kallenblue.github.io/2022/10/05/SSM/SSM-%E6%8B%A6%E6%88%AA%E5%99%A8/</id>
    <published>2022-10-05T14:13:12.000Z</published>
    <updated>2022-10-12T12:31:09.881Z</updated>
    
    <content type="html"><![CDATA[<h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><h2 id="声明拦截器的bean，并实现接口"><a href="#声明拦截器的bean，并实现接口" class="headerlink" title="声明拦截器的bean，并实现接口"></a>声明拦截器的bean，并实现接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">      <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;preHandle&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class="line"><span class="params">      ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;postHandle&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">      Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;afterCompletion&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="定义配置类，继承WebMvcConfigurationSupport，实现"><a href="#定义配置类，继承WebMvcConfigurationSupport，实现" class="headerlink" title="定义配置类，继承WebMvcConfigurationSupport，实现"></a>定义配置类，继承WebMvcConfigurationSupport，实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcSupport</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ProjectInterceptor interceptor;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInterceptor</span><span class="params">(ProjectInterceptor interceptor)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.interceptor = interceptor;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    registry.addInterceptor(interceptor).addPathPatterns(<span class="string">&quot;/accounts&quot;</span>,<span class="string">&quot;/accounts/*&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="也可以使用标准接口WebMvcConfigurer简化开发，但侵入性较强"><a href="#也可以使用标准接口WebMvcConfigurer简化开发，但侵入性较强" class="headerlink" title="也可以使用标准接口WebMvcConfigurer简化开发，但侵入性较强"></a>也可以使用标准接口WebMvcConfigurer简化开发，但侵入性较强</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.kallen.controller&quot;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ProjectInterceptor interceptor;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInterceptor</span><span class="params">(ProjectInterceptor interceptor)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.interceptor = interceptor;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    registry.addInterceptor(interceptor).addPathPatterns(<span class="string">&quot;/accounts&quot;</span>,<span class="string">&quot;/accounts/*&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="拦截器参数"><a href="#拦截器参数" class="headerlink" title="拦截器参数"></a>拦截器参数</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">    <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;preHandle&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>request:请求对象</li><li>response:响应对象</li><li>handler:被调用的处理器对象，本质上是一个方法对象，对反射技术中的Method对象进行了再包装</li><li>返回值为false，被拦截的处理器将不执行</li></ul><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/d2bd3808-92f3-4fed-a0c4-1f9155fa181e.png"></p><h2 id="多拦截器执行顺序"><a href="#多拦截器执行顺序" class="headerlink" title="多拦截器执行顺序"></a>多拦截器执行顺序</h2><ul><li>当配置多个拦截器时，形成拦截器链</li><li>拦截器链的运行顺序参照拦截器添加顺序为准</li><li>当拦截器中出现对原始处理器的拦截，后面的拦截器均终止运行</li><li>当拦截器运行终端，仅运行配置在前面的拦截器的afterCompletion操作</li></ul><p><img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-ceb77253-93f0-4559-a375-815102654932/4baf747d-b6f3-4f90-bfb2-1266c2cf0bba.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;案例&quot;&gt;&lt;a href=&quot;#案例&quot; class=&quot;headerlink&quot; title=&quot;案例&quot;&gt;&lt;/a&gt;案例&lt;/h1&gt;&lt;h2 id=&quot;声明拦截器的bean，并实现接口&quot;&gt;&lt;a href=&quot;#声明拦截器的bean，并实现接口&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="SSM" scheme="https://kallenblue.github.io/categories/SSM/"/>
    
    
  </entry>
  
  <entry>
    <title>SSM-异常处理</title>
    <link href="https://kallenblue.github.io/2022/10/05/SSM/SSM-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
    <id>https://kallenblue.github.io/2022/10/05/SSM/SSM-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</id>
    <published>2022-10-05T05:45:15.000Z</published>
    <updated>2022-10-05T15:08:02.037Z</updated>
    
    <content type="html"><![CDATA[<h1 id="关于SSM的整合"><a href="#关于SSM的整合" class="headerlink" title="关于SSM的整合"></a>关于SSM的整合</h1><blockquote><p>SSM即Spring+SpringMVC+Mybatis，各部分的知识点已经在Spring和SpringMVC的模块里面介绍了，所以不再一一记录，我将一份<a href="">模板源码</a>上传到github上，方便项目的启动（ps:已经感受到Spring配置上的繁琐，但也正是有这样的感受才会体验到Springboot的便捷）</p></blockquote><h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><h2 id="异常处理器"><a href="#异常处理器" class="headerlink" title="异常处理器"></a>异常处理器</h2><ul><li>集中的、统一的处理项目中出现的异常</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectExceptionAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">doException</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">10000</span>,<span class="string">&quot;出现异常&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>@ExceptionHandler 标注处理哪一个异常</p></blockquote><h2 id="自定义项目系统级异常"><a href="#自定义项目系统级异常" class="headerlink" title="自定义项目系统级异常"></a>自定义项目系统级异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.code = code;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">SystemException</span><span class="params">(Integer code,String message)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(message);</span><br><span class="line">    <span class="built_in">this</span>.code = code;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">SystemException</span><span class="params">(Integer code,String message, Throwable cause)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(message, cause);</span><br><span class="line">    <span class="built_in">this</span>.code = code;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义项目业务级异常"><a href="#自定义项目业务级异常" class="headerlink" title="自定义项目业务级异常"></a>自定义项目业务级异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.code = code;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(Integer code,String message)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(message);</span><br><span class="line">    <span class="built_in">this</span>.code = code;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(Integer code,String message, Throwable cause)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(message, cause);</span><br><span class="line">    <span class="built_in">this</span>.code = code;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义异常编码"><a href="#自定义异常编码" class="headerlink" title="自定义异常编码"></a>自定义异常编码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Code</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer SAVE_OK=<span class="number">20011</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer DELETE_OK=<span class="number">20021</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer UPDATE_OK=<span class="number">20031</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer GET_OK=<span class="number">20041</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer SAVE_ERR=<span class="number">20010</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer DELETE_ERR=<span class="number">20020</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer UPDATE_ERR=<span class="number">20030</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer GET_ERR=<span class="number">20040</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer SYSTEM_UNKNOWN_ERR=<span class="number">50000</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer SYSTEM_TIMEOUT_ERR=<span class="number">50001</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer PROJECT_VALIDATE_ERR=<span class="number">50010</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer PROJECT_BUSINESS_ERR=<span class="number">50011</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="触发自定义异常"><a href="#触发自定义异常" class="headerlink" title="触发自定义异常"></a>触发自定义异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (id&lt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(Code.PROJECT_BUSINESS_ERR,<span class="string">&quot;参数不合法&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> accountService.getById(id);</span><br><span class="line">  <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> account !=<span class="literal">null</span>?Code.GET_OK:Code.GET_ERR;</span><br><span class="line">  <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> account!=<span class="literal">null</span>?<span class="string">&quot;&quot;</span>:<span class="string">&quot;查询失败&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(code,account,msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="拦截并处理异常"><a href="#拦截并处理异常" class="headerlink" title="拦截并处理异常"></a>拦截并处理异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectExceptionAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">doBusinessException</span><span class="params">(BusinessException e)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(e.getCode(),e.getMessage());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ExceptionHandler(SystemException.class)</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">doSystemException</span><span class="params">(SystemException e)</span>&#123;</span><br><span class="line">    <span class="comment">//记录日志</span></span><br><span class="line">    <span class="comment">//发送邮件给开发人员</span></span><br><span class="line">    <span class="comment">//发送短信给运维人员</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(e.getCode(),e.getMessage());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">doException</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">    <span class="comment">//记录日志</span></span><br><span class="line">    <span class="comment">//发送邮件给开发人员</span></span><br><span class="line">    <span class="comment">//发送短信给运维人员</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(Code.SYSTEM_UNKNOWN_ERR,<span class="string">&quot;出现异常&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;关于SSM的整合&quot;&gt;&lt;a href=&quot;#关于SSM的整合&quot; class=&quot;headerlink&quot; title=&quot;关于SSM的整合&quot;&gt;&lt;/a&gt;关于SSM的整合&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;SSM即Spring+SpringMVC+Mybatis，各部分的</summary>
      
    
    
    
    <category term="SSM" scheme="https://kallenblue.github.io/categories/SSM/"/>
    
    
  </entry>
  
</feed>
